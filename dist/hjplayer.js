!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("HJPlayer",[],t):"object"==typeof exports?exports.HJPlayer=t():e.HJPlayer=t()}(this,(function(){return function(e){var t={};function i(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(n,r,function(t){return e[t]}.bind(null,r));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=31)}([function(e,t,i){"use strict";var n=i(4),r=i.n(n),a=i(1),s=new r.a,o=function(){function e(){}return Object.defineProperty(e,"GLOBAL_TAG",{get:function(){return e._tag},set:function(t){e._tag=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"config",{get:function(){return e._config||(e._config=Object.create(null)),e._config},set:function(t){e._config=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"emitter",{get:function(){return s},enumerable:!1,configurable:!0}),e.on=function(t,i){e.emitter.on(t,i)},e.once=function(t,i){e.emitter.once(t,i)},e.off=function(t,i){e.emitter.off(t,i)},e.clearEvents=function(){e.emitter.removeAllListeners()},e.error=function(t,i){t&&!e.config.FORCE_GLOBAL_TAG||(t=e.GLOBAL_TAG);var n="["+t+"] > "+i;e.config.ENABLE_CALLBACK&&e.emitter.emit(a.a.HJ_PLAYER_LOG,"error",n),e.config.ENABLE_ERROR&&(console.error?console.error(n):console.warn?console.warn(n):console.log(n))},e.info=function(t,i){t&&!e.config.FORCE_GLOBAL_TAG||(t=e.GLOBAL_TAG);var n="["+t+"] > "+i;e.config.ENABLE_CALLBACK&&e.emitter.emit(a.a.HJ_PLAYER_LOG,"info",n),e.config.ENABLE_INFO&&(console.info?console.info(n):console.log(n))},e.log=function(t,i){t&&!e.config.FORCE_GLOBAL_TAG||(t=e.GLOBAL_TAG);var n="["+t+"] > "+i;e.config.ENABLE_CALLBACK&&e.emitter.emit(a.a.HJ_PLAYER_LOG,"log",n),e.config.ENABLE_INFO&&console.log(n)},e.warn=function(t,i){t&&!e.config.FORCE_GLOBAL_TAG||(t=e.GLOBAL_TAG);var n="["+t+"] > "+i;e.config.ENABLE_CALLBACK&&e.emitter.emit(a.a.HJ_PLAYER_LOG,"warn",n),e.config.ENABLE_WARN&&(console.warn?console.warn(n):console.log(n))},e.debug=function(t,i){t&&!e.config.FORCE_GLOBAL_TAG||(t=e.GLOBAL_TAG);var n="["+t+"] > "+i;e.config.ENABLE_CALLBACK&&e.emitter.emit(a.a.HJ_PLAYER_LOG,"debug",n),e.config.ENABLE_DEBUG&&(console.debug?console.debug(n):console.log(n))},e}();t.a=o},function(e,t,i){"use strict";t.a={INIT_SEGMENT:"INIT_SEGMENT",MEDIA_SEGMENT:"MEDIA_SEGMENT",GET_SEI_INFO:"GET_SEI_INFO",MEDIA_INFO:"MEDIA_INFO",LOAD_COMPLETE:"LOAD_COMPLETE",DATA_ARRIVED:"DATA_ARRIVED",STATISTICS_INFO:"STATISTICS_INFO",HJ_PLAYER_LOG:"HJ_PLAYER_LOG",FRAG_PARSED:"FRAG_PARSED",FRAG_PARSING_METADATA:"FRAG_PARSING_METADATA",FRAG_PARSING_USERDATA:"FRAG_PARSING_USERDATA",INIT_PTS_FOUND:"INIT_PTS_FOUND",FRAG_PARSING_INIT_SEGMENT:"FRAG_PARSING_INIT_SEGMENT",MEDIA_SEEK:"MEDIA_SEEK",RECOVERED_EARLY_EOF:"RECOVERED_EARLY_EOF",RECOMMEND_SEEKPOINT:"RECOMMEND_SEEKPOINT",METADATA_ARRIVED:"METADATA_ARRIVED",SCRIPTDATA_ARRIVED:"SCRIPTDATA_ARRIVED",UPDATE_END:"UPDATE_END",BUFFER_FULL:"BUFFER_FULL",SOURCE_OPEN:"SOURCE_OPEN",ERROR:"ERROR",MANIFEST_PARSED:"MANIFEST_PARSED",IO_ERROR:"IO_ERROR",DEMUX_ERROR:"DEMUX_ERROR",WORKER_LOG:"WORKER_LOG",LOAD_NEXT_FRAG:"LOAD_NEXT_FRAG"}},function(e,t,i){"use strict";var n;!function(e){e[e.kIdle=0]="kIdle",e[e.kConnecting=1]="kConnecting",e[e.kBuffering=2]="kBuffering",e[e.kError=3]="kError",e[e.kComplete=4]="kComplete"}(n||(n={})),t.a=n},function(e,t,i){"use strict";i.d(t,"d",(function(){return a})),i.d(t,"a",(function(){return s})),i.d(t,"b",(function(){return o})),i.d(t,"c",(function(){return u}));var n,r=(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),a=function(){function e(e){this._message=e}return Object.defineProperty(e.prototype,"name",{get:function(){return"RuntimeException"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"message",{get:function(){return this._message},enumerable:!1,configurable:!0}),e.prototype.toString=function(){return this.name+": "+this.message},e}(),s=function(e){function t(t){return e.call(this,t)||this}return r(t,e),Object.defineProperty(t.prototype,"name",{get:function(){return"IllegalStateException"},enumerable:!1,configurable:!0}),t}(a),o=function(e){function t(t){return e.call(this,t)||this}return r(t,e),Object.defineProperty(t.prototype,"name",{get:function(){return"InvalidArgumentException"},enumerable:!1,configurable:!0}),t}(a),u=function(e){function t(t){return e.call(this,t)||this}return r(t,e),Object.defineProperty(t.prototype,"name",{get:function(){return"NotImplementedException"},enumerable:!1,configurable:!0}),t}(a)},function(e,t,i){"use strict";var n=Object.prototype.hasOwnProperty,r="~";function a(){}function s(e,t,i){this.fn=e,this.context=t,this.once=i||!1}function o(e,t,i,n,a){if("function"!=typeof i)throw new TypeError("The listener must be a function");var o=new s(i,n||e,a),u=r?r+t:t;return e._events[u]?e._events[u].fn?e._events[u]=[e._events[u],o]:e._events[u].push(o):(e._events[u]=o,e._eventsCount++),e}function u(e,t){0==--e._eventsCount?e._events=new a:delete e._events[t]}function h(){this._events=new a,this._eventsCount=0}Object.create&&(a.prototype=Object.create(null),(new a).__proto__||(r=!1)),h.prototype.eventNames=function(){var e,t,i=[];if(0===this._eventsCount)return i;for(t in e=this._events)n.call(e,t)&&i.push(r?t.slice(1):t);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},h.prototype.listeners=function(e){var t=r?r+e:e,i=this._events[t];if(!i)return[];if(i.fn)return[i.fn];for(var n=0,a=i.length,s=new Array(a);n<a;n++)s[n]=i[n].fn;return s},h.prototype.listenerCount=function(e){var t=r?r+e:e,i=this._events[t];return i?i.fn?1:i.length:0},h.prototype.emit=function(e,t,i,n,a,s){var o=r?r+e:e;if(!this._events[o])return!1;var u,h,d=this._events[o],l=arguments.length;if(d.fn){switch(d.once&&this.removeListener(e,d.fn,void 0,!0),l){case 1:return d.fn.call(d.context),!0;case 2:return d.fn.call(d.context,t),!0;case 3:return d.fn.call(d.context,t,i),!0;case 4:return d.fn.call(d.context,t,i,n),!0;case 5:return d.fn.call(d.context,t,i,n,a),!0;case 6:return d.fn.call(d.context,t,i,n,a,s),!0}for(h=1,u=new Array(l-1);h<l;h++)u[h-1]=arguments[h];d.fn.apply(d.context,u)}else{var c,f=d.length;for(h=0;h<f;h++)switch(d[h].once&&this.removeListener(e,d[h].fn,void 0,!0),l){case 1:d[h].fn.call(d[h].context);break;case 2:d[h].fn.call(d[h].context,t);break;case 3:d[h].fn.call(d[h].context,t,i);break;case 4:d[h].fn.call(d[h].context,t,i,n);break;default:if(!u)for(c=1,u=new Array(l-1);c<l;c++)u[c-1]=arguments[c];d[h].fn.apply(d[h].context,u)}}return!0},h.prototype.on=function(e,t,i){return o(this,e,t,i,!1)},h.prototype.once=function(e,t,i){return o(this,e,t,i,!0)},h.prototype.removeListener=function(e,t,i,n){var a=r?r+e:e;if(!this._events[a])return this;if(!t)return u(this,a),this;var s=this._events[a];if(s.fn)s.fn!==t||n&&!s.once||i&&s.context!==i||u(this,a);else{for(var o=0,h=[],d=s.length;o<d;o++)(s[o].fn!==t||n&&!s[o].once||i&&s[o].context!==i)&&h.push(s[o]);h.length?this._events[a]=1===h.length?h[0]:h:u(this,a)}return this},h.prototype.removeAllListeners=function(e){var t;return e?(t=r?r+e:e,this._events[t]&&u(this,t)):(this._events=new a,this._eventsCount=0),this},h.prototype.off=h.prototype.removeListener,h.prototype.addListener=h.prototype.on,h.prefixed=r,h.EventEmitter=h,e.exports=h},function(e,t,i){"use strict";function n(){return"undefined"==typeof window?self:window}i.d(t,"a",(function(){return n}))},function(e,t,i){"use strict";var n;!function(e){e.OK="OK",e.EXCEPTION="EXCEPTION",e.HTTP_STATUS_CODE_INVALID="HTTP_STATUS_CODE_INVALID",e.CONNECTING_TIMEOUT="CONNECTING_TIMEOUT",e.EARLY_EOF="EARLY_EOF",e.UNRECOVERABLE_EARLY_EOF="UNRECOVERABLE_EARLY_EOF",e.PARSE_PLAYLISTING_ERROR="PARSE_PLAYLISTING_ERROR"}(n||(n={})),t.a=n},function(e,t,i){"use strict";var n=i(5),r=Object(n.a)();var a=function(){var e=r.navigator.userAgent.toLowerCase(),t=/(edge)\/([\w.]+)/.exec(e)||/(opr)[/]([\w.]+)/.exec(e)||/(chrome)[/]([\w.]+)/.exec(e)||/(iemobile)[/]([\w.]+)/.exec(e)||/(version)(applewebkit)[/]([\w.]+).*(safari)[/]([\w.]+)/.exec(e)||/(webkit)[/]([\w.]+).*(version)[/]([\w.]+).*(safari)[/]([\w.]+)/.exec(e)||/(webkit)[/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(firefox)[/]([\w.]+)/.exec(e)||[],i=/(ipad)/.exec(e)||/(ipod)/.exec(e)||/(windows phone)/.exec(e)||/(iphone)/.exec(e)||/(kindle)/.exec(e)||/(android)/.exec(e)||/(windows)/.exec(e)||/(mac)/.exec(e)||/(linux)/.exec(e)||/(cros)/.exec(e)||[],n={browser:t[5]||t[3]||t[1]||"",version:t[2]||t[4]||"0",majorVersion:t[4]||t[2]||"0",platform:i[0]||""},a=Object.create(null);if(n.browser){a[n.browser]=!0;var s=n.majorVersion.split(".");a.version={major:parseInt(n.majorVersion,10),string:n.version},s.length>1&&(a.version.minor=parseInt(s[1],10)),s.length>2&&(a.version.build=parseInt(s[2],10))}if(n.platform&&(a[n.platform]=!0),(a.chrome||a.opr||a.safari)&&(a.webkit=!0),a.rv||a.iemobile){a.rv&&delete a.rv;n.browser="msie",a.msie=!0}if(a.edge){delete a.edge;n.browser="msedge",a.msedge=!0}if(a.opr){n.browser="opera",a.opera=!0}if(a.safari&&a.android){n.browser="android",a.android=!0}return a.name=n.browser,a.platform=n.platform,a}();t.a=a},function(e,t,i){"use strict";t.a={INIT:"INIT",START:"START",STOP:"STOP",SEEK:"SEEK",PAUSE:"PAUSE",RESUME:"RESUME",DESTROY:"DESTROY",LOG_CONFIG_CHANGE:"LOG_CONFIG_CHANGE"}},function(e,t,i){"use strict";t.a={UN_SUPPORT_MEDIA:"UN_SUPPORT_MEDIA",NETWORK_ERROR:"NETWORK_ERROR",TRANSMUXING_ERROR:"TRANSMUXING_ERROR",IO_ERROR:"IO_ERROR",OK:"OK",EXCEPTION:"EXCEPTION",HTTP_STATUS_CODE_INVALID:"HTTP_STATUS_CODE_INVALID",CONNECTING_TIMEOUT:"CONNECTING_TIMEOUT",EARLY_EOF:"EARLY_EOF",UNRECOVERABLE_EARLY_EOF:"UNRECOVERABLE_EARLY_EOF",MEDIA_ERROR:"MEDIA_ERROR",MEDIA_MSE_ERROR:"MEDIA_MSE_ERROR",FORMAT_ERROR:"FORMAT_ERROR",FORMAT_UNSUPPORTED:"FORMAT_UNSUPPORTED",CODEC_UNSUPPORTED:"CODEC_UNSUPPORTED"}},function(e,t,i){"use strict";var n;!function(e){e.LOADING_ERROR="LOADING_ERROR",e.LOAD_COMPLETE="LOAD_COMPLETE",e.MANIFEST_PARSED="MANIFEST_PARSED",e.DEMUXER_PUSH="DEMUXER_PUSH",e.PARSE_SUCCESS="PARSE_SUCCESS",e.PARSE_ERROR="PARSE_ERROR",e.GET_TS_URL="GET_TS_URL",e.LOADIND_TIMEOUT="LOADIND_TIMEOUT"}(n||(n={})),t.a=n},function(e,t,i){"use strict";var n=i(4),r=i.n(n),a=i(3),s=i(2),o=function(){function e(e,t){this.Tag="BaseLoader",this.supportType=t,this._type=e||"undefined",this._status=s.a.kIdle,this._needStash=!1,this._onContentLengthKnown=null,this._onURLRedirect=null,this._onDataArrival=null,this._onError=null,this._onComplete=null,this.eventEmitter=new r.a}return e.prototype.on=function(e,t){this.eventEmitter.on(e,t)},e.prototype.once=function(e,t){this.eventEmitter.once(e,t)},e.prototype.off=function(e,t){this.eventEmitter.off(e,t)},e.prototype.destroy=function(){this.eventEmitter.removeAllListeners(),delete this.eventEmitter,this._status=s.a.kIdle,this._onContentLengthKnown=null,this._onURLRedirect=null,this._onDataArrival=null,this._onError=null,this._onComplete=null},e.prototype.isWorking=function(){return this._status===s.a.kConnecting||this._status===s.a.kBuffering},Object.defineProperty(e.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"status",{get:function(){return this._status},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"needStashBuffer",{get:function(){return this._needStash},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onContentLengthKnown",{get:function(){return this._onContentLengthKnown},set:function(e){this._onContentLengthKnown=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onURLRedirect",{get:function(){return this._onURLRedirect},set:function(e){this._onURLRedirect=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onDataArrival",{get:function(){return this._onDataArrival},set:function(e){this._onDataArrival=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onError",{get:function(){return this._onError},set:function(e){this._onError=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onComplete",{get:function(){return this._onComplete},set:function(e){this._onComplete=e},enumerable:!1,configurable:!0}),e.prototype.startLoad=function(e,t){throw new a.c("Unimplemented abstract function!")},e.prototype.abort=function(){throw new a.c("Unimplemented abstract function!")},e}();t.a=o},function(e,t,i){"use strict";var n=function(e,t,i,n,r){this.dts=e,this.pts=t,this.duration=i,this.originalDts=n,this.isSyncPoint=r,this.fileposition=null};t.a=n},function(e,t,i){"use strict";var n=i(4),r=i.n(n),a=i(0),s=i(1),o=function(){function e(){}return Object.defineProperty(e,"forceGlobalTag",{get:function(){return a.a.config.FORCE_GLOBAL_TAG||!1},set:function(t){a.a.config.FORCE_GLOBAL_TAG=t,e._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(e,"globalTag",{get:function(){return a.a.GLOBAL_TAG},set:function(t){a.a.GLOBAL_TAG=t,e._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(e,"enableAll",{get:function(){return a.a.config.ENABLE_DEBUG&&a.a.config.ENABLE_INFO&&a.a.config.ENABLE_WARN&&a.a.config.ENABLE_ERROR},set:function(t){a.a.config.ENABLE_DEBUG=t,a.a.config.ENABLE_INFO=t,a.a.config.ENABLE_WARN=t,a.a.config.ENABLE_ERROR=t,e._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(e,"enableDebug",{get:function(){return a.a.config.ENABLE_DEBUG},set:function(t){a.a.config.ENABLE_DEBUG=t,e._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(e,"enableInfo",{get:function(){return a.a.config.ENABLE_INFO},set:function(t){a.a.config.ENABLE_INFO=t,e._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(e,"enableWarn",{get:function(){return a.a.config.ENABLE_WARN},set:function(t){a.a.config.ENABLE_WARN=t,e._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(e,"enableError",{get:function(){return a.a.config.ENABLE_ERROR},set:function(t){a.a.config.ENABLE_ERROR=t,e._notifyChange()},enumerable:!1,configurable:!0}),e.getConfig=function(){return{globalTag:a.a.GLOBAL_TAG,forceGlobalTag:a.a.config.FORCE_GLOBAL_TAG,enableDebug:a.a.config.ENABLE_DEBUG,enableInfo:a.a.config.ENABLE_INFO,enableWarn:a.a.config.ENABLE_WARN,enableError:a.a.config.ENABLE_ERROR,enableCallback:a.a.config.ENABLE_CALLBACK}},e.applyConfig=function(e){a.a.GLOBAL_TAG=e.GLOBAL_TAG||"HJPLAYER",a.a.config.FORCE_GLOBAL_TAG=e.FORCE_GLOBAL_TAG,a.a.config.ENABLE_DEBUG=e.ENABLE_DEBUG,a.a.config.ENABLE_INFO=e.ENABLE_INFO,a.a.config.ENABLE_WARN=e.ENABLE_WARN,a.a.config.ENABLE_ERROR=e.ENABLE_ERROR,a.a.config.ENABLE_CALLBACK=e.ENABLE_CALLBACK},e._notifyChange=function(){var t=e.emitter;if(t.listenerCount("change")>0){var i=e.getConfig();t.emit("change",i)}},e.registerListener=function(t){e.emitter.addListener("change",t)},e.removeListener=function(t){e.emitter.removeListener("change",t)},e.addLogListener=function(t){a.a.emitter.addListener(s.a.HJ_PLAYER_LOG,t),a.a.emitter.listenerCount(s.a.HJ_PLAYER_LOG)>0&&(a.a.config.ENABLE_CALLBACK=!0,e._notifyChange())},e.removeLogListener=function(t){a.a.emitter.removeListener(s.a.HJ_PLAYER_LOG,t),0===a.a.emitter.listenerCount(s.a.HJ_PLAYER_LOG)&&(a.a.config.ENABLE_CALLBACK=!1,e._notifyChange())},e}();o.emitter=new r.a,t.a=o},function(e,t,i){"use strict";var n=i(4),r=i.n(n),a=i(7),s=i(19),o=i(9),u=i(24),h=i(1),d=function(){return{forceKeyFrameOnDiscontinuity:!0,maxAudioFramesDrift:1,maxBufferHole:.5,maxFragLookUpTolerance:.25,stretchShortVideoTrack:!1}},l=i(0),c=i(17),f=i(16),p=i(5),m=function(){return(m=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var r in t=arguments[i])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},_=Object(p.a)(),g=function(){function e(e,t,i,n){this.Tag="TransmuxingController",this._emitter=new r.a,this._config=t,this.typeSupported=i,this.navigator=n,this._mediaCodec=null,"boolean"!=typeof e.cors&&(e.cors=!0),"boolean"!=typeof e.withCredentials&&(e.withCredentials=!1),this._mediaDataSource=e;var a=0;this._currentSegmentIndex=0,e.segments||(this._mediaDataSource.segments=[{duration:e.duration,filesize:e.fileSize,url:e.url,type:e.type,live:t.isLive}]),this._mediaDataSource.segments.forEach((function(i){i.timestampBase=a,a+=i.duration,i.cors=e.cors,i.withCredentials=e.withCredentials,t.referrerPolicy&&(i.referrerPolicy=t.referrerPolicy)})),Number.isNaN(a)||this._mediaDataSource.duration===a||(this._mediaDataSource.duration=a),this._mediaInfo=null,this._mediaCodec=null,this._ioctl=null,this._pendingSeekTime=null,this._pendingResolveSeekPoint=null,this._statisticsReportTimer=null}return e.prototype.destroy=function(){this._mediaInfo=null,delete this._mediaDataSource,this._statisticsReportTimer&&this._disableStatisticsReporter(),this._ioctl&&(this._ioctl.destroy(),this._ioctl=null),this._mediaCodec&&(this._mediaCodec.destroy(),this._mediaCodec=null),this._emitter.removeAllListeners(),delete this._emitter},e.prototype.on=function(e,t){this._emitter.on(e,t)},e.prototype.off=function(e,t){this._emitter.off(e,t)},e.prototype.start=function(){this._loadSegment(0),this._enableStatisticsReporter()},e.prototype._loadSegment=function(e,t){this._currentSegmentIndex=e;var i=this._mediaDataSource.segments[e];this._ioctl=new u.a(i,this._config,e);var n=this._ioctl;n.onError=this._onIOException.bind(this),n.onSeeked=this._onIOSeeked.bind(this),n.onComplete=this._onIOComplete.bind(this),n.onRedirect=this._onIORedirect.bind(this),n.onRecoveredEarlyEof=this._onIORecoveredEarlyEof.bind(this),n.onManifestParsed=this._onManifestParsed.bind(this),t&&this._mediaCodec?this._mediaCodec.bindDataSource(this._ioctl):n.onDataArrival=this._onInitChunkArrival.bind(this),n.open(t)},e.prototype.stop=function(){this._internalAbort(),this._disableStatisticsReporter()},e.prototype._internalAbort=function(){this._ioctl&&(this._ioctl.destroy(),this._ioctl=null)},e.prototype.pause=function(){this._ioctl&&this._ioctl.isWorking()&&(this._ioctl.pause(),this._disableStatisticsReporter())},e.prototype.resume=function(){this._ioctl&&this._ioctl.isPaused()&&(this._ioctl.resume(),this._enableStatisticsReporter())},e.prototype.seek=function(e){if("m3u8"===this._mediaDataSource.type)this._ioctl&&this._ioctl.tsSeek(e),this.resume();else{if(null==this._mediaInfo||!this._mediaInfo.isSeekable())return;var t=this._searchSegmentIndexContains(e);if(t===this._currentSegmentIndex){var i=this._mediaInfo.segments?this._mediaInfo.segments[t]:void 0;if(i){var n=i.getNearestKeyframe(e);this._mediaCodec&&this._mediaCodec.seek(n.milliseconds),this._ioctl&&this._ioctl.seek(n.fileposition),this._pendingResolveSeekPoint=n.milliseconds}else this._pendingSeekTime=e}else{var r=this._mediaInfo.segments&&this._mediaInfo.segments[t]?this._mediaInfo.segments[t]:void 0;if(void 0===r)this._pendingSeekTime=e,this._internalAbort(),this._mediaCodec&&(this._mediaCodec.seek(),this._mediaCodec.insertDiscontinuity()),this._loadSegment(t);else{n=r.getNearestKeyframe(e);this._internalAbort(),this._mediaCodec&&(this._mediaCodec.seek(),this._mediaCodec.insertDiscontinuity(),this._mediaCodec.resetMediaInfo(),this._mediaCodec.timestampBase=this._mediaDataSource.segments[t].timestampBase),this._loadSegment(t,n.fileposition),this._pendingResolveSeekPoint=n.milliseconds,this._reportSegmentMediaInfo(t)}}}this._enableStatisticsReporter()},e.prototype._searchSegmentIndexContains=function(e){for(var t=this._mediaDataSource.segments,i=t.length-1,n=0;n<t.length;n++)if(e<t[n].timestampBase){i=n-1;break}return i},e.prototype._onInitChunkArrival=function(e,t,i){var n=this;if(t>0&&this._mediaCodec)return this._mediaCodec.bindDataSource(this._ioctl),this._mediaCodec.timestampBase=this._mediaDataSource.segments[this._currentSegmentIndex].timestampBase,this._mediaCodec.parseChunks(e,t,i);if(f.a.probe(e).match){this._mediaCodec=new f.a(e,this._config);var r=this._mediaDataSource;return void 0===r.duration||Number.isNaN(r.duration)||(this._mediaCodec.overridedDuration=r.duration),"boolean"==typeof r.hasAudio&&(this._mediaCodec.overridedHasAudio=r.hasAudio),"boolean"==typeof r.hasVideo&&(this._mediaCodec.overridedHasVideo=r.hasVideo),this._mediaCodec.timestampBase=r.segments[this._currentSegmentIndex].timestampBase,this._mediaCodecBindEvents(),this._mediaCodec.bindDataSource(this._ioctl),this._mediaCodec.parseChunks(e,t)}return c.a.probe(e)?(this._mediaCodec=new c.a(d(),this.typeSupported,this.navigator),this._mediaCodecBindEvents(),this._mediaCodec.resetInitSegment(new Uint8Array(i.initSegmentData),i.audioCodec,i.videoCodec,i.totalduration),this._mediaCodec.resetTimeStamp(void 0),this._mediaCodec.bindDataSource(this._ioctl),this._mediaCodec.parseChunks(new Uint8Array(e),t,i),e.byteLength):(null,l.a.error(this.Tag,"Unsupported media type, this "+this._mediaDataSource.type+" stream is not standard format"),Promise.resolve().then((function(){n._internalAbort()})),this._emitter.emit(h.a.DEMUX_ERROR,o.a.FORMAT_UNSUPPORTED,"Unsupported media type, this "+this._mediaDataSource.type+" stream is not standard format!"),0)},e.prototype._onMediaInfo=function(e){var t=this;null===this._mediaInfo&&(this._mediaInfo=m({},e),this._mediaInfo.keyframesIndex=null,this._mediaInfo.segments=[],this._mediaInfo.segmentCount=this._mediaDataSource.segments.length,Object.setPrototypeOf(this._mediaInfo,s.a.prototype));var i=m({},e);Object.setPrototypeOf(i,s.a.prototype),this._mediaInfo.segments[this._currentSegmentIndex]=i,this._reportSegmentMediaInfo(this._currentSegmentIndex),null!=this._pendingSeekTime&&Promise.resolve().then((function(){var e=Number(t._pendingSeekTime);t._pendingSeekTime=null,t.seek(e)}))},e.prototype._onMetaDataArrived=function(e){this._emitter.emit(h.a.METADATA_ARRIVED,e)},e.prototype._onScriptDataArrived=function(e){this._emitter.emit(h.a.SCRIPTDATA_ARRIVED,e)},e.prototype._onIOSeeked=function(){this._mediaCodec&&this._mediaCodec.insertDiscontinuity()},e.prototype._onIOComplete=function(e){var t=e+1;this._mediaCodec&&(t<this._mediaDataSource.segments.length?(this._internalAbort(),this._mediaCodec.flushStashedSamples&&this._mediaCodec.flushStashedSamples(),this._loadSegment(t)):(this._mediaCodec.flushStashedSamples&&this._mediaCodec.flushStashedSamples(),this._emitter.emit(h.a.LOAD_COMPLETE),this._disableStatisticsReporter()))},e.prototype._onIORedirect=function(e){var t=this._ioctl.extraData;this._mediaDataSource.segments[t].redirectedURL=e},e.prototype._onIORecoveredEarlyEof=function(){this._emitter.emit(h.a.RECOVERED_EARLY_EOF)},e.prototype._onIOException=function(e,t){l.a.error(this.Tag,"IOException: type = "+e+", code = "+t.code+", msg = "+t.reason),this._emitter.emit(h.a.IO_ERROR,e,t),this._disableStatisticsReporter()},e.prototype._onDemuxException=function(e,t){l.a.error(this.Tag,"DemuxException: type = "+e+", info = "+t.reason),this._emitter.emit(h.a.DEMUX_ERROR,e,t)},e.prototype._onRemuxerInitSegmentArrival=function(e,t){this._emitter.emit(h.a.INIT_SEGMENT,e,t)},e.prototype._onRemuxerMediaSegmentArrival=function(e,t){if(null==this._pendingSeekTime&&(this._emitter.emit(h.a.MEDIA_SEGMENT,e,t),null!=this._pendingResolveSeekPoint&&"video"===e)){var i=t.info.syncPoints,n=this._pendingResolveSeekPoint;this._pendingResolveSeekPoint=null,a.a.safari&&i.length>0&&i[0].originalDts===n&&(n=i[0].pts),this._emitter.emit(h.a.RECOMMEND_SEEKPOINT,n)}},e.prototype._enableStatisticsReporter=function(){null==this._statisticsReportTimer&&(this._statisticsReportTimer=_.setInterval(this._reportStatisticsInfo.bind(this),this._config.statisticsInfoReportInterval))},e.prototype._disableStatisticsReporter=function(){this._statisticsReportTimer&&(_.clearInterval(this._statisticsReportTimer),this._statisticsReportTimer=null)},e.prototype._reportSegmentMediaInfo=function(e){var t=this._mediaInfo.segments[e],i=m({},t);i.duration=this._mediaInfo.duration,i.segmentCount=this._mediaInfo.segmentCount,delete i.segments,delete i.keyframesIndex,this._emitter.emit(h.a.MEDIA_INFO,i)},e.prototype._reportStatisticsInfo=function(){var e=Object.create(null);this._ioctl&&(e.url=this._ioctl.currentURL,e.hasRedirect=this._ioctl.hasRedirect,e.hasRedirect&&(e.redirectedURL=this._ioctl.currentRedirectedURL),e.speed=this._ioctl.currentSpeed,e.loaderType=this._ioctl.loaderType),e.currentSegmentIndex=this._currentSegmentIndex,e.totalSegmentCount=this._mediaDataSource.segments.length,this._emitter.emit(h.a.STATISTICS_INFO,e)},e.prototype._onManifestParsed=function(e){this._emitter.emit(h.a.MANIFEST_PARSED,e)},e.prototype._mediaCodecBindEvents=function(){var e=this;this._mediaCodec&&(this._mediaCodec.on(h.a.ERROR,(function(t){e._onDemuxException(o.a.TRANSMUXING_ERROR,t)})),this._mediaCodec.on(h.a.MEDIA_INFO,(function(t){e._onMediaInfo(t)})),this._mediaCodec.on(h.a.METADATA_ARRIVED,(function(t){e._onMetaDataArrived(t)})),this._mediaCodec.on(h.a.SCRIPTDATA_ARRIVED,(function(t){e._onScriptDataArrived(t)})),this._mediaCodec.on(h.a.GET_SEI_INFO,(function(t){e._emitter.emit(h.a.GET_SEI_INFO,t)})),this._mediaCodec.on(h.a.INIT_SEGMENT,(function(t,i){e._onRemuxerInitSegmentArrival(t,i)})),this._mediaCodec.on(h.a.MEDIA_SEGMENT,(function(t,i){e._onRemuxerMediaSegmentArrival(t,i)})),this._mediaCodec.on(h.a.LOAD_NEXT_FRAG,(function(){e._ioctl&&e._ioctl.isWorking()&&e._ioctl.loadNextFrag()})))},e}();t.a=g},function(e,t,i){"use strict";var n,r=i(4),a=i.n(r),s=i(11),o=i(21),u=i(0),h=i(23),d=i(10),l=i(25),c=i(2),f=i(6),p=i(3),m=i(5),_=(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),g=Object(m.a)(),y=function(e){function t(t,i){var n=e.call(this,"fragment-loader","m3u8")||this;return n.eventEmitter=new a.a,n.Tag="FragmentLoader",n.audioCodecSwitch=!1,n.levels=null,n.startFragRequested=!1,n.bitrateTest=!1,n.stats=null,n.stashFrag=[],n.sn=-1,n.loading=!1,n.masterLevels=[],n.currentFrag=null,n.loader=null,n._pause=!1,n.audioCodecSwap=!1,n._seekHandler=t,n._config=i,n._needStash=!0,n._requestAbort=!1,n._contentLength=null,n._receivedLength=0,n._parser=null,n.pl=null,n._dataSource=null,n._range=null,n}return _(t,e),t.isSupport=function(){return Object(l.a)()},t.prototype.on=function(e,t){this.eventEmitter.on(e,t)},t.prototype.once=function(e,t){this.eventEmitter.once(e,t)},t.prototype.off=function(e,t){this.eventEmitter.off(e,t)},Object.defineProperty(t.prototype,"onComplete",{get:function(){return this._onComplete},set:function(e){this._onComplete=e},enumerable:!1,configurable:!0}),t.prototype.destroy=function(){this.abort(),this.pl&&this.pl.abort(),this.pl=null,this.currentFrag=null,this.loader=null,this.bitrateTest=!1,this.eventEmitter.removeAllListeners(),delete this.masterLevels,delete this.eventEmitter,delete this.stashFrag,delete this.levels,delete this.stats},t.prototype.abort=function(){this._pause=!0,this._requestAbort=!0,this.loading=!1,this._status=c.a.kComplete,this.loader&&this.loader.abort()},t.prototype.pause=function(){this._pause=!0,this.loading=!1},t.prototype.resume=function(){u.a.debug(this.Tag,"恢复下载"),this._pause=!1,this._requestAbort=!1,this.loading=!1},t.prototype.isWorking=function(){return!1===this._pause},t.prototype.open=function(e,t){this._dataSource=e,this._range=t,this.pl=new h.a(e),this.pl.on(d.a.MANIFEST_PARSED,this.onManifestParsed.bind(this)),this.pl.on(d.a.LOAD_COMPLETE,this._loadingM3U8Complete.bind(this)),this.pl.on(d.a.LOADING_ERROR,this._loadingM3U8Error.bind(this)),this.pl.on(d.a.PARSE_ERROR,this._parseM3U8Error.bind(this)),this.pl.on(d.a.LOADIND_TIMEOUT,this._loadingM3U8Timeout.bind(this)),this.pl.load()},t.prototype.startLoad=function(e,t){this.open(e,t)},t.prototype.loadNextFrag=function(){if(!this._requestAbort&&!this._pause&&this.levels){if(!1===this.levels[0].details.live&&this.sn===this.levels[0].details.endSN)return this.pl&&this.pl.stop&&this.pl.stop(),void(this.onComplete&&this.onComplete());var e=this.stashFrag[0];if("initSegment"===this.sn){if(!(e=this.stashFrag[1]))return;this.loadFrag(e)}else{for(var t=0;t<this.stashFrag.length;t++)if(this.stashFrag[t].sn===this.sn+1){e=this.stashFrag[t];break}if(!e)return;this.sn<e.sn&&this.loadFrag(e)}}},t.prototype.loadFrag=function(e){if(!this.loading){this.loading=!0,this._status=c.a.kConnecting,this.currentFrag=e,this.sn=e.sn;var t={url:e.url,frag:e,responseType:"arraybuffer",progressData:!1};this.bitrateTest&&(e.url.indexOf("?")>-1?e.url+="&r="+Math.random():e.url+="?r="+Math.random());var i=e.byteRangeStartOffset,n=e.byteRangeEndOffset;Number.isFinite(i)&&Number.isFinite(n)&&(t.rangeStart=i,t.rangeEnd=n);var r={onSuccess:this._loadsuccess.bind(this),onError:this._loaderror.bind(this),onTimeout:this._loadtimeout.bind(this),onProgress:this._loadprogress.bind(this)};this.loader=null,this.loader=new o.a,this.loader.load(t,{timeout:1e4,maxRetry:1,retryDelay:200,maxRetryDelay:200},r)}},t.prototype.seek=function(e){var t=this.currentFrag,i=this._config.maxFragLookUpTolerance;if(this.currentFrag&&t&&this.loader&&this.levels&&!(this.status===c.a.kConnecting&&e>=1e3*(t.start+i)&&e<=1e3*(t.start+t.duration-i))){this.loader.abort();for(var n=0,r=this.stashFrag||[],a=0;a<r.length;a++)if(e>=1e3*r[a].start&&e<=1e3*(r[a].start+r[a].duration)){n=a;break}n=Math.max(n-1,0),this.currentFrag=r[n],this.sn=r[n].sn,this.loadFrag(r[n])}},t.prototype.onManifestParsed=function(e){var t,i=!1,n=!1;if(this.pl)if(e.levels.forEach((function(e){(t=e.audioCodec)&&(-1!==t.indexOf("mp4a.40.2")&&(i=!0),-1!==t.indexOf("mp4a.40.5")&&(n=!0))})),this.audioCodecSwitch=i&&n,this.audioCodecSwitch&&u.a.log(this.Tag,"both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),"masterPlaylist"===e.type&&e.levels.length>0){this._config.tsAutoLevelChoose&&(this.bitrateTest=!0);var r=this._dataSource;r.url=e.levels[0].url,this.masterLevels=e.levels,this.pl.dataSource=r,this.pl.url=e.levels[0].url,this.pl.load()}else if("levelPlaylist"===e.type)this.levels=e.levels,this.stashFrag=e.levels[0].details.fragments,this.startFragRequested=!1,this.loadNextFrag(),this.eventEmitter.emit(d.a.MANIFEST_PARSED,e.levels[0]);else{var a={code:-1,reason:"can not find useful playlist"};if(!this._onError)throw new p.d(a.reason);this._onError(d.a.LOADING_ERROR,a)}},t.prototype.onFragLoaded=function(e){var t=e.payload,i=e.frag;if(this.levels&&this.pl&&"main"===i.type){var n=e.stats,r=this.levels[0],a=r.details;if(this.stats=n,this.bitrateTest){this.startFragRequested=!1,n.tbuffered=g.performance.now(),n.tparsed=g.performance.now();var s=this._caluCodeRate(t.byteLength,n),o=this._findSuitableLevels(s);this.pl.url=this.masterLevels[o].url,this.pl.load(),this.bitrateTest=!1}else if("initSegment"===i.sn)n.tbuffered=g.performance.now(),n.tparsed=g.performance.now(),a.initSegment.data=e.payload,this.loadNextFrag();else{i.bitrateTest&&(i.bitrateTest=!1);var u=a.initSegment?a.initSegment.data:[],h=this._getAudioCodec(r),d=r.videoCodec,l=a.totalduration,c=this._receivedLength;this._receivedLength+=t.byteLength,this._onDataArrival&&this._onDataArrival(t,c,this._receivedLength,{initSegmentData:u,audioCodec:h,videoCodec:d,fragCurrent:i,totalduration:l,accurateTimeOffset:!1}),this._requestAbort&&this._pause&&(this.sn=this.sn-1,this.currentFrag=this.stashFrag[this.sn])}}},t.prototype._getAudioCodec=function(e){var t=this._config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&(u.a.log(this.Tag,"swapping playlist audio codec"),t&&(t=-1!==t.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5")),t},t.prototype._loadsuccess=function(e,t,i,n){void 0===n&&(n=null),this.loading=!1;var r=e.data,a=i.frag;this._status=c.a.kComplete,a&&this.onFragLoaded({payload:r,frag:a,stats:t,networkDetails:n})},t.prototype._loaderror=function(e,t,i){void 0===i&&(i=null),this.loading=!1,this._status=c.a.kError;var n={code:e.code,reason:e.text};if(!this._onError)throw new p.d(n.reason);this._onError(f.a.HTTP_STATUS_CODE_INVALID,n)},t.prototype._loadtimeout=function(e,t,i){void 0===i&&(i=null),this.loading=!1,this._status=c.a.kError;var n={code:-1,reason:"fragment request is timeout"};if(!this._onError)throw new p.d(n.reason);this._onError(f.a.CONNECTING_TIMEOUT,n)},t.prototype._loadprogress=function(e,t,i){void 0===i&&(i=null);t.frag},t.prototype._loadingM3U8Complete=function(){},t.prototype._loadingM3U8Error=function(e){this.loading=!1,this._status=c.a.kError;var t={code:e.response.code,reason:e.response.text};if(!this._onError)throw new p.d(t.reason);this._onError(f.a.HTTP_STATUS_CODE_INVALID,t)},t.prototype._loadingM3U8Timeout=function(e){this.loading=!1,this._status=c.a.kError;var t={code:-1,reason:e.stats.text};if(!this._onError)throw new p.d(t.reason);this._onError(f.a.CONNECTING_TIMEOUT,t)},t.prototype._caluCodeRate=function(e,t){var i=8*e/((t.tparsed-t.trequest)/1e3);return i*=.8},t.prototype._parseM3U8Error=function(e){this.loading=!1,this._status=c.a.kError;var t={code:-1,reason:"parse playlist error",url:e.url};if(!this._onError)throw new p.d(t.reason);this._onError(f.a.PARSE_PLAYLISTING_ERROR,t)},t.prototype._findSuitableLevels=function(e){for(var t=this.masterLevels,i=0,n=t.length-1;n>0;n--)if(t[n].bitrate<e){i=n;break}return i},t}(s.a);t.a=y},function(e,t,i){"use strict";var n=i(4),r=i.n(n);function a(e,t,i){var n=e;if(t+i<n.length){for(;i--;)if(128!=(192&n[++t]))return!1;return!0}return!1}var s,o=function(e){for(var t=[],i=e,n=0,r=e.length;n<r;)if(i[n]<128)t.push(String.fromCharCode(i[n])),++n;else{if(i[n]<192);else if(i[n]<224){if(a(i,n,1))if((s=(31&i[n])<<6|63&i[n+1])>=128){t.push(String.fromCharCode(65535&s)),n+=2;continue}}else if(i[n]<240){if(a(i,n,2))if((s=(15&i[n])<<12|(63&i[n+1])<<6|63&i[n+2])>=2048&&55296!=(63488&s)){t.push(String.fromCharCode(65535&s)),n+=3;continue}}else if(i[n]<248){var s;if(a(i,n,3))if((s=(7&i[n])<<18|(63&i[n+1])<<12|(63&i[n+2])<<6|63&i[n+3])>65536&&s<1114112){s-=65536,t.push(String.fromCharCode(s>>>10|55296)),t.push(String.fromCharCode(1023&s|56320)),n+=4;continue}}t.push(String.fromCharCode(65533)),++n}return t.join("")},u=(s=new ArrayBuffer(2),new DataView(s).setInt16(0,256,!0),256===new Int16Array(s)[0]),h=function(){function e(){}return e.parseScriptData=function(t,i,n){var r=Object.create(null);try{var a=e.parseValue(t,i,n),s=a.size||0,o=a.data||"",u=e.parseValue(t,i+s,n-s);r[o]=u.data}catch(e){}return r},e.parseObject=function(t,i,n){if(n<3)throw new Error("Data not enough when parse ScriptDataObject");var r=e.parseString(t,i,n),a=e.parseValue(t,i+r.size,n-r.size),s=a.size||0,o=a.objectEnd;return{data:{name:r.data,value:a.data},size:r.size+s,objectEnd:o}},e.parseVariable=function(t,i,n){return e.parseObject(t,i,n)},e.parseString=function(e,t,i){if(i<2)throw new Error("Data not enough when parse String");var n=new DataView(e,t,i).getUint16(0,!u);return{data:n>0?o(new Uint8Array(e,t+2,n)):"",size:2+n}},e.parseLongString=function(e,t,i){if(i<4)throw new Error("Data not enough when parse LongString");var n=new DataView(e,t,i).getUint32(0,!u);return{data:n>0?o(new Uint8Array(e,t+4,n)):"",size:4+n}},e.parseDate=function(e,t,i){if(i<10)throw new Error("Data size invalid when parse Date");var n=new DataView(e,t,i),r=n.getFloat64(0,!u),a=n.getInt16(8,!u);return{data:new Date(r+=60*a*1e3),size:10}},e.parseValue=function(t,i,n){if(n<1)throw new Error("Data not enough when parse Value");var r,a=new DataView(t,i,n),s=1,o=a.getUint8(0),h=!1;try{switch(o){case 0:r=a.getFloat64(1,!u),s+=8;break;case 1:r=!!a.getUint8(1),s+=1;break;case 2:var d=e.parseString(t,i+1,n-1);r=d.data,s+=d.size;break;case 3:r={};var l=0;for(9==(16777215&a.getUint32(n-4,!u))&&(l=3);s<n-4;){var c=e.parseObject(t,i+s,n-s-l);if(c.objectEnd)break;r[c.data.name]=c.data.value,s+=c.size}if(s<=n-3)9===(16777215&a.getUint32(s-1,!u))&&(s+=3);break;case 8:r={},s+=4;l=0;for(9==(16777215&a.getUint32(n-4,!u))&&(l=3);s<n-8;){var f=e.parseVariable(t,i+s,n-s-l);if(f.objectEnd)break;r[f.data.name]=f.data.value,s+=f.size}if(s<=n-3)9===(16777215&a.getUint32(s-1,!u))&&(s+=3);break;case 9:r=void 0,s=1,h=!0;break;case 10:r=[];var p=a.getUint32(1,!u);s+=4;for(var m=0;m<p;m++){var _=e.parseValue(t,i+s,n-s),g=_.size||0;r.push(_.data),s+=g}break;case 11:var y=e.parseDate(t,i+1,n-1);r=y.data,s+=y.size;break;case 12:var v=e.parseString(t,i+1,n-1);r=v.data,s+=v.size;break;default:s=n}}catch(e){}return{data:r,size:s,objectEnd:h}},e}(),d=i(0),l=function(){function e(e){this.Tag="ExpGolomb",this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}return e.prototype.loadWord=function(){var e=this.data,t=this.bytesAvailable,i=e.byteLength-t,n=new Uint8Array(4),r=Math.min(4,t);if(0===r)throw new Error("no bytes available");n.set(e.subarray(i,i+r)),this.word=new DataView(n.buffer).getUint32(0),this.bitsAvailable=8*r,this.bytesAvailable-=r},e.prototype.skipBits=function(e){var t;this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,e-=(t=e>>3)>>3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)},e.prototype.readBits=function(e){var t=Math.min(this.bitsAvailable,e),i=this.word>>>32-t;return e>32&&d.a.error(this.Tag,"Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0?this.word<<=t:this.bytesAvailable>0&&this.loadWord(),(t=e-t)>0&&this.bitsAvailable?i<<t|this.readBits(t):i},e.prototype.skipLZ=function(){var e;for(e=0;e<this.bitsAvailable;++e)if(0!=(this.word&2147483648>>>e))return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()},e.prototype.skipUEG=function(){this.skipBits(1+this.skipLZ())},e.prototype.skipEG=function(){this.skipBits(1+this.skipLZ())},e.prototype.readUEG=function(){var e=this.skipLZ();return this.readBits(e+1)-1},e.prototype.readEG=function(){var e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)},e.prototype.readBoolean=function(){return 1===this.readBits(1)},e.prototype.readUByte=function(){return this.readBits(8)},e.prototype.readUShort=function(){return this.readBits(16)},e.prototype.readUInt=function(){return this.readBits(32)},e.prototype.skipScalingList=function(e){var t,i=8,n=8;for(t=0;t<e;t++)0!==n&&(n=(i+this.readEG()+256)%256),i=0===n?i:n},e.prototype.readSPS=function(){var e,t,i,n=0,r=0,a=0,s=0,o=this.readUByte.bind(this),u=this.readBits.bind(this),h=this.readUEG.bind(this),d=this.readBoolean.bind(this),l=this.skipBits.bind(this),c=this.skipEG.bind(this),f=this.skipUEG.bind(this),p=this.skipScalingList.bind(this);o();var m=o();u(5);l(3);o();if(f(),100===m||110===m||122===m||244===m||44===m||83===m||86===m||118===m||128===m){var _=h();if(3===_&&l(1),f(),f(),l(1),d())for(t=3!==_?8:12,i=0;i<t;i++)d()&&p(i<6?16:64)}f();var g=h();if(0===g)h();else if(1===g)for(l(1),c(),c(),e=h(),i=0;i<e;i++)c();f(),l(1);var y=h(),v=h(),b=u(1);0===b&&l(1),l(1),d()&&(n=h(),r=h(),a=h(),s=h());var E=[1,1];if(d()&&d())switch(o()){case 1:E=[1,1];break;case 2:E=[12,11];break;case 3:E=[10,11];break;case 4:E=[16,11];break;case 5:E=[40,33];break;case 6:E=[24,11];break;case 7:E=[20,11];break;case 8:E=[32,11];break;case 9:E=[80,33];break;case 10:E=[18,11];break;case 11:E=[15,11];break;case 12:E=[64,33];break;case 13:E=[160,99];break;case 14:E=[4,3];break;case 15:E=[3,2];break;case 16:E=[2,1];break;case 255:E=[o()<<8|o(),o()<<8|o()];break;default:E=[1,1]}return{width:Math.ceil(16*(y+1)-2*n-2*r),height:(2-b)*(v+1)*16-(b?2:4)*(a+s),pixelRatio:E}},e.prototype.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},e}(),c=function(){function e(){}return e._ebsp2rbsp=function(e){for(var t=e,i=t.byteLength,n=new Uint8Array(i),r=0,a=0;a<i;a++)a>=2&&3===t[a]&&0===t[a-1]&&0===t[a-2]||(n[r]=t[a],r++);return new Uint8Array(n.buffer,0,r)},e.parseSPS=function(t){var i=e._ebsp2rbsp(t),n=new l(i);n.readUByte();var r=n.readUByte();n.readUByte();var a=n.readUByte();n.readUEG();var s=e.getProfileString(r),o=e.getLevelString(a),u=1,h=420,d=8;if((100===r||110===r||122===r||244===r||44===r||83===r||86===r||118===r||128===r||138===r||144===r)&&(3===(u=n.readUEG())&&n.readBits(1),u<=3&&(h=[0,420,422,444][u]),d=n.readUEG()+8,n.readUEG(),n.readBits(1),n.readBoolean()))for(var c=3!==u?8:12,f=0;f<c;f++)n.readBoolean()&&(f<6?e._skipScalingList(n,16):e._skipScalingList(n,64));n.readUEG();var p=n.readUEG();if(0===p)n.readUEG();else if(1===p){n.readBits(1),n.readUEG(),n.readUEG();var m=n.readUEG();for(f=0;f<m;f++)n.readUEG()}var _=n.readUEG();n.readBits(1);var g=n.readUEG(),y=n.readUEG(),v=n.readBits(1);0===v&&n.readBits(1),n.readBits(1);var b=0,E=0,S=0,A=0;n.readBoolean()&&(b=n.readUEG(),E=n.readUEG(),S=n.readUEG(),A=n.readUEG());var T=1,R=1,L=0,w=!0,C=0,O=0;if(n.readBoolean()){if(n.readBoolean()){var I=n.readUByte();I>0&&I<16?(T=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2][I-1],R=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1][I-1]):255===I&&(T=n.readUByte()<<8|n.readUByte(),R=n.readUByte()<<8|n.readUByte())}if(n.readBoolean()&&n.readBoolean(),n.readBoolean()&&(n.readBits(4),n.readBoolean()&&n.readBits(24)),n.readBoolean()&&(n.readUEG(),n.readUEG()),n.readBoolean()){var D=n.readBits(32),k=n.readBits(32);w=n.readBoolean(),L=(C=k)/(O=2*D)}}var P=1;1===T&&1===R||(P=T/R);var M=0,x=0;0===u?(M=1,x=2-v):(M=3===u?1:2,x=(1===u?2:1)*(2-v));var U=16*(g+1),N=16*(y+1)*(2-v);U-=(b+E)*M,N-=(S+A)*x;var B=Math.ceil(U*P);return n=null,{profileString:s,levelString:o,bitDepth:d,refFrames:_,chromaFormat:h,chromaFormatString:e.getChromaFormatString(h),frameRate:{fixed:w,fps:L,fpsDen:O,fpsNum:C},sarRatio:{width:T,height:R},codecSize:{width:U,height:N},presentSize:{width:B,height:N}}},e._skipScalingList=function(e,t){for(var i=8,n=8,r=0;r<t;r++)0!==n&&(n=(i+e.readUEG()+256)%256),i=0===n?i:n},e.getProfileString=function(e){switch(e){case 66:return"Baseline";case 77:return"Main";case 88:return"Extended";case 100:return"High";case 110:return"High10";case 122:return"High422";case 244:return"High444";default:return"Unknown"}},e.getLevelString=function(e){return(e/10).toFixed(1)},e.getChromaFormatString=function(e){switch(e){case 420:return"4:2:0";case 422:return"4:2:2";case 444:return"4:4:4";default:return"Unknown"}},e}(),f={ERROR:"ERROR",GET_SEI_INFO:"GET_SEI_INFO",FRAG_PARSED:"FRAG_PARSED",INIT_PTS_FOUND:"INIT_PTS_FOUND",FRAG_PARSING_INIT_SEGMENT:"FRAG_PARSING_INIT_SEGMENT",FRAG_PARSING_METADATA:"FRAG_PARSING_METADATA",FRAG_PARSING_USERDATA:"FRAG_PARSING_USERDATA",MEDIA_INFO:"MEDIA_INFO",MEDIA_DATA_ARRIVED:"MEDIA_DATA_ARRIVED",SCRIPT_DATA_ARRIVED:"SCRIPT_DATA_ARRIVED",INIT_SEGMENT:"INIT_SEGMENT",MEDIA_SEGMENT:"MEDIA_SEGMENT"},p="muxError",m="FormatError",_="CodecUnsupported",g=function(){function e(){this.mimeType=null,this.duration=null,this.hasAudio=null,this.hasVideo=null,this.audioCodec=null,this.videoCodec=null,this.audioDataRate=null,this.videoDataRate=null,this.audioSampleRate=null,this.audioChannelCount=null,this.width=null,this.height=null,this.fps=null,this.profile=null,this.level=null,this.refFrames=null,this.chromaFormat=null,this.sarNum=null,this.sarDen=null,this.metadata=null,this.segments=null,this.segmentCount=null,this.hasKeyframesIndex=null,this.keyframesIndex=null}return e.prototype.isComplete=function(){var e=!1===this.hasAudio||!0===this.hasAudio&&null!=this.audioCodec&&null!=this.audioSampleRate&&null!=this.audioChannelCount,t=!1===this.hasVideo||!0===this.hasVideo&&null!=this.videoCodec&&null!=this.width&&null!=this.height&&null!=this.fps&&null!=this.profile&&null!=this.level&&null!=this.refFrames&&null!=this.chromaFormat&&null!=this.sarNum&&null!=this.sarDen;return null!=this.mimeType&&null!=this.duration&&null!=this.metadata&&null!=this.hasKeyframesIndex&&e&&t},e.prototype.isSeekable=function(){return!0===this.hasKeyframesIndex},e.prototype.getNearestKeyframe=function(e){if(null==this.keyframesIndex)return null;var t=this.keyframesIndex,i=this._search(t.times,e);return{index:i,milliseconds:t.times[i],fileposition:t.filepositions[i]}},e.prototype._search=function(e,t){var i=0,n=e.length-1,r=0,a=0,s=n;for(t<e[0]&&(i=0,a=s+1);a<=s;){if((r=a+Math.floor((s-a)/2))===n||t>=e[r]&&t<e[r+1]){i=r;break}e[r]<t?a=r+1:s=r-1}return i},e}(),y=function(e,t){var i="function"==typeof Symbol&&e[Symbol.iterator];if(!i)return e;var n,r,a=i.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(n=a.next()).done;)s.push(n.value)}catch(e){r={error:e}}finally{try{n&&!n.done&&(i=a.return)&&i.call(a)}finally{if(r)throw r.error}}return s},v=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(y(arguments[t]));return e},b=function(){function e(){}return e.init=function(){e.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[],".mp3":[]},Object.keys(e.types).forEach((function(t){e.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]})),e.FTYP=new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49]),e.STSD_PREFIX=new Uint8Array([0,0,0,0,0,0,0,1]),e.STTS=new Uint8Array([0,0,0,0,0,0,0,0]),e.STCO=e.STTS,e.STSC=e.STTS,e.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),e.HDLR_VIDEO=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),e.HDLR_AUDIO=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),e.DREF=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),e.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),e.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])},e.box=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];for(var n=8,r=null,a=v(t),s=a.length,o=0;o<s;o++)n+=a[o].byteLength;(r=new Uint8Array(n))[0]=n>>>24&255,r[1]=n>>>16&255,r[2]=n>>>8&255,r[3]=255&n,r.set(e,4);var u=8;for(o=0;o<s;o++)r.set(a[o],u),u+=a[o].byteLength;return r},e.generateInitSegment=function(t){var i=e.box(e.types.ftyp,e.FTYP),n=e.moov(t),r=new Uint8Array(i.byteLength+n.byteLength);return r.set(i,0),r.set(n,i.byteLength),r},e.moov=function(t){var i=e.mvhd(t.timescale,t.duration),n=e.trak(t),r=e.mvex(t);return e.box(e.types.moov,i,n,r)},e.mvhd=function(t,i){return void 0===i&&(i=0),e.box(e.types.mvhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,t>>>24&255,t>>>16&255,t>>>8&255,255&t,i>>>24&255,i>>>16&255,i>>>8&255,255&i,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]))},e.trak=function(t){return e.box(e.types.trak,e.tkhd(t),e.mdia(t))},e.tkhd=function(t){var i=t.id,n=t.duration||0,r=t.presentWidth,a=t.presentHeight;return e.box(e.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,i>>>24&255,i>>>16&255,i>>>8&255,255&i,0,0,0,0,n>>>24&255,n>>>16&255,n>>>8&255,255&n,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,r>>>8&255,255&r,0,0,a>>>8&255,255&a,0,0]))},e.mdia=function(t){return e.box(e.types.mdia,e.mdhd(t),e.hdlr(t),e.minf(t))},e.mdhd=function(t){var i=t.timescale,n=t.duration||0;return e.box(e.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,i>>>24&255,i>>>16&255,i>>>8&255,255&i,n>>>24&255,n>>>16&255,n>>>8&255,255&n,85,196,0,0]))},e.hdlr=function(t){var i=null;return i="audio"===t.type?e.HDLR_AUDIO:e.HDLR_VIDEO,e.box(e.types.hdlr,i)},e.minf=function(t){var i=null;return i="audio"===t.type?e.box(e.types.smhd,e.SMHD):e.box(e.types.vmhd,e.VMHD),e.box(e.types.minf,i,e.dinf(),e.stbl(t))},e.dinf=function(){return e.box(e.types.dinf,e.box(e.types.dref,e.DREF))},e.stbl=function(t){return e.box(e.types.stbl,e.stsd(t),e.box(e.types.stts,e.STTS),e.box(e.types.stsc,e.STSC),e.box(e.types.stsz,e.STSZ),e.box(e.types.stco,e.STCO))},e.stsd=function(t){return"audio"===t.type?"mp3"===t.codec?e.box(e.types.stsd,e.STSD_PREFIX,e.mp3(t)):e.box(e.types.stsd,e.STSD_PREFIX,e.mp4a(t)):e.box(e.types.stsd,e.STSD_PREFIX,e.avc1(t))},e.mp3=function(t){var i=t.channelCount,n=t.audioSampleRate,r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,i,0,16,0,0,0,0,n>>>8&255,255&n,0,0]);return e.box(e.types[".mp3"],r)},e.mp4a=function(t){var i=t.channelCount,n=t.audioSampleRate,r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,i,0,16,0,0,0,0,n>>>8&255,255&n,0,0]);return e.box(e.types.mp4a,r,e.esds(t))},e.esds=function(t){var i=t.config||[],n=i.length,r=new Uint8Array([0,0,0,0,3,23+n,0,1,0,4,15+n,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([n]).concat(i).concat([6,1,2]));return e.box(e.types.esds,r)},e.avc1=function(t){var i=t.avcc,n=t.codecWidth,r=t.codecHeight,a=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,n>>>8&255,255&n,r>>>8&255,255&r,0,72,0,0,0,72,0,0,0,0,0,0,0,1,10,120,113,113,47,102,108,118,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]);return e.box(e.types.avc1,a,e.box(e.types.avcC,i))},e.mvex=function(t){return e.box(e.types.mvex,e.trex(t))},e.trex=function(t){var i=t.id,n=new Uint8Array([0,0,0,0,i>>>24&255,i>>>16&255,i>>>8&255,255&i,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return e.box(e.types.trex,n)},e.moof=function(t,i){return e.box(e.types.moof,e.mfhd(t.sequenceNumber),e.traf(t,i))},e.mfhd=function(t){var i=new Uint8Array([0,0,0,0,t>>>24&255,t>>>16&255,t>>>8&255,255&t]);return e.box(e.types.mfhd,i)},e.traf=function(t,i){var n=t.id,r=e.box(e.types.tfhd,new Uint8Array([0,0,0,0,n>>>24&255,n>>>16&255,n>>>8&255,255&n])),a=e.box(e.types.tfdt,new Uint8Array([0,0,0,0,i>>>24&255,i>>>16&255,i>>>8&255,255&i])),s=e.sdtp(t),o=e.trun(t,s.byteLength+16+16+8+16+8+8);return e.box(e.types.traf,r,a,o,s)},e.sdtp=function(t){for(var i=t.samples||[],n=i.length,r=new Uint8Array(4+n),a=0;a<n;a++){var s=i[a].flags;r[a+4]=s.isLeading<<6|s.dependsOn<<4|s.isDependedOn<<2|s.hasRedundancy}return e.box(e.types.sdtp,r)},e.trun=function(t,i){var n=t.samples||[],r=n.length,a=12+16*r,s=new Uint8Array(a);i+=8+a,s.set([0,0,15,1,r>>>24&255,r>>>16&255,r>>>8&255,255&r,i>>>24&255,i>>>16&255,i>>>8&255,255&i],0);for(var o=0;o<r;o++){var u=n[o].duration,h=n[o].size,d=n[o].flags,l=n[o].cts;s.set([u>>>24&255,u>>>16&255,u>>>8&255,255&u,h>>>24&255,h>>>16&255,h>>>8&255,255&h,d.isLeading<<2|d.dependsOn,d.isDependedOn<<6|d.hasRedundancy<<4|d.isNonSync,0,0,l>>>24&255,l>>>16&255,l>>>8&255,255&l],12+16*o)}return e.box(e.types.trun,s)},e.mdat=function(t){return e.box(e.types.mdat,t)},e}();b.init();var E=b,S=function(){function e(){}return e.getSilentFrame=function(e,t){if("mp4a.40.2"===e){if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null},e}(),A=i(5);function T(){return(T=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e}).apply(this,arguments)}var R={},L=Object(A.a)();!function(){var e=L.navigator.userAgent.toLowerCase(),t=/(edge)\/([\w.]+)/.exec(e)||/(opr)[/]([\w.]+)/.exec(e)||/(chrome)[/]([\w.]+)/.exec(e)||/(iemobile)[/]([\w.]+)/.exec(e)||/(version)(applewebkit)[/]([\w.]+).*(safari)[/]([\w.]+)/.exec(e)||/(webkit)[/]([\w.]+).*(version)[/]([\w.]+).*(safari)[/]([\w.]+)/.exec(e)||/(webkit)[/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(firefox)[/]([\w.]+)/.exec(e)||[],i=/(ipad)/.exec(e)||/(ipod)/.exec(e)||/(windows phone)/.exec(e)||/(iphone)/.exec(e)||/(kindle)/.exec(e)||/(android)/.exec(e)||/(windows)/.exec(e)||/(mac)/.exec(e)||/(linux)/.exec(e)||/(cros)/.exec(e)||[],n={browser:t[5]||t[3]||t[1]||"",version:t[2]||t[4]||"0",majorVersion:t[4]||t[2]||"0",platform:i[0]||""},r={};if(n.browser){r[n.browser]=!0;var a=n.majorVersion.split(".");r.version={major:parseInt(n.majorVersion,10),string:n.version},a.length>1&&(r.version.minor=parseInt(a[1],10)),a.length>2&&(r.version.build=parseInt(a[2],10))}if(n.platform&&(r[n.platform]=!0),(r.chrome||r.opr||r.safari)&&(r.webkit=!0),r.rv||r.iemobile){r.rv&&delete r.rv;n.browser="msie",r.msie=!0}if(r.edge){delete r.edge;n.browser="msedge",r.msedge=!0}if(r.opr){n.browser="opera",r.opera=!0}if(r.safari&&r.android){n.browser="android",r.android=!0}r.name=n.browser,r.platform=n.platform,Object.keys(R).forEach((function(e){delete R[e]})),T(R,r)}();var w=R,C=function(){function e(){this.beginDts=0,this.endDts=0,this.beginPts=0,this.endPts=0,this.originalBeginDts=0,this.originalEndDts=0,this.syncPoints=[],this.firstSample=null,this.lastSample=null}return e.prototype.appendSyncPoint=function(e){e.isSyncPoint=!0,this.syncPoints.push(e)},e}(),O=(function(){function e(){this._list=[]}e.prototype.clear=function(){this._list=[]},e.prototype.appendArray=function(e){var t=this._list;0!==e.length&&(t.length>0&&e[0].originalDts<t[t.length-1].originalDts&&this.clear(),Array.prototype.push.apply(t,e))},e.prototype.getLastSyncPointBeforeDts=function(e){if(0===this._list.length)return null;var t=this._list,i=0,n=t.length-1,r=0,a=0,s=n;for(e<t[0].dts&&(i=0,a=s+1);a<=s;){if((r=a+Math.floor((s-a)/2))===n||e>=t[r].dts&&e<t[r+1].dts){i=r;break}t[r].dts<e?a=r+1:s=r-1}return this._list[i]}}(),function(){function e(e){this._type=e,this._list=[],this._lastAppendLocation=-1}return Object.defineProperty(e.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"length",{get:function(){return this._list.length},enumerable:!1,configurable:!0}),e.prototype.isEmpty=function(){return 0===this._list.length},e.prototype.clear=function(){this._list=[],this._lastAppendLocation=-1},e.prototype._searchNearestSegmentBefore=function(e){var t=this._list;if(0===t.length)return-2;var i=t.length-1,n=0,r=0,a=i,s=0;if(e<t[0].originalBeginDts)return s=-1;for(;r<=a;){var o=t[n=r+Math.floor((a-r)/2)].lastSample,u=o?o.originalDts:0;if(n===i||e>u&&e<t[n+1].originalBeginDts){s=n;break}t[n].originalBeginDts<e?r=n+1:a=n-1}return s},e.prototype._searchNearestSegmentAfter=function(e){return this._searchNearestSegmentBefore(e)+1},e.prototype.append=function(e){var t=this._list,i=e,n=this._lastAppendLocation,r=0;-1!==n&&n<t.length&&i.originalBeginDts>=t[n].lastSample.originalDts&&(n===t.length-1||n<t.length-1&&i.originalBeginDts<t[n+1].originalBeginDts)?r=n+1:t.length>0&&(r=this._searchNearestSegmentBefore(i.originalBeginDts)+1),this._lastAppendLocation=r,this._list.splice(r,0,i)},e.prototype.getLastSegmentBefore=function(e){var t=this._searchNearestSegmentBefore(e);return t>=0?this._list[t]:null},e.prototype.getLastSampleBefore=function(e){var t=this.getLastSegmentBefore(e);return null!=t?t.lastSample:null},e.prototype.getLastSyncPointBefore=function(e){for(var t=this._searchNearestSegmentBefore(e),i=this._list[t].syncPoints;0===i.length&&t>0;)t--,i=this._list[t].syncPoints;return i.length>0?i[i.length-1]:null},e}()),I=i(12),D=function(e,t){var i="function"==typeof Symbol&&e[Symbol.iterator];if(!i)return e;var n,r,a=i.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(n=a.next()).done;)s.push(n.value)}catch(e){r={error:e}}finally{try{n&&!n.done&&(i=a.return)&&i.call(a)}finally{if(r)throw r.error}}return s},k=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(D(arguments[t]));return e},P=function(){function e(e,t){this.TAG="MP4Remuxer",this.TAG="MP4Remuxer",this.emitter=e,this._config=t,this._isLive=!0===t.isLive,this._dtsBase=-1,this._dtsBaseInited=!1,this._audioDtsBase=1/0,this._videoDtsBase=1/0,this._audioNextRefDts=void 0,this._audioNextDts=void 0,this._videoNextDts=void 0,this._audioStashedLastSample=null,this._videoStashedLastSample=null,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList=new O("audio"),this._videoSegmentInfoList=new O("video"),this._forceFirstIDR=w.chrome&&(w.version.major<50||50===w.version.major&&w.version.build<2661),this._fillSilentAfterSeek=w.msedge||w.msie,this._mp3UseMpegAudio=!w.firefox,this._fillAudioTimestampGap=this._config.fixAudioTimestampGap}return e.prototype.destroy=function(){this._dtsBase=-1,this._dtsBaseInited=!1,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList&&this._audioSegmentInfoList.clear(),this._audioSegmentInfoList=null,this._videoSegmentInfoList&&this._videoSegmentInfoList.clear(),this._videoSegmentInfoList=null},e.prototype.insertDiscontinuity=function(){this._videoNextDts=void 0,this._audioNextDts=void 0},e.prototype.seek=function(){this._audioStashedLastSample=null,this._videoStashedLastSample=null,this._videoSegmentInfoList&&this._videoSegmentInfoList.clear(),this._audioSegmentInfoList&&this._audioSegmentInfoList.clear()},e.prototype.remux=function(e,t){this._dtsBaseInited||this._calculateDtsBase(e,t),this._remuxVideo(t),this._remuxAudio(e)},e.prototype._onTrackMetadataReceived=function(e,t){var i=null,n="mp4",r=t.codec;if("audio"===e)this._audioMeta=t,"mp3"===t.codec&&this._mp3UseMpegAudio?(n="mpeg",r="",i=new Uint8Array):i=E.generateInitSegment(t);else{if("video"!==e)return;this._videoMeta=t,i=E.generateInitSegment(t)}this.emitter.emit(f.INIT_SEGMENT,e,{type:e,data:i.buffer,codec:r,container:e+"/"+n,mediaDuration:t.duration})},e.prototype._calculateDtsBase=function(e,t){this._dtsBaseInited||(e.samples&&e.samples.length&&(this._audioDtsBase=e.samples[0].dts),t.samples&&t.samples.length&&(this._videoDtsBase=t.samples[0].dts),this._dtsBase=Math.min(this._audioDtsBase,this._videoDtsBase),this._dtsBaseInited=!0)},e.prototype.flushStashedSamples=function(){var e=this._videoStashedLastSample,t=this._audioStashedLastSample,i={type:"video",id:1,sequenceNumber:0,samples:[],length:0};null!=e&&(i.samples.push(e),i.length=e.length);var n={type:"audio",id:2,sequenceNumber:0,samples:[],length:0};null!=t&&(n.samples.push(t),n.length=t.length),this._videoStashedLastSample=null,this._audioStashedLastSample=null,this._remuxVideo(i,!0),this._remuxAudio(n,!0)},e.prototype._remuxAudio=function(e,t){if(null!=this._audioMeta){var i,n,r=e,a=r.samples,s=-1,o=this._audioMeta.refSampleDuration,u="mp3"===this._audioMeta.codec&&this._mp3UseMpegAudio,h=this._dtsBaseInited&&void 0===this._audioNextDts,l=!1;if(a&&0!==a.length&&(1!==a.length||t)){var c=0,p=null,m=0;u?(c=0,m=r.length):(c=8,m=8+r.length);var _=null;if(a.length>1&&(_=a.pop())&&(m-=_.length),null!=this._audioStashedLastSample){var g=this._audioStashedLastSample;this._audioStashedLastSample=null,a.unshift(g),m+=g.length}null!=_&&(this._audioStashedLastSample=_);var y=a[0].dts-this._dtsBase;if(this._audioNextDts)i=y-this._audioNextDts;else if(this._audioSegmentInfoList&&this._audioSegmentInfoList.isEmpty())i=0,this._fillSilentAfterSeek&&this._videoSegmentInfoList&&!this._videoSegmentInfoList.isEmpty()&&"mp3"!==this._audioMeta.originalCodec&&(l=!0);else{var v=this._audioSegmentInfoList.getLastSampleBefore(y);if(null!=v){var b=y-(v.originalDts+v.duration);b<=3&&(b=0),i=y-(v.dts+v.duration+b)}else i=0}if(l){var A=y-i,T=this._videoSegmentInfoList.getLastSegmentBefore(y);if(null!=T&&T.beginDts<A){if(G=S.getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount)){var R=T.beginDts,L=A-T.beginDts;d.a.info(this.TAG,"InsertPrefixSilentAudio: dts: "+R+", duration: "+L),a.unshift({unit:G,dts:R,pts:R,cts:0,length:G.byteLength}),m+=G.byteLength}}else l=!1}for(var O=[],D=0;D<a.length;D++){var P=(g=a[D]).unit,M=g.dts-this._dtsBase,x=(R=M,!1),U=null,N=0;if(!(M<-.001)){if("mp3"!==this._audioMeta.codec){var B=M;this._audioNextRefDts&&(B=this._audioNextRefDts);var F=M-B;if(F<=-3*o){d.a.warn(this.TAG,"Dropping 1 audio frame (originalDts: "+M+" ms ,curRefDts: "+B+" ms)  due to delta: "+F+" ms overlap.");continue}if(F>=3*o&&this._fillAudioTimestampGap&&!w.safari){x=!0;var G,j=Math.floor(F/o);d.a.warn(this.TAG,"Large audio timestamp gap detected, may cause AV sync to drift. Silent frames will be generated to avoid unsync. originalDts: "+M+" ms, curRefDts: "+B+" ms, delta: "+Math.round(F)+" ms, generate: "+j+" frames"),R=Math.floor(B),N=Math.floor(B+o)-R,B+=o,null==(G=S.getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount))&&(d.a.warn(this.TAG,"Unable to generate silent frame for "+this._audioMeta.originalCodec+" with "+this._audioMeta.channelCount+" channels, repeat last frame"),G=P),U=[];for(var V=0;V<j;V++){var z=Math.floor(B),H=Math.floor(B+o)-z,K={dts:z,pts:z,cts:0,unit:G,size:G.byteLength,duration:H,originalDts:M,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}};U.push(K),m+=P.byteLength,B+=o}this._audioNextRefDts=B+o}else R=Math.floor(B),N=Math.floor(B+o)-R,this._audioNextRefDts=B+o}else{if(R=M-i,D!==a.length-1)N=a[D+1].dts-this._dtsBase-i-R;else if(null!=_)N=_.dts-this._dtsBase-i-R;else N=O.length>=1?O[O.length-1].duration:Math.floor(o)}-1===s&&(s=R),O.push({dts:R,pts:R,cts:0,unit:g.unit,size:g.unit.byteLength,duration:N,originalDts:M,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}}),x&&(O=k(O,U))}}if(0===O.length)return r.samples=[],void(r.length=0);u?p=new Uint8Array(m):((p=new Uint8Array(m))[0]=m>>>24&255,p[1]=m>>>16&255,p[2]=m>>>8&255,p[3]=255&m,p.set(E.types.mdat,4));for(D=0;D<O.length;D++){P=O[D].unit;p.set(P,c),c+=P.byteLength}var q=O[O.length-1];n=q.dts+q.duration,this._audioNextDts=n;var X=new C;X.beginDts=s,X.endDts=n,X.beginPts=s,X.endPts=n,X.originalBeginDts=O[0].originalDts,X.originalEndDts=q.originalDts+q.duration,X.firstSample=new I.a(O[0].dts,O[0].pts,O[0].duration,O[0].originalDts,!1),X.lastSample=new I.a(q.dts,q.pts,q.duration,q.originalDts,!1),this._isLive||this._audioSegmentInfoList.append(X),r.samples=O,r.sequenceNumber++;var Y,W=null;W=u?new Uint8Array:E.moof(r,s),r.samples=[],r.length=0,Y=u&&h?{type:"audio",data:this._mergeBoxes(W,p).buffer,sampleCount:O.length,info:X,timestampOffset:s}:{type:"audio",data:this._mergeBoxes(W,p).buffer,sampleCount:O.length,info:X},this.emitter.emit(f.MEDIA_SEGMENT,"audio",Y)}}},e.prototype._remuxVideo=function(e,t){if(null!=this._videoMeta){var i,n,r,a=e,s=a.samples,o=-1,u=-1;if(s&&0!==s.length&&(1!==s.length||t)){var h=8,d=null,l=8+e.length,c=null;if(s.length>1&&(c=s.pop())&&(l-=c.length),null!=this._videoStashedLastSample){var p=this._videoStashedLastSample;this._videoStashedLastSample=null,s.unshift(p),l+=p.length}null!=c&&(this._videoStashedLastSample=c);var m=s[0].dts-this._dtsBase;if(this._videoNextDts)i=m-this._videoNextDts;else if(this._videoSegmentInfoList&&this._videoSegmentInfoList.isEmpty())i=0;else{var _=this._videoSegmentInfoList&&this._videoSegmentInfoList.getLastSampleBefore(m);if(null!=_){var g=m-(_.originalDts+_.duration);g<=3&&(g=0),i=m-(_.dts+_.duration+g)}else i=0}for(var y=new C,v=[],b=0;b<s.length;b++){var S=(p=s[b]).dts-this._dtsBase,A=p.isKeyframe,T=S-i,R=p.cts,L=T+R;-1===o&&(o=T,u=L);var w=0;if(b!==s.length-1)w=s[b+1].dts-this._dtsBase-i-T;else if(null!=c)w=c.dts-this._dtsBase-i-T;else w=v.length>=1?v[v.length-1].duration:Math.floor(this._videoMeta.refSampleDuration);if(A){var O=new I.a(T,L,w,p.dts,!0);O.fileposition=p.fileposition,y.appendSyncPoint(O)}v.push({dts:T,pts:L,cts:R,isKeyframe:A,originalDts:S,units:p.units,size:p.length,duration:w,flags:{isLeading:0,dependsOn:A?2:1,isDependedOn:A?1:0,hasRedundancy:0,isNonSync:A?0:1}})}(d=new Uint8Array(l))[0]=l>>>24&255,d[1]=l>>>16&255,d[2]=l>>>8&255,d[3]=255&l,d.set(E.types.mdat,4);for(b=0;b<v.length;b++)for(var D=v[b].units;D.length;){var k=D.shift().data;d.set(k,h),h+=k.byteLength}var P=v[v.length-1];if(n=P.dts+P.duration,r=P.pts+P.duration,this._videoNextDts=n,y.beginDts=o,y.endDts=n,y.beginPts=u,y.endPts=r,y.originalBeginDts=v[0].originalDts,y.originalEndDts=P.originalDts+P.duration,y.firstSample=new I.a(v[0].dts,v[0].pts,v[0].duration,v[0].originalDts,v[0].isKeyframe),y.lastSample=new I.a(P.dts,P.pts,P.duration,P.originalDts,P.isKeyframe),this._isLive||this._videoSegmentInfoList&&this._videoSegmentInfoList.append(y),a.samples=v,a.sequenceNumber++,this._forceFirstIDR){var M=v[0].flags;M.dependsOn=2,M.isNonSync=0}var x=E.moof(a,o);a.samples=[],a.length=0,this.emitter.emit(f.MEDIA_SEGMENT,"video",{type:"video",data:this._mergeBoxes(x,d).buffer,sampleCount:v.length,info:y})}}},e.prototype._mergeBoxes=function(e,t){var i=new Uint8Array(e.byteLength+t.byteLength);return i.set(e,0),i.set(t,e.byteLength),i},e}();function M(e){return(M="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var x=function(){return(x=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var r in t=arguments[i])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},U=Object(A.a)();var N=function(){function e(t,i,n){var r=e.probe(t);this.eventEmitter=i,this.Tag="FLVCodec",this.type="FLVCodec",this.config=n,this.remuxer=new P(this.eventEmitter,this.config),this._onError=null,this._dataOffset=r.dataOffset,this._firstParse=!0,this._dispatch=!1,this._hasAudio=r.hasAudioTrack,this._hasVideo=r.hasVideoTrack,this._hasAudioFlagOverrided=!1,this._hasVideoFlagOverrided=!1,this._audioInitialMetadataDispatched=!1,this._videoInitialMetadataDispatched=!1,this._mediaInfo=new g,this._mediaInfo.hasAudio=this._hasAudio,this._mediaInfo.hasVideo=this._hasVideo,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._naluLengthSize=4,this._timestampBase=0,this._timescale=1e3,this._duration=0,this._durationOverrided=!1,this._referenceFrameRate={fixed:!0,fps:23.976,fpsNum:23976,fpsDen:1e3},this._flvSoundRateTable=[5500,11025,22050,44100,48e3],this._mpegSamplingRates=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],this._mpegAudioV10SampleRateTable=[44100,48e3,32e3,0],this._mpegAudioV20SampleRateTable=[22050,24e3,16e3,0],this._mpegAudioV25SampleRateTable=[11025,12e3,8e3,0],this._mpegAudioL1BitRateTable=[0,32,64,96,128,160,192,224,256,288,320,352,384,416,448,-1],this._mpegAudioL2BitRateTable=[0,32,48,56,64,80,96,112,128,160,192,224,256,320,384,-1],this._mpegAudioL3BitRateTable=[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],this._videoTrack={type:"video",id:1,sequenceNumber:0,samples:[],length:0},this._audioTrack={type:"audio",id:2,sequenceNumber:0,samples:[],length:0};this._littleEndian=function(){var e=new ArrayBuffer(2);return new DataView(e).setInt16(0,256,!0),256===new Int16Array(e)[0]}()}return e.prototype.parseChunks=function(t,i){var n=0,r=this._littleEndian;if(0===i){if(!(t.byteLength>13))return 0;n=e.probe(t).dataOffset||0}this._firstParse&&(this._firstParse=!1,i+n!==this._dataOffset&&d.a.warn(this.Tag,"First time parsing but chunk byteStart invalid!"),0!==(a=new DataView(t,n)).getUint32(0,!r)&&d.a.warn(this.Tag,"PrevTagSize0 !== 0 !!!"),n+=4);for(;n<t.byteLength;){this._dispatch=!0;var a=new DataView(t,n);if(n+11+4>t.byteLength)break;var s=a.getUint8(0),o=16777215&a.getUint32(0,!r);if(n+11+o+4>t.byteLength)break;if(8===s||9===s||18===s){var u=a.getUint8(4),h=a.getUint8(5),l=a.getUint8(6)|h<<8|u<<16|a.getUint8(7)<<24;0!==(16777215&a.getUint32(7,!r))&&d.a.warn(this.Tag,"Meet tag which has StreamID != 0!");var c=n+11;switch(s){case 8:this._parseAudioData(t,c,o,l);break;case 9:this._parseVideoData(t,c,o,l,i+n);break;case 18:this._parseScriptData(t,c,o);break;default:d.a.warn(this.Tag,"Unsupported tag type "+s+", skipped"),n+=11+o+4}var f=a.getUint32(11+o,!r);f!==11+o&&d.a.warn(this.Tag,"Invalid PrevTagSize "+f),n+=11+o+4}else d.a.warn(this.Tag,"Unsupported tag type "+s+", skipped"),n+=11+o+4}return this._isInitialMetadataDispatched()&&this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this.remuxer.remux(this._audioTrack,this._videoTrack),n},e.prototype._parseScriptData=function(e,t,i){var n=h.parseScriptData(e,t,i);if(void 0!==n.onMetaData){if(null==n.onMetaData||"object"!==M(n.onMetaData))return void d.a.warn(this.Tag,"Invalid onMetaData structure!");this._metadata&&d.a.warn(this.Tag,"Found another onMetaData tag!"),this._metadata=n;var r=n.onMetaData;if(this.eventEmitter.emit(f.MEDIA_DATA_ARRIVED,x({},r)),"boolean"==typeof r.hasAudio&&!1===this._hasAudioFlagOverrided&&(this._hasAudio=r.hasAudio,this._mediaInfo.hasAudio=this._hasAudio),"boolean"==typeof r.hasVideo&&!1===this._hasVideoFlagOverrided&&(this._hasVideo=r.hasVideo,this._mediaInfo.hasVideo=this._hasVideo),"number"==typeof r.audiodatarate&&(this._mediaInfo.audioDataRate=r.audiodatarate),"number"==typeof r.videodatarate&&(this._mediaInfo.videoDataRate=r.videodatarate),"number"==typeof r.width&&(this._mediaInfo.width=r.width),"number"==typeof r.height&&(this._mediaInfo.height=r.height),"number"==typeof r.duration){if(!this._durationOverrided){var a=Math.floor(r.duration*this._timescale);this._duration=a,this._mediaInfo.duration=a}}else this._mediaInfo.duration=0;if("number"==typeof r.framerate){var s=Math.floor(1e3*r.framerate);if(s>0){var o=s/1e3;this._referenceFrameRate.fixed=!0,this._referenceFrameRate.fps=o,this._referenceFrameRate.fpsNum=s,this._referenceFrameRate.fpsDen=1e3,this._mediaInfo.fps=o}}if("object"===M(r.keyframes)){this._mediaInfo.hasKeyframesIndex=!0;var u=r.keyframes;this._mediaInfo.keyframesIndex=this._parseKeyframesIndex(u),r.keyframes=null}else this._mediaInfo.hasKeyframesIndex=!1;this._dispatch=!1,this._mediaInfo.metadata=r,d.a.info(this.Tag,"Parsed onMetaData"),this._mediaInfo.isComplete()&&this.eventEmitter.emit(f.MEDIA_INFO,this._mediaInfo)}Object.keys(n).length>0&&this.eventEmitter.emit(f.SCRIPT_DATA_ARRIVED,x({},n))},e.prototype._parseKeyframesIndex=function(e){for(var t=[],i=[],n=1;n<e.times.length;n++){var r=this._timestampBase+Math.floor(1e3*e.times[n]);t.push(r),i.push(e.filepositions[n])}return{times:t,filepositions:i}},e.prototype._parseAudioData=function(e,t,i,n){if(i<=1)d.a.warn(this.Tag,"Flv: 无效的数据包, missing SoundData payload!");else if(!0!==this._hasAudioFlagOverrided||!1!==this._hasAudio){this._littleEndian;var r=new DataView(e,t,i).getUint8(0),a=r>>>4;if(2===a||10===a){var s=0,o=(12&r)>>>2;if(o>=0&&o<=4){s=this._flvSoundRateTable[o];var u=1&r,h=this._audioMetadata,l=this._audioTrack;if(h||(!1===this._hasAudio&&!1===this._hasAudioFlagOverrided&&(this._hasAudio=!0,this._mediaInfo.hasAudio=!0),this._audioMetadata=Object.create(null),(h=this._audioMetadata).type="audio",h.id=l.id,h.timescale=this._timescale,h.duration=this._duration,h.audioSampleRate=s,h.channelCount=0===u?1:2),10===a){var c=this._parseAACAudioData(e,t+1,i-1);if(void 0===c)return;if(0===c.packetType){if(h.config&&d.a.warn(this.Tag,"Found another AudioSpecificConfig!"),"object"===c.type){var g=c.data;h.audioSampleRate=g.samplingRate,h.channelCount=g.channelCount,h.codec=g.codec,h.originalCodec=g.originalCodec,h.config=g.config;var y=h.audioSampleRate||0,v=h.timescale||0;h.refSampleDuration=1024/y*v,d.a.info(this.Tag,"Parsed AudioSpecificConfig"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this.remuxer.remux(this._audioTrack,this._videoTrack):this._audioInitialMetadataDispatched=!0,this._dispatch=!1,this.remuxer._onTrackMetadataReceived("audio",h),(A=this._mediaInfo).audioCodec=h.originalCodec,A.audioSampleRate=h.audioSampleRate,A.audioChannelCount=h.channelCount,A.hasVideo?null!=A.videoCodec&&(A.mimeType='video/x-flv; codecs="'+A.videoCodec+","+A.audioCodec+'"'):A.mimeType='video/x-flv; codecs="'+A.audioCodec+'"',A.isComplete()&&this.eventEmitter.emit(f.MEDIA_INFO,A)}}else if(1===c.packetType){var b=c.data,E=this._timestampBase+n,S={unit:b,length:b.byteLength,dts:E,pts:E,cts:0};l.samples.push(S),l.length+=b.length}else d.a.error(this.Tag,"Flv: Unsupported AAC data type "+c.packetType)}else if(2===a){if(!h.codec){if(void 0===(g=this._parseMP3AudioData(e,t+1,i-1,!0))||g instanceof Uint8Array)return;h.audioSampleRate=g.samplingRate,h.channelCount=g.channelCount,h.codec=g.codec,h.originalCodec=g.originalCodec;var A,T=h.audioSampleRate||0,R=h.timescale||0;h.refSampleDuration=1152/T*R,d.a.info(this.Tag,"Parsed MPEG Audio Frame Header"),this._audioInitialMetadataDispatched=!0,this.remuxer._onTrackMetadataReceived("audio",h),(A=this._mediaInfo).audioCodec=h.codec,A.audioSampleRate=h.audioSampleRate,A.audioChannelCount=h.channelCount,A.audioDataRate=g.bitRate,A.hasVideo?null!=A.videoCodec&&(A.mimeType='video/x-flv; codecs="'+A.videoCodec+","+A.audioCodec+'"'):A.mimeType='video/x-flv; codecs="'+A.audioCodec+'"',A.isComplete()&&this.eventEmitter.emit(f.MEDIA_INFO,A)}var L=this._parseMP3AudioData(e,t+1,i-1,!1);if(void 0===L||!(L instanceof Uint8Array))return;E=this._timestampBase+n;var w={unit:L,length:L.byteLength,dts:E,pts:E,cts:0};l.samples.push(w),l.length+=L.length}}else this.eventEmitter.emit(f.ERROR,{type:p,details:m,fatal:!1,reason:"Flv: 音频采样率无效 idx: "+o})}else this.eventEmitter.emit(f.ERROR,{type:p,details:_,fatal:!1,reason:"Flv: 不支持的类型 idx: "+a})}},e.prototype._parseAACAudioData=function(e,t,i){if(!(i<=1)){var n=Object.create(null),r=new Uint8Array(e,t,i);return n.packetType=r[0],0===r[0]?(n.type="object",n.data=this._parseAACAudioSpecificConfig(e,t+1,i-1)):(n.type="Unit8Array",n.data=r.subarray(1)),n}d.a.warn(this.Tag,"Flv: Invalid AAC packet, missing AACPacketType or/and Data!")},e.prototype._parseAACAudioSpecificConfig=function(e,t,i){var n,r,a=new Uint8Array(e,t,i),s=null,o=0,u=null;if(o=n=a[0]>>>3,(r=(7&a[0])<<1|a[1]>>>7)<0||r>=this._mpegSamplingRates.length)this.eventEmitter.emit(f.ERROR,{type:p,details:m,fatal:!1,reason:"Flv: AAC invalid sampling frequency index!"});else{var h=this._mpegSamplingRates[r],d=(120&a[1])>>>3;if(!(d<0||d>=8)){5===o&&(u=(7&a[1])<<1|a[2]>>>7);var l=U.navigator.userAgent.toLowerCase();return-1!==l.indexOf("firefox")?r>=6?(o=5,s=new Array(4),u=r-3):(o=2,s=new Array(2),u=r):-1!==l.indexOf("android")?(o=2,s=new Array(2),u=r):(o=5,u=r,s=new Array(4),r>=6?u=r-3:1===d&&(o=2,s=new Array(2),u=r)),s[0]=o<<3,s[0]|=(15&r)>>>1,s[1]=(15&r)<<7,s[1]|=(15&d)<<3,5===o&&(s[1]|=(15&u)>>>1,s[2]=(1&u)<<7,s[2]|=8,s[3]=0),{config:s,samplingRate:h,channelCount:d,codec:"mp4a.40."+o,originalCodec:"mp4a.40."+n}}this.eventEmitter.emit(f.ERROR,{type:p,details:m,fatal:!1,reason:"Flv: AAC invalid channel configuration"})}},e.prototype._parseMP3AudioData=function(e,t,i,n){if(!(i<4)){this._littleEndian;var r=new Uint8Array(e,t,i),a=null;if(n){if(255!==r[0])return;var s=r[1]>>>3&3,o=(6&r[1])>>1,u=(240&r[2])>>>4,h=(12&r[2])>>>2,l=3!==(r[3]>>>6&3)?2:1,c=0,f=0;switch(s){case 0:c=this._mpegAudioV25SampleRateTable[h];break;case 2:c=this._mpegAudioV20SampleRateTable[h];break;case 3:c=this._mpegAudioV10SampleRateTable[h];break;default:c=this._mpegAudioV25SampleRateTable[h]}switch(o){case 1:34,u<this._mpegAudioL3BitRateTable.length&&(f=this._mpegAudioL3BitRateTable[u]);break;case 2:33,u<this._mpegAudioL2BitRateTable.length&&(f=this._mpegAudioL2BitRateTable[u]);break;case 3:32,u<this._mpegAudioL1BitRateTable.length&&(f=this._mpegAudioL1BitRateTable[u]);break;default:34,u<this._mpegAudioL3BitRateTable.length&&(f=this._mpegAudioL3BitRateTable[u])}a={bitRate:f,samplingRate:c,channelCount:l,codec:"mp3",originalCodec:"mp3"}}else a=r;return a}d.a.warn(this.Tag,"Flv: Invalid MP3 packet, header missing!")},e.prototype._parseVideoData=function(e,t,i,n,r){if(i<=1)d.a.warn(this.Tag,"Flv: Invalid video packet, missing VideoData payload!");else if(!0!==this._hasVideoFlagOverrided||!1!==this._hasVideo||!0===this.config.parseSei){var a=new Uint8Array(e,t,i)[0],s=(240&a)>>>4,o=15&a;7===o?this._parseAVCVideoPacket(e,t+1,i-1,n,r,s):this.eventEmitter.emit(f.ERROR,p,{type:p,code:-1,details:_,fatal:!1,reason:"Flv: Unsupported codec in video frame: "+o})}},e.prototype._parseAVCVideoPacket=function(e,t,i,n,r,a){if(i<4)d.a.warn(this.Tag,"Flv: Invalid AVC packet, missing AVCPacketType or/and CompositionTime");else{var s=this._littleEndian,o=new DataView(e,t,i),u=o.getUint8(0),h=(16777215&o.getUint32(0,!s))<<8>>8;0===u?!0!==this.config.parseSei&&this._parseAVCDecoderConfigurationRecord(e,t+4,i-4):1===u?this._parseAVCVideoData(e,t+4,i-4,n,r,a,h):2===u||this.eventEmitter.emit(f.ERROR,{type:p,details:m,fatal:!1,reason:"Flv: Invalid video packet type "+u})}},e.prototype._parseAVCDecoderConfigurationRecord=function(e,t,i){if(i<7)d.a.warn(this.Tag,"Flv: Invalid AVCDecoderConfigurationRecord, lack of data!");else{var n=this._videoMetadata,r=this._videoTrack,a=this._littleEndian,s=new DataView(e,t,i);n?void 0!==n.avcc&&d.a.warn(this.Tag,"Found another AVCDecoderConfigurationRecord!"):(!1===this._hasVideo&&!1===this._hasVideoFlagOverrided&&(this._hasVideo=!0,this._mediaInfo.hasVideo=!0),this._videoMetadata=Object.create(null),(n=this._videoMetadata).type="video",n.id=r.id,n.timescale=this._timescale,n.duration=this._duration);var o=s.getUint8(0),u=s.getUint8(1);s.getUint8(2),s.getUint8(3);if(1===o&&0!==u)if(this._naluLengthSize=1+(3&s.getUint8(4)),3===this._naluLengthSize||4===this._naluLengthSize){var h=31&s.getUint8(5);if(0!==h){h>1&&d.a.warn(this.Tag,"Flv: Strange AVCDecoderConfigurationRecord: SPS Count = "+h);for(var l=6,_=0;_<h;_++){var g=s.getUint16(l,!a);if(l+=2,0!==g){var y=new Uint8Array(e,t+l,g);l+=g;var v=c.parseSPS(y);if(0===_){n.codecWidth=v.codecSize.width,n.codecHeight=v.codecSize.height,n.presentWidth=v.presentSize.width,n.presentHeight=v.presentSize.height,n.profile=v.profileString,n.level=v.levelString,n.bitDepth=v.bitDepth,n.chromaFormat=v.chromaFormat,n.sarRatio=v.sarRatio,n.frameRate=v.frameRate,!1!==v.frameRate.fixed&&0!==v.frameRate.fpsNum&&0!==v.frameRate.fpsDen||(n.frameRate=this._referenceFrameRate);var b=n.frameRate,E=b.fpsDen,S=b.fpsNum;n.refSampleDuration=n.timescale*(E/S);for(var A=y.subarray(1,4),T="avc1.",R=0;R<3;R++){var L=A[R].toString(16);L.length<2&&(L="0"+L),T+=L}n.codec=T;var w=this._mediaInfo;w.width=n.codecWidth,w.height=n.codecHeight,w.fps=n.frameRate.fps,w.profile=n.profile,w.level=n.level,w.refFrames=v.refFrames,w.chromaFormat=v.chromaFormatString;var C=n.sarRatio;w.sarNum=C.width,w.sarDen=C.height,w.videoCodec=T,w.hasAudio?null!=w.audioCodec&&(w.mimeType='video/x-flv; codecs="'+w.videoCodec+","+w.audioCodec+'"'):w.mimeType='video/x-flv; codecs="'+w.videoCodec+'"',w.isComplete()&&this.eventEmitter.emit(f.MEDIA_INFO,w)}}}var O=s.getUint8(l);if(0!==O){O>1&&d.a.warn(this.Tag,"Flv: Strange AVCDecoderConfigurationRecord: PPS Count = "+O),l++;for(_=0;_<O;_++){g=s.getUint16(l,!a);l+=2,0!==g&&(l+=g)}n.avcc=new Uint8Array(i),n.avcc.set(new Uint8Array(e,t,i),0),d.a.info(this.Tag,"Parsed AVCDecoderConfigurationRecord"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this.remuxer.remux(this._audioTrack,this._videoTrack):this._videoInitialMetadataDispatched=!0,this._dispatch=!1,this.remuxer._onTrackMetadataReceived("video",n)}else this.eventEmitter.emit(f.ERROR,{type:p,details:m,fatal:!1,reason:"Flv: Invalid AVCDecoderConfigurationRecord: No PPS"})}else this.eventEmitter.emit(f.ERROR,{type:p,details:m,fatal:!1,reason:"Flv: Invalid AVCDecoderConfigurationRecord: No SPS"})}else this.eventEmitter.emit(f.ERROR,{type:p,details:m,fatal:!1,reason:"Flv: Strange NaluLengthSizeMinusOne: "+(this._naluLengthSize-1)});else this.eventEmitter.emit(f.ERROR,{type:p,details:m,fatal:!1,reason:"Flv: Invalid AVCDecoderConfigurationRecord"})}},e.prototype._parseAVCVideoData=function(e,t,i,n,r,a,s){for(var o=this._littleEndian,u=new DataView(e,t,i),h=[],l=0,c=0,p=this._naluLengthSize,m=this._timestampBase+n,_=1===a;c<i;){if(c+4>=i){d.a.warn(this.Tag,"Malformed Nalu near timestamp "+m+", offset = "+c+", dataSize = "+i);break}var g=u.getUint32(c,!o);if(3===p&&(g>>>=8),g>i-p)return void d.a.warn(this.Tag,"Malformed Nalus near timestamp "+m+", NaluSize > DataSize!");var y=31&u.getUint8(c+p);5===y&&(_=!0);var v=new Uint8Array(e,t+c,p+g),b={type:y,data:v};if(6===b.type||24===b.type)try{var E=v.subarray(p);this.eventEmitter.emit(f.GET_SEI_INFO,E)}catch(e){d.a.log(this.Tag,"parse sei info error!")}h.push(b),l+=v.byteLength,c+=p+g}if(h.length){var S=this._videoTrack,A={units:h,length:l,isKeyframe:_,dts:m,cts:s,pts:m+s};_&&(A.fileposition=r),S.samples.push(A),S.length+=l}},e.probe=function(e){var t=new Uint8Array(e),i={match:!1};if(70!==t[0]||76!==t[1]||86!==t[2]||1!==t[3])return i;var n,r,a=(4&t[4])>>>2!=0,s=0!=(1&t[4]),o=(n=t)[r=5]<<24|n[r+1]<<16|n[r+2]<<8|n[r+3];return o<9?i:{match:!0,consumed:o,dataOffset:o,hasAudioTrack:a,hasVideoTrack:s}},e.prototype.on=function(e,t){this.eventEmitter.on(e,t)},e.prototype.once=function(e,t){this.eventEmitter.once(e,t)},e.prototype.off=function(e,t){this.eventEmitter.off(e,t)},e.prototype.destroy=function(){this.eventEmitter.removeAllListeners(),delete this.eventEmitter},Object.defineProperty(e.prototype,"timestampBase",{get:function(){return this._timestampBase},set:function(e){this._timestampBase=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"overridedDuration",{get:function(){return this._duration},set:function(e){this._durationOverrided=!0,this._duration=e,this._mediaInfo.duration=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"overridedHasAudio",{set:function(e){this._hasAudioFlagOverrided=!0,this._hasAudio=e,this._mediaInfo.hasAudio=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"overridedHasVideo",{set:function(e){this._hasVideoFlagOverrided=!0,this._hasVideo=e,this._mediaInfo.hasVideo=e},enumerable:!1,configurable:!0}),e.prototype.resetMediaInfo=function(){this._mediaInfo=new g},e.prototype._isInitialMetadataDispatched=function(){return this._hasAudio&&this._hasVideo?this._audioInitialMetadataDispatched&&this._videoInitialMetadataDispatched:this._hasAudio&&!this._hasVideo?this._audioInitialMetadataDispatched:!(this._hasAudio||!this._hasVideo)&&this._videoInitialMetadataDispatched},e.prototype.insertDiscontinuity=function(){this.remuxer.insertDiscontinuity()},e.prototype.seek=function(){this.remuxer.seek()},e.prototype.flushStashedSamples=function(){this.remuxer.flushStashedSamples()},e}(),B={forceKeyFrameOnDiscontinuity:!0,maxBufferHole:.5,maxAudioFramesDrift:1,stretchShortVideoTrack:!1},F=function(){var e=window.MediaSource||window.WebKitMediaSource;return{mp4:e.isTypeSupported("video/mp4"),mpeg:e.isTypeSupported("audio/mpeg"),mp3:e.isTypeSupported('audio/mp4; codecs="mp3"')}};function G(){return(G=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e}).apply(this,arguments)}var j=function(){function e(e,t){this.Tag="FLVCodec",this.type="FLVCodec",this.eventEmitter=new r.a,this._config=G(Object.create(null),B,t),this._demuxer=new N(e,this.eventEmitter,t)}return e.prototype.appendData=function(e,t){this._demuxer.parseChunks(e,t)},e.prototype.resetMediaInfo=function(){this._demuxer.resetMediaInfo()},e.prototype.insertDiscontinuity=function(){this._demuxer.insertDiscontinuity()},e.prototype.seek=function(){this._demuxer.seek()},e.probe=function(e){return N.probe(new Uint8Array(e))},e.prototype.on=function(e,t){this.eventEmitter.on(e,t)},e.prototype.once=function(e,t){this.eventEmitter.once(e,t)},e.prototype.off=function(e,t){this.eventEmitter.off(e,t)},e.prototype.destroy=function(){this.eventEmitter.removeAllListeners(),this._demuxer.destroy(),delete this.eventEmitter},Object.defineProperty(e.prototype,"timestampBase",{set:function(e){this._demuxer.timestampBase=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"overridedDuration",{set:function(e){this._demuxer.overridedDuration=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"overridedHasAudio",{set:function(e){this._demuxer.overridedHasAudio=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"overridedHasVideo",{set:function(e){this._demuxer.overridedHasVideo=e},enumerable:!1,configurable:!0}),Object.defineProperty(e,"Events",{get:function(){return f},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"config",{get:function(){return this._config},enumerable:!1,configurable:!0}),Object.defineProperty(e,"typeSupportFunc",{get:function(){return F},enumerable:!1,configurable:!0}),e.prototype.flushStashedSamples=function(){this._demuxer.flushStashedSamples()},e.prototype.bindDataSource=function(e){return e.onDataArrival=this.parseChunks.bind(this),this},e.prototype.parseChunks=function(e,t){return this._demuxer.parseChunks(e,t)},e}();t.a=j},function(e,t,i){"use strict";var n=i(4),r=i.n(n),a=i(0),s="mediaError",o="muxError",u="fragParsingError",h="remuxAllocError",d=i(1);function l(e,t){return 255===e[t]&&240==(246&e[t+1])}function c(e,t){return 1&e[t+1]?7:9}function f(e,t){return(3&e[t+3])<<11|e[t+4]<<3|(224&e[t+5])>>>5}function p(e,t){return!!(t+1<e.length&&l(e,t))}function m(e,t,i,n,r){if(!e.samplerate){var o=function(e,t,i,n){var r,o,h,l,c=navigator.userAgent.toLowerCase(),f=n,p=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];r=1+((192&t[i+2])>>>6);var m=(60&t[i+2])>>>2;if(!(m>p.length-1))return h=(1&t[i+2])<<2,h|=(192&t[i+3])>>>6,a.a.log("adts","manifest codec:"+n+",ADTS data:type:"+r+",sampleingIndex:"+m+"["+p[m]+"Hz],channelConfig:"+h),/firefox/i.test(c)?m>=6?(r=5,l=new Array(4),o=m-3):(r=2,l=new Array(2),o=m):-1!==c.indexOf("android")?(r=2,l=new Array(2),o=m):(r=5,l=new Array(4),n&&(-1!==n.indexOf("mp4a.40.29")||-1!==n.indexOf("mp4a.40.5"))||!n&&m>=6?o=m-3:((n&&-1!==n.indexOf("mp4a.40.2")&&(m>=6&&1===h||/vivaldi/i.test(c))||!n&&1===h)&&(r=2,l=new Array(2)),o=m)),l[0]=r<<3,l[0]|=(14&m)>>1,l[1]|=(1&m)<<7,l[1]|=h<<3,5===r&&(l[1]|=(14&o)>>1,l[2]=(1&o)<<7,l[2]|=8,l[3]=0),{config:l,samplerate:p[m],channelCount:h,codec:"mp4a.40."+r,manifestCodec:f};e.emit(d.a.ERROR,{type:s,details:u,fatal:!0,reason:"invalid ADTS sampling index:"+m})}(t,i,n,r);if(!o)return;e.config=o.config,e.samplerate=o.samplerate,e.channelCount=o.channelCount,e.codec=o.codec,e.manifestCodec=o.manifestCodec,a.a.log("initTrackConfig","parsed codec:"+e.codec+",rate:"+o.samplerate+",nb channel:"+o.channelCount)}}function _(e){return 9216e4/e}function g(e,t,i,n,r){var a=function(e,t,i,n,r){var a,s=e.length,o=c(e,t);if(a=f(e,t),(a-=o)>0&&t+o+a<=s)return{headerLength:o,frameLength:a,stamp:i+n*r}}(t,i,n,r,_(e.samplerate));if(a){var s=a.stamp,o=a.headerLength,u=a.frameLength,h={unit:t.subarray(i+o,i+o+u),pts:s,dts:s};return e.samples.push(h),{sample:h,length:u+o}}}var y={BitratesMap:[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],SamplingRateMap:[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],SamplesCoefficients:[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],BytesInSlot:[0,1,1,4],appendFrame:function(e,t,i,n,r){if(!(i+24>t.length)){var a=this.parseHeader(t,i);if(a&&i+a.frameLength<=t.length){var s=n+r*(9e4*a.samplesPerFrame/a.sampleRate),o={unit:t.subarray(i,i+a.frameLength),pts:s,dts:s};return e.config=[],e.channelCount=a.channelCount,e.samplerate=a.sampleRate,e.samples.push(o),{sample:o,length:a.frameLength}}}},parseHeader:function(e,t){var i=e[t+1]>>3&3,n=e[t+1]>>1&3,r=e[t+2]>>4&15,a=e[t+2]>>2&3,s=e[t+2]>>1&1;if(1!==i&&0!==r&&15!==r&&3!==a){var o=void 0;o=3===i?3-n:3===n?3:4;var u=1e3*y.BitratesMap[14*o+r-1],h=void 0;h=3===i?0:2===i?1:2;var d=y.SamplingRateMap[3*h+a],l=e[t+3]>>6==3?1:2,c=y.SamplesCoefficients[i][n],f=y.BytesInSlot[n],p=8*c*f;return{sampleRate:d,channelCount:l,frameLength:parseInt(String(c*u/d+s),10)*f,samplesPerFrame:p}}},isHeaderPattern:function(e,t){return 255===e[t]&&224==(224&e[t+1])&&0!=(6&e[t+1])},isHeader:function(e,t){return!!(t+1<e.length&&this.isHeaderPattern(e,t))},probe:function(e,t){if(t+1<e.length&&this.isHeaderPattern(e,t)){var i=this.parseHeader(e,t),n=4;i&&i.frameLength&&(n=i.frameLength);var r=t+n;if(r===e.length||r+1<e.length&&this.isHeaderPattern(e,r))return!0}return!1}},v=y,b={ERROR:"ERROR",GET_SEI_INFO:"GET_SEI_INFO",FRAG_PARSED:"FRAG_PARSED",INIT_PTS_FOUND:"INIT_PTS_FOUND",FRAG_PARSING_INIT_SEGMENT:"FRAG_PARSING_INIT_SEGMENT",FRAG_PARSING_METADATA:"FRAG_PARSING_METADATA",FRAG_PARSING_USERDATA:"FRAG_PARSING_USERDATA",MEDIA_INFO:"MEDIA_INFO",INIT_SEGMENT:"INIT_SEGMENT",MEDIA_SEGMENT:"MEDIA_SEGMENT",LOAD_NEXT_FRAG:"LOAD_NEXT_FRAG",META_DATA:"META_DATA"},E=function(){function e(e){this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}return e.prototype.loadWord=function(){var e=this.data,t=this.bytesAvailable,i=e.byteLength-t,n=new Uint8Array(4),r=Math.min(4,t);if(0===r)throw new Error("no bytes available");n.set(e.subarray(i,i+r)),this.word=new DataView(n.buffer).getUint32(0),this.bitsAvailable=8*r,this.bytesAvailable-=r},e.prototype.skipBits=function(e){var t;this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,e-=(t=e>>3)>>3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)},e.prototype.readBits=function(t){var i=Math.min(this.bitsAvailable,t),n=this.word>>>32-i;return t>32&&a.a.error(e.Tag,"Cannot read more than 32 bits at a time"),this.bitsAvailable-=i,this.bitsAvailable>0?this.word<<=i:this.bytesAvailable>0&&this.loadWord(),(i=t-i)>0&&this.bitsAvailable?n<<i|this.readBits(i):n},e.prototype.skipLZ=function(){var e;for(e=0;e<this.bitsAvailable;++e)if(0!=(this.word&2147483648>>>e))return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()},e.prototype.skipUEG=function(){this.skipBits(1+this.skipLZ())},e.prototype.skipEG=function(){this.skipBits(1+this.skipLZ())},e.prototype.readUEG=function(){var e=this.skipLZ();return this.readBits(e+1)-1},e.prototype.readEG=function(){var e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)},e.prototype.readBoolean=function(){return 1===this.readBits(1)},e.prototype.readUByte=function(){return this.readBits(8)},e.prototype.readUShort=function(){return this.readBits(16)},e.prototype.readUInt=function(){return this.readBits(32)},e.prototype.skipScalingList=function(e){var t,i=8,n=8;for(t=0;t<e;t++)0!==n&&(n=(i+this.readEG()+256)%256),i=0===n?i:n},e.prototype.readSPS=function(){var e,t,i,n=0,r=0,a=0,s=0,o=this.readUByte.bind(this),u=this.readBits.bind(this),h=this.readUEG.bind(this),d=this.readBoolean.bind(this),l=this.skipBits.bind(this),c=this.skipEG.bind(this),f=this.skipUEG.bind(this),p=this.skipScalingList.bind(this);o();var m=o();u(5);l(3);o();if(f(),100===m||110===m||122===m||244===m||44===m||83===m||86===m||118===m||128===m){var _=h();if(3===_&&l(1),f(),f(),l(1),d())for(t=3!==_?8:12,i=0;i<t;i++)d()&&p(i<6?16:64)}f();var g=h();if(0===g)h();else if(1===g)for(l(1),c(),c(),e=h(),i=0;i<e;i++)c();f(),l(1);var y=h(),v=h(),b=u(1);0===b&&l(1),l(1),d()&&(n=h(),r=h(),a=h(),s=h());var E=[1,1];if(d()&&d())switch(o()){case 1:E=[1,1];break;case 2:E=[12,11];break;case 3:E=[10,11];break;case 4:E=[16,11];break;case 5:E=[40,33];break;case 6:E=[24,11];break;case 7:E=[20,11];break;case 8:E=[32,11];break;case 9:E=[80,33];break;case 10:E=[18,11];break;case 11:E=[15,11];break;case 12:E=[64,33];break;case 13:E=[160,99];break;case 14:E=[4,3];break;case 15:E=[3,2];break;case 16:E=[2,1];break;case 255:E=[o()<<8|o(),o()<<8|o()];break;default:E=[1,1]}return{width:Math.ceil(16*(y+1)-2*n-2*r),height:(2-b)*(v+1)*16-(b?2:4)*(a+s),pixelRatio:E}},e.prototype.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},e.Tag="ExpGolomb",e}();var S=function(e,t,i,n){return{key:e,pts:t,dts:i,units:[],debug:n,frame:!1}},A=function(){function e(){}return e.getSilentFrame=function(e,t){switch(e){case"mp4a.40.2":if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null},e}(),T=function(e,t){var i="function"==typeof Symbol&&e[Symbol.iterator];if(!i)return e;var n,r,a=i.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(n=a.next()).done;)s.push(n.value)}catch(e){r={error:e}}finally{try{n&&!n.done&&(i=a.return)&&i.call(a)}finally{if(r)throw r.error}}return s},R=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(T(arguments[t]));return e},L=Math.pow(2,32)-1,w=function(){function e(){}return e.init=function(){e.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},Object.keys(e.types).forEach((function(t){e.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]}));var t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),i=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);e.HDLR_TYPES={video:t,audio:i};var n=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),r=new Uint8Array([0,0,0,0,0,0,0,0]);e.STCO=r,e.STSC=r,e.STTS=r,e.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),e.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),e.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),e.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var a=new Uint8Array([105,115,111,109]),s=new Uint8Array([97,118,99,49]),o=new Uint8Array([0,0,0,1]);e.FTYP=e.box(e.types.ftyp,a,o,a,s),e.DINF=e.box(e.types.dinf,e.box(e.types.dref,n))},e.box=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];for(var n=t,r=8,a=n.length,s=a;a--;)r+=n[a].byteLength;var o=new Uint8Array(r);for(o[0]=r>>24&255,o[1]=r>>16&255,o[2]=r>>8&255,o[3]=255&r,o.set(e,4),a=0,r=8;a<s;a++)o.set(n[a],r),r+=n[a].byteLength;return o},e.hdlr=function(t){return e.box(e.types.hdlr,e.HDLR_TYPES[t])},e.mdat=function(t){return e.box(e.types.mdat,t)},e.mdhd=function(t,i){i*=t;var n=Math.floor(i/(L+1)),r=Math.floor(i%(L+1));return e.box(e.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,n>>24,n>>16&255,n>>8&255,255&n,r>>24,r>>16&255,r>>8&255,255&r,85,196,0,0]))},e.mdia=function(t){return e.box(e.types.mdia,e.mdhd(t.timescale,t.duration),e.hdlr(t.type),e.minf(t))},e.mfhd=function(t){return e.box(e.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))},e.minf=function(t){return"audio"===t.type?e.box(e.types.minf,e.box(e.types.smhd,e.SMHD),e.DINF,e.stbl(t)):e.box(e.types.minf,e.box(e.types.vmhd,e.VMHD),e.DINF,e.stbl(t))},e.moof=function(t,i,n){return e.box(e.types.moof,e.mfhd(t),e.traf(n,i))},e.moov=function(t){for(var i,n=t.length,r=[];n--;)r[n]=e.trak(t[n]);return(i=e.box).call.apply(i,R([null,e.types.moov,e.mvhd(t[0].timescale,t[0].duration)],r,[e.mvex(t)]))},e.mvex=function(t){for(var i,n=t.length,r=[];n--;)r[n]=e.trex(t[n]);return(i=e.box).call.apply(i,R([null,e.types.mvex],r))},e.mvhd=function(t,i){i*=t;var n=Math.floor(i/(L+1)),r=Math.floor(i%(L+1)),a=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,n>>24,n>>16&255,n>>8&255,255&n,r>>24,r>>16&255,r>>8&255,255&r,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return e.box(e.types.mvhd,a)},e.sdtp=function(t){var i,n,r=t.samples||[],a=new Uint8Array(4+r.length);for(n=0;n<r.length;n++)i=r[n].flags,a[n+4]=i.dependsOn<<4|i.isDependedOn<<2|i.hasRedundancy;return e.box(e.types.sdtp,a)},e.stbl=function(t){return e.box(e.types.stbl,e.stsd(t),e.box(e.types.stts,e.STTS),e.box(e.types.stsc,e.STSC),e.box(e.types.stsz,e.STSZ),e.box(e.types.stco,e.STCO))},e.avc1=function(t){var i,n,r,a=[],s=[];for(i=0;i<t.sps.length;i++)r=(n=t.sps[i]).byteLength,a.push(r>>>8&255),a.push(255&r),a=a.concat(Array.prototype.slice.call(n));for(i=0;i<t.pps.length;i++)r=(n=t.pps[i]).byteLength,s.push(r>>>8&255),s.push(255&r),s=s.concat(Array.prototype.slice.call(n));var o=e.box(e.types.avcC,new Uint8Array([1,a[3],a[4],a[5],255,224|t.sps.length].concat(a).concat([t.pps.length]).concat(s))),u=t.width,h=t.height,d=t.pixelRatio[0],l=t.pixelRatio[1];return e.box(e.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,u>>8&255,255&u,h>>8&255,255&h,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o,e.box(e.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),e.box(e.types.pasp,new Uint8Array([d>>24,d>>16&255,d>>8&255,255&d,l>>24,l>>16&255,l>>8&255,255&l])))},e.esds=function(e){var t=e.config?e.config.length:0;return new Uint8Array([0,0,0,0,3,23+t,0,1,0,4,15+t,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([t]).concat(e.config).concat([6,1,2]))},e.mp4a=function(t){var i=t.samplerate;return e.box(e.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,i>>8&255,255&i,0,0]),e.box(e.types.esds,e.esds(t)))},e.mp3=function(t){var i=t.samplerate;return e.box(e.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,i>>8&255,255&i,0,0]))},e.stsd=function(t){return"audio"===t.type?t.isAAC||"mp3"!==t.codec?e.box(e.types.stsd,e.STSD,e.mp4a(t)):e.box(e.types.stsd,e.STSD,e.mp3(t)):e.box(e.types.stsd,e.STSD,e.avc1(t))},e.tkhd=function(t){var i=t.id,n=t.duration*t.timescale,r=t.width,a=t.height,s=Math.floor(n/(L+1)),o=Math.floor(n%(L+1));return e.box(e.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,i>>24&255,i>>16&255,i>>8&255,255&i,0,0,0,0,s>>24,s>>16&255,s>>8&255,255&s,o>>24,o>>16&255,o>>8&255,255&o,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,r>>8&255,255&r,0,0,a>>8&255,255&a,0,0]))},e.traf=function(t,i){var n=e.sdtp(t),r=t.id,a=Math.floor(i/(L+1)),s=Math.floor(i%(L+1));return e.box(e.types.traf,e.box(e.types.tfhd,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r])),e.box(e.types.tfdt,new Uint8Array([1,0,0,0,a>>24,a>>16&255,a>>8&255,255&a,s>>24,s>>16&255,s>>8&255,255&s])),e.trun(t,n.length+16+20+8+16+8+8),n)},e.trak=function(t){return t.duration=t.duration||4294967295,e.box(e.types.trak,e.tkhd(t),e.mdia(t))},e.trex=function(t){var i=t.id;return e.box(e.types.trex,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},e.trun=function(t,i){var n,r,a,s,o,u,h=t.samples||[],d=h.length,l=12+16*d,c=new Uint8Array(l);for(i+=8+l,c.set([0,0,15,1,d>>>24&255,d>>>16&255,d>>>8&255,255&d,i>>>24&255,i>>>16&255,i>>>8&255,255&i],0),n=0;n<d;n++)a=(r=h[n]).duration,s=r.size,o=r.flags,u=r.cts,c.set([a>>>24&255,a>>>16&255,a>>>8&255,255&a,s>>>24&255,s>>>16&255,s>>>8&255,255&s,o.isLeading<<2|o.dependsOn,o.isDependedOn<<6|o.hasRedundancy<<4|o.paddingValue<<1|o.isNonSync,61440&o.degradPrio,15&o.degradPrio,u>>>24&255,u>>>16&255,u>>>8&255,255&u],12+16*n);return e.box(e.types.trun,c)},e.initSegment=function(t){e.types||e.init();var i=e.moov(t),n=new Uint8Array(e.FTYP.byteLength+i.byteLength);return n.set(e.FTYP),n.set(i,e.FTYP.byteLength),n},e}(),C=i(12),O=function(){function e(e,t,i,n){this.emitter=e,this.config=t,this.typeSupported=i,this.agentInfo=n;var r=n.userAgent;this.isSafari=Boolean(n.vendor&&n.vendor.indexOf("Apple")>-1&&r&&!r.match("CriOS")),this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=void 0,this.nextAudioPts=void 0}return e.prototype.destroy=function(){delete this.config,delete this.typeSupported,this.emitter.removeAllListeners(),delete this.emitter,delete this.config,delete this.typeSupported,delete this.agentInfo},e.prototype.resetTimeStamp=function(e){this._initDTS=e,this._initPTS=e},e.prototype.resetInitSegment=function(){this.ISGenerated=!1},e.prototype.remux=function(t,i,n,r,s,o,u){if(this.ISGenerated||this.generateIS(t,i,s),this.ISGenerated){var h=t.samples.length,d=i.samples.length,l=s,c=s;if(h&&d){var f=(t.samples[0].pts-i.samples[0].pts)/i.inputTimeScale;l+=Math.max(0,f),c+=Math.max(0,-f)}if(h){t.timescale||(a.a.warn(e.Tag,"regenerate InitSegment as audio detected"),this.generateIS(t,i,s));var p=this.remuxAudio(t,l,o,u);if(d){var m=void 0;p&&(m=p.endPTS-p.startPTS),i.timescale||(a.a.warn(e.Tag,"regenerate InitSegment as video detected"),this.generateIS(t,i,s)),this.remuxVideo(i,c,o,m,u)}}else if(d){var _=this.remuxVideo(i,c,o,0,u);_&&t.codec&&this.remuxEmptyAudio(t,l,o,_)}}n.samples.length&&this.remuxID3(n),r.samples.length&&this.remuxText(r),this.emitter.emit(b.FRAG_PARSED),this.emitter.emit(b.LOAD_NEXT_FRAG)},e.prototype.generateIS=function(t,i,n){var r,o,h=this,d=this.emitter,l=t.samples,c=i.samples,f=this.typeSupported,p="audio/mp4",m=Object.create(null),_=void 0===this._initPTS;if(_&&(o=1/0,r=1/0),t.config&&l.length&&(t.timescale=t.samplerate,a.a.info(e.Tag,"audio sampling rate : "+t.samplerate),t.isAAC||(f.mpeg?(p="audio/mpeg",t.codec=""):f.mp3&&(t.codec="mp3")),m.audio={container:p,codec:t.codec,initSegment:!t.isAAC&&f.mpeg?new Uint8Array:w.initSegment([t]),metadata:{channelCount:t.channelCount},mediaDuration:t.duration||0},_&&(o=l[0].pts-t.inputTimeScale*n,r=o)),i.sps&&i.pps&&c.length){var g=i.inputTimeScale;i.timescale=g,m.video={container:"video/mp4",codec:i.codec,initSegment:w.initSegment([i]),metadata:{width:i.width,height:i.height},mediaDuration:i.duration},_&&(r=Math.min(r,c[0].pts-g*n),o=Math.min(o,c[0].dts-g*n),this.emitter.emit(b.INIT_PTS_FOUND,{initPTS:r}))}var y=Object.keys(m);y.length?y.forEach((function(t){var i=m[t],n=i.initSegment;a.a.debug(e.Tag,"main track:"+t+",container:"+i.container+",codecs[level/parsed]=["+i.levelCodec+"/"+i.codec+"]"),n&&d.emit(b.INIT_SEGMENT,"initSegment",{type:t,data:n,parent:"main",content:"initSegment",mediaDuration:i.mediaDuration,codec:i.codec,container:i.container}),h.ISGenerated=!0,_&&(h._initPTS=r,h._initDTS=o)})):d.emit(b.ERROR,{type:s,details:u,fatal:!1,reason:"no audio/video samples found"})},e.prototype.remuxVideo=function(t,i,n,r,s){var u,d,l,c,f,p,m=8,_=t.timescale,g=t.samples,y=[],v=g.length,E=this._PTSNormalize,S=this._initPTS,A=this.nextAvcDts,T=this.isSafari,R=[];if(0!==v){if(T){var L=s&&Math.abs(i-A/_)<.1,O=Math.abs(g[0].pts-A-S)<_/5;n=Boolean(g.length&&A&&(L||O))||n}n||(A=i*_),f=1e3*g[0].dts/t.inputTimeScale,p=1e3*g[g.length-1].dts/t.inputTimeScale,g.forEach((function(e){e.pts=E(e.pts-S,A),e.dts=E(e.dts-S,A)})),g.sort((function(e,t){var i=e.dts-t.dts,n=e.pts-t.pts;return i||n||e.id-t.id}));var I=g.reduce((function(e,t){return Math.max(Math.min(e,t.pts-t.dts),-18e3)}),0);if(I<0){a.a.warn(e.Tag,"PTS < DTS detected in video samples, shifting DTS by "+Math.round(I/90)+" ms to overcome this issue");for(var D=0;D<g.length;D++)g[D].dts+=I}var k=g[0];c=Math.max(k.dts,0),l=Math.max(k.pts,0);var P=Math.round((c-A)/90);n&&P&&(P>1?a.a.log(e.Tag,"AVC:"+P+" ms hole between fragments detected,filling it"):P<-1&&a.a.log(e.Tag,"AVC:"+-P+" ms overlapping between fragments detected"),c=A,g[0].dts=c,l=Math.max(l-P,A),g[0].pts=l,a.a.log(e.Tag,"Video/PTS/DTS adjusted: "+Math.round(l/90)+"/"+Math.round(c/90)+",delta:"+P+" ms")),k=g[g.length-1];var M=Math.max(k.dts,0),x=Math.max(k.pts,0,M);T&&(u=Math.round((M-c)/(g.length-1)));var U=0,N=0;for(D=0;D<v;D++){for(var B=g[D],F=B.units,G=F.length,j=0,V=0;V<G;V++)j+=F[V].data.length;N+=j,U+=G,B.length=j,B.dts=T?c+D*u:Math.max(B.dts,c),B.pts=Math.max(B.pts,B.dts)}var z=N+4*U+8;try{d=new Uint8Array(z)}catch(e){return void this.emitter.emit(b.ERROR,{type:o,details:h,fatal:!1,bytes:z,reason:"fail allocating video mdat "+z})}var H=new DataView(d.buffer);H.setUint32(0,z),d.set(w.types.mdat,4);for(D=0;D<v;D++){var K=g[D],q=K.units,X=0,Y=void 0;for(V=0,G=q.length;V<G;V++){var W=q[V],J=W.data,Z=W.data.byteLength;H.setUint32(m,Z),m+=4,d.set(J,m),m+=Z,X+=4+Z}if(T)Y=Math.max(0,u*Math.round((K.pts-K.dts)/u));else{if(D<v-1)u=g[D+1].dts-K.dts;else{var Q=this.config,$=K.dts-g[D>0?D-1:D].dts;if(Q.stretchShortVideoTrack){var ee=Q.maxBufferHole,te=Math.floor(ee*_),ie=(r?l+r*_:this.nextAudioPts)-K.pts;ie>te?((u=ie-$)<0&&(u=$),a.a.log(e.Tag,"It is approximately "+ie/90+" ms to the next segment; using duration "+u/90+" ms for the last video frame.")):u=$}else u=$}Y=Math.round(K.pts-K.dts)}y.push({size:X,duration:u,cts:Y,dts:K.dts,pts:K.pts,keyframe:K.key&&K.frame,originalDts:K.dts,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:K.key?2:1,isNonSync:K.key?0:1}})}this.nextAvcDts=M+u;var ne=t.dropped;if(t.nbNalu=0,t.dropped=0,y.length&&navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var re=y[0].flags;re.dependsOn=2,re.isNonSync=0}t.samples=y,y.forEach((function(e){e.keyframe&&R.push(new C.a(1e3*e.dts/t.inputTimeScale,1e3*e.pts/t.inputTimeScale,0,Math.ceil(1e3*e.pts/t.inputTimeScale),!0))}));var ae=new C.a(y[0].dts,y[0].pts,y[0].duration,y[0].originalDts,!1),se=new C.a(y[y.length-1].dts,y[y.length-1].pts,y[y.length-1].duration,y[y.length-1].originalDts,!1),oe=w.moof(t.sequenceNumber++,c,t);t.samples=[];var ue=this._mergeBoxes(oe,d),he={data1:oe,data2:d,startPTS:l/_,endPTS:(x+u)/_,startDTS:c/_,endDTS:this.nextAvcDts/_,type:"video",hasAudio:!1,hasVideo:!0,nb:y.length,dropped:ne},de={type:"video",data:ue,sampleCount:v,info:{beginDts:c/_,beginPts:l/_,endDts:this.nextAvcDts/_,endPts:(x+u)/_,originalBeginDts:f,originalEndDts:p,syncPoints:R,firstSample:ae,lastSample:se}};return this.emitter.emit(b.MEDIA_SEGMENT,"video",de),he}},e.prototype.remuxAudio=function(t,i,n,r){var s,u,d,l,c,f=t.inputTimeScale,p=t.timescale,m=f/p,_=(t.isAAC?1024:1152)*m,g=this._PTSNormalize,y=this._initPTS,v=!t.isAAC&&this.typeSupported.mpeg,E=Object.create(null),S=v?0:8,T=t.samples,R=[],L=this.nextAudioPts,C=r&&Math.abs(i-L/f)<.1,O=Math.abs(T[0].pts-L-y)<20*_;if(n=Boolean(n||T.length&&L&&(C||O)),T.forEach((function(e){e.dts=g(e.pts-y,i*f),e.pts=e.dts})),0===(T=T.filter((function(e){return e.pts>=0}))).length)return null;var I=T[0].dts,D=T[T.length-1].dts;if(n||(L=r?i*f:T[0].pts),t.isAAC)for(var k=this.config.maxAudioFramesDrift,P=0,M=L;P<T.length;){var x=T[P],U=(q=x.pts)-M,N=Math.abs(1e3*U/f);if(U<=-k*_)a.a.warn(e.Tag,"Dropping 1 audio frame @ "+(M/f).toFixed(3)+"s due to "+Math.round(N)+" ms overlap."),T.splice(P,1);else if(U>=k*_&&N<1e4&&M){var B=Math.round(U/_);a.a.warn(e.Tag,"Injecting "+B+" audio frame @ "+(M/f).toFixed(3)+"s due to "+Math.round(1e3*U/f)+" ms gap.");for(var F=0;F<B;F++){var G=Math.max(M,0);(s=A.getSilentFrame(t.manifestCodec||t.codec,t.channelCount))||(a.a.log(e.Tag,"Unable to get silent frame for given audio codec; duplicating last frame instead."),s=x.unit.subarray(0)),T.splice(P,0,{unit:s,pts:G,dts:G}),M+=_,P++}x.dts=M,x.pts=M,M+=_,P++}else Math.abs(U),x.dts=M,x.pts=M,M+=_,P++}for(var j=T.length,V=0;j--;)V+=T[j].unit.byteLength;F=0;for(var z=T.length;F<z;F++){var H=T[F],K=H.unit,q=H.pts;if(void 0!==c)E.duration=Math.round((q-c)/m);else{U=Math.round(1e3*(q-L)/f);var X=0;if(n&&t.isAAC&&U){if(U>0&&U<1e4)X=Math.round((q-L)/_),a.a.log(e.Tag,U+" ms hole between AAC samples detected,filling it"),X>0&&((s=A.getSilentFrame(t.manifestCodec||t.codec,t.channelCount))||(s=K.subarray(0)),V+=X*s.length);else if(U<-12){a.a.log(e.Tag,"drop overlapping AAC sample, expected/parsed/delta:"+(L/f).toFixed(3)+"s/"+(q/f).toFixed(3)+"s/"+-U+"ms"),V-=K.byteLength;continue}q=L}if(l=q,!(V>0))return null;V+=S;try{u=new Uint8Array(V)}catch(e){return this.emitter.emit(b.ERROR,{type:o,details:h,fatal:!1,bytes:V,reason:"fail allocating audio mdat "+V}),null}v||(new DataView(u.buffer).setUint32(0,V),u.set(w.types.mdat,4));for(P=0;P<X;P++)(s=A.getSilentFrame(t.manifestCodec||t.codec,t.channelCount))||(a.a.log(e.Tag,"Unable to get silent frame for given audio codec; duplicating this frame instead."),s=K.subarray(0)),u.set(s,S),S+=s.byteLength,E={size:s.byteLength,cts:0,duration:1024,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},R.push(E)}u&&u.set(K,S);var Y=K.byteLength;S+=Y,E={size:Y,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},R.push(E),c=q}var W=0;if((j=R.length)>=2&&(W=R[j-2].duration,E.duration=W),j){L=c+m*W,this.nextAudioPts=L,t.samples=R,d=v?new Uint8Array:w.moof(t.sequenceNumber++,l/m,t),t.samples=[];var J=l/f,Z=L/f,Q={data1:d,data2:u,startPTS:J,endPTS:Z,startDTS:J,endDTS:Z,type:"audio",hasAudio:!0,hasVideo:!1,nb:j},$={data:this._mergeBoxes(d,u),sampleCount:j,type:"audio",info:{beginDts:J,beginPts:J,endDts:Z,endPts:Z,syncPoints:[],originalBeginDts:I,originalEndDts:D}};return this.emitter.emit(b.MEDIA_SEGMENT,"audio",$),Q}return null},e.prototype.remuxEmptyAudio=function(t,i,n,r){var s=t.inputTimeScale,o=s/(t.samplerate?t.samplerate:s),u=this.nextAudioPts,h=(void 0!==u?u:r.startDTS*s)+this._initDTS,d=r.endDTS*s+this._initDTS,l=1024*o,c=Math.ceil((d-h)/l),f=A.getSilentFrame(t.manifestCodec||t.codec,t.channelCount);if(a.a.warn(e.Tag,"remux empty Audio"),f){for(var p=[],m=0;m<c;m++){var _=h+m*l;p.push({unit:f,pts:_,dts:_})}t.samples=p,this.remuxAudio(t,i,n)}else a.a.info(e.Tag,"Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!")},e.prototype.remuxID3=function(e){var t,i=e.samples.length,n=e.inputTimeScale,r=this._initPTS;this._initDTS;if(i){for(var a=0;a<i;a++)(t=e.samples[a]).pts=(t.pts-r)/n,t.dts=(t.dts-r)/n;this.emitter.emit(b.FRAG_PARSING_METADATA,{samples:e.samples})}e.samples=[]},e.prototype.remuxText=function(e){e.samples.sort((function(e,t){return e.pts-t.pts}));var t,i=e.samples.length,n=e.inputTimeScale,r=this._initPTS;if(i){for(var a=0;a<i;a++)(t=e.samples[a]).pts=(t.pts-r)/n;this.emitter.emit(b.FRAG_PARSING_USERDATA,{samples:e.samples})}e.samples=[]},e.prototype._PTSNormalize=function(e,t){var i;if(void 0===t)return e;for(i=t<e?-8589934592:8589934592;Math.abs(e-t)>4294967296;)e+=i;return e},e.prototype._mergeBoxes=function(e,t){var i=new Uint8Array(e.byteLength+t.byteLength);return i.set(e,0),i.set(t,e.byteLength),i},e}();function I(){return(I=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e}).apply(this,arguments)}var D={video:1,audio:2,id3:3,text:4},k=function(){function e(t,i,n,r){this._emitter=t,this.config=i,this.typeSupported=n,this.agentInfo=r,this.frag=null,this.remuxer=new O(this._emitter,i,n,r),this.sampleAes=null,this._onError=null,this._mediaInfo=Object.create(null),this._onMediaInfo=null,this._onMetaDataArrived=null,this._onScriptDataArrived=null,this._onTrackMetadata=null,this._onDataAvailable=null,this.sequenceNumber=0,this._timestampBase=0,this._avcTrack=e.createVideoTrack(),this._audioTrack=e.createAudioTrack(0),this._id3Track=e.createId3Track(),this._txtTrack=e.createTextTrack(),this._hasAudioFlagOverrided=!1,this._hasAudio=!1,this._hasVideoFlagOverrided=!1,this._hasVideo=!1,this._durationOverrided=!1,this._duration=0,this.pmtParsed=!1,this._pmtId=-1,this.contiguous=!1,this.avcSample=null,this.aacOverFlow=null,this.aacLastPTS=void 0}return Object.defineProperty(e.prototype,"onTrackMetadata",{get:function(){return this._onTrackMetadata},set:function(e){this._onTrackMetadata=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onMediaInfo",{get:function(){return this._onMediaInfo},set:function(e){this._onMediaInfo=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onMetaDataArrived",{get:function(){return this._onMetaDataArrived},set:function(e){this._onMetaDataArrived=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onScriptDataArrived",{get:function(){return this._onScriptDataArrived},set:function(e){this._onScriptDataArrived=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onError",{get:function(){return this._onError},set:function(e){this._onError=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onDataAvailable",{get:function(){return this._onDataAvailable},set:function(e){this._onDataAvailable=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"timestampBase",{get:function(){return this._timestampBase},set:function(e){this._timestampBase=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"overridedDuration",{get:function(){return this._duration},set:function(e){this._durationOverrided=!0,this._duration=e,this._mediaInfo.duration=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"overridedHasAudio",{set:function(e){this._hasAudioFlagOverrided=!0,this._hasAudio=e,this._mediaInfo.hasAudio=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"overridedHasVideo",{set:function(e){this._hasVideoFlagOverrided=!0,this._hasVideo=e,this._mediaInfo.hasVideo=e},enumerable:!1,configurable:!0}),e.prototype.on=function(e,t){this._emitter.on(e,t)},e.prototype.once=function(e,t){this._emitter.once(e,t)},e.prototype.off=function(e,t){this._emitter.off(e,t)},e.prototype.bindDataSource=function(e){return e.onDataArrival=this.parseChunks.bind(this),this},e.prototype.parseChunks=function(t,i){var n=i.fragCurrent,r=Number.isFinite(n.startPTS)?n.startPTS:n.start,s=n.decryptdata,o=this.frag,u=!(o&&n.cc===o.cc),h=!(o&&n.level===o.level),d=o&&n.sn===o.sn+1,l=!h&&d;u&&a.a.debug(e.Tag,this.id+":discontinuity detected"),h&&a.a.debug(e.Tag,this.id+":switch detected"),this.frag=n,this.pushDecrypted(t,s,new Uint8Array(i.initSegmentData),i.audioCodec,i.videoCodec,r,u,h,l,i.totalduration,i.accurateTimeOffset,i.defaultInitPTS)},e.prototype.pushDecrypted=function(e,t,i,n,r,a,s,o,u,h,d,l){(s||o)&&(this.resetInitSegment(i,n,r,h),this.remuxer.resetInitSegment()),s&&(this.resetTimeStamp(l),this.remuxer.resetTimeStamp(l)),this.append(new Uint8Array(e),a,u,d)},e.probe=function(t){var i=e._syncOffset(t);return!(i<0)&&(i&&a.a.warn(e.Tag,"MPEG2-TS detected but first sync word found @ offset "+i+", junk ahead ?"),!0)},e._syncOffset=function(e){for(var t=Math.min(1e3,e.length-564),i=0;i<t;){if(71===e[i]&&71===e[i+188]&&71===e[i+376])return i;i++}return-1},e.createTrack=function(e,t){return{container:"video"===e||"audio"===e?"video/mp2t":void 0,type:e,id:D[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:"video"===e?0:void 0,isAAC:"audio"===e||void 0,duration:"audio"===e?t:void 0}},e.createVideoTrack=function(){return{container:"video/mp2t",type:"video",id:D.video,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,isAAC:void 0,duration:void 0}},e.createAudioTrack=function(e){return{container:"video/mp2t",type:"audio",id:D.audio,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:void 0,isAAC:!0,duration:e}},e.createId3Track=function(){return{container:void 0,type:"id3",id:D.id3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:void 0,isAAC:void 0,duration:void 0}},e.createTextTrack=function(){return{container:void 0,type:"text",id:D.text,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:void 0,isAAC:void 0,duration:void 0}},e.prototype.resetInitSegment=function(t,i,n,r){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=e.createVideoTrack(),this._audioTrack=e.createAudioTrack(r),this._id3Track=e.createId3Track(),this._txtTrack=e.createTextTrack(),this.aacOverFlow=null,this.aacLastPTS=void 0,this.avcSample=null,this.audioCodec=i,this.videoCodec=n,this._duration=r},e.prototype.resetTimeStamp=function(e){},e.prototype.resetMediaInfo=function(){this._mediaInfo=Object.create(null)},e.prototype.append=function(t,i,n,r){var o,h,d,l,c=t.length,f=!1,p=!1;this.contiguous=n;var m=this.pmtParsed,_=this._avcTrack,g=this._audioTrack,y=this._id3Track,v=_?_.pid:-1,E=g?g.pid:-1,S=y?y.pid:-1,A=this._pmtId,T=_.pesData,R=g.pesData,L=y.pesData,w=this._parsePAT,C=this._parsePMT,O=this._parsePES,I=this._parseAVCPES.bind(this),D=this._parseAACPES.bind(this),k=this._parseMPEGPES.bind(this),P=this._parseID3PES.bind(this),M=e._syncOffset(t);for(c-=(c+M)%188,o=M;o<c;o+=188)if(71===t[o]){if(f=!!(64&t[o+1]),h=((31&t[o+1])<<8)+t[o+2],(48&t[o+3])>>4>1){if((d=o+5+t[o+4])===o+188)continue}else d=o+4;switch(h){case v:f&&(T&&(l=O(T)),T&&l&&void 0!==l.pts&&I(l,!1),T={data:[],size:0}),T&&(T.data.push(t.subarray(d,o+188)),T.size+=o+188-d);break;case E:f&&(R&&(l=O(R)),R&&l&&void 0!==l.pts&&(g.isAAC?D(l):k(l)),R={data:[],size:0}),R&&(R.data.push(t.subarray(d,o+188)),R.size+=o+188-d);break;case S:f&&(L&&(l=O(L)),L&&l&&void 0!==l.pts&&P(l),L={data:[],size:0}),L&&(L.data.push(t.subarray(d,o+188)),L.size+=o+188-d);break;case 0:f&&(d+=t[d]+1),this._pmtId=w(t,d),A=this._pmtId;break;case A:f&&(d+=t[d]+1);var x=C(t,d,!0===this.typeSupported.mpeg||!0===this.typeSupported.mp3,null!==this.sampleAes);(v=x.avc)>0&&(_.pid=v),(E=x.audio)>0&&(g.pid=E,g.isAAC=x.isAAC),(S=x.id3)>0&&(y.pid=S),p&&!m&&(a.a.log(e.Tag,"reparse from beginning"),p=!1,o=M-188),this.pmtParsed=!0,m=!0;break;case 17:case 8191:break;default:p=!0}}else this._emitter.emit(b.ERROR,{type:s,details:u,fatal:!1,code:-2,reason:"TS packet did not start with 0x47"});T&&(l=O(T)),T&&l&&void 0!==l.pts?(I(l,!0),_.pesData=void 0):_.pesData=T,R&&(l=O(R)),R&&l&&void 0!==l.pts?(g.isAAC?D(l,!0):k(l),g.pesData=void 0):(R&&R.size&&a.a.log(e.Tag,"last AAC PES packet truncated,might overlap between fragments"),g.pesData=R),L&&(l=O(L)),L&&l&&void 0!==l.pts?(P(l),y.pesData=void 0):y.pesData=L,this.sequenceNumber+=1;var U=this.sequenceNumber;g.sequenceNumber=U,_.sequenceNumber=U,this._parseMediaInfo(g,_),this._createMetadata(g,_),this.remuxer.remux(g,_,y,this._txtTrack,i,n,r)},e.prototype.destroy=function(){this._initDTS=void 0,this._initPTS=void 0,this._duration=0,this.sequenceNumber=0,this._emitter.removeAllListeners(),delete this._emitter,delete this.config,delete this.typeSupported,delete this.agentInfo,this.frag=null,delete this.remuxer,this.sampleAes=null,this._onError=null,delete this._mediaInfo,this._onMediaInfo=null,this._onMetaDataArrived=null,this._onScriptDataArrived=null,this._onTrackMetadata=null,this._onDataAvailable=null,this.sequenceNumber=0,this._timestampBase=0,delete this._avcTrack,delete this._audioTrack,delete this._id3Track,delete this._txtTrack,this._hasAudioFlagOverrided=!1,this._hasAudio=!1,this._hasVideoFlagOverrided=!1,this._hasVideo=!1,this._durationOverrided=!1,this._duration=0,this.pmtParsed=!1,this._pmtId=-1,this.contiguous=!1,this.avcSample=null,this.aacOverFlow=null,this.aacLastPTS=void 0},e.prototype._parsePAT=function(e,t){return(31&e[t+10])<<8|e[t+11]},e.prototype._parsePMT=function(t,i,n,r){var s,o={audio:-1,avc:-1,id3:-1,isAAC:!0},u=i+3+((15&t[i+1])<<8|t[i+2])-4;for(i+=12+((15&t[i+10])<<8|t[i+11]);i<u;){switch(s=(31&t[i+1])<<8|t[i+2],t[i]){case 207:if(!r){a.a.log(e.Tag,"unkown stream type:"+t[i]);break}break;case 15:-1===o.audio&&(o.audio=s);break;case 21:-1===o.id3&&(o.id3=s);break;case 219:if(!r){a.a.log(e.Tag,"unkown stream type:"+t[i]);break}break;case 27:-1===o.avc&&(o.avc=s);break;case 3:case 4:n?-1===o.audio&&(o.audio=s,o.isAAC=!1):a.a.log(e.Tag,"MPEG audio found, not supported in this browser for now");break;case 36:a.a.log(e.Tag,"HEVC stream type found, not supported for now");break;default:a.a.log(e.Tag,"unkown stream type:"+t[i])}i+=5+((15&t[i+3])<<8|t[i+4])}return o},e.prototype._parsePES=function(t){var i,n,r,s,o,u,h,d,l=0,c=t.data;if(!t||0===t.size)return null;for(;c[0].length<19&&c.length>1;){var f=new Uint8Array(c[0].length+c[1].length);f.set(c[0]),f.set(c[1],c[0].length),c[0]=f,c.splice(1,1)}if(1===((i=c[0])[0]<<16)+(i[1]<<8)+i[2]){if((r=(i[4]<<8)+i[5])&&r>t.size-6)return null;192&(n=i[7])&&((u=536870912*(14&i[9])+4194304*(255&i[10])+16384*(254&i[11])+128*(255&i[12])+(254&i[13])/2)>4294967295&&(u-=8589934592),64&n?((h=536870912*(14&i[14])+4194304*(255&i[15])+16384*(254&i[16])+128*(255&i[17])+(254&i[18])/2)>4294967295&&(h-=8589934592),u-h>54e5&&(a.a.warn(e.Tag,Math.round((u-h)/9e4)+"s delta between PTS and DTS, align them"),u=h)):h=u),d=(s=i[8])+9,t.size-=d,o=new Uint8Array(t.size);for(var p=0,m=c.length;p<m;p++){var _=(i=c[p]).byteLength;if(d){if(d>_){d-=_;continue}i=i.subarray(d),_-=d,d=0}o.set(i,l),l+=_}return r&&(r-=s+3),{data:o,pts:u,dts:h,len:r}}return null},e.prototype.pushAccesUnit=function(t,i){if(t.units.length&&t.frame){var n=i.samples,r=n.length;!this.config.forceKeyFrameOnDiscontinuity||!0===t.key||i.sps&&(r||this.contiguous)?(t.id=r,n.push(t)):void 0!==i.dropped&&i.dropped++}t.debug.length&&a.a.info(e.Tag,t.pts+"/"+t.dts+":"+t.debug)},e.prototype._parseAVCPES=function(e,t){var i,n,r=this,a=this._avcTrack,s=this._parseAVCNALu(e.data),o=this.avcSample,u=!1,h=!1,d=this.pushAccesUnit.bind(this);delete e.data,o&&s.length&&!a.audFound&&(d(o,a),this.avcSample=S(!1,e.pts,e.dts,""),o=this.avcSample),s.forEach((function(t){switch(t.type){case 1:if(u=!0,o||(r.avcSample=S(!0,e.pts,e.dts,""),o=r.avcSample),!o)return;0,o.frame=!0;var s=t.data;if(h&&s.length>4){var l=new E(s).readSliceType();2!==l&&4!==l&&7!==l&&9!==l||(o.key=!0)}break;case 5:if(u=!0,o||(r.avcSample=S(!0,e.pts,e.dts,""),o=r.avcSample),!o)return;0,o.key=!0,o.frame=!0;break;case 24:case 6:u=!0,r._emitter.emit(b.GET_SEI_INFO,new Uint8Array(t.data)),(i=new E(r.discardEPB(t.data))).readUByte();for(var c=0,f=0,p=!1,m=0;!p&&i.bytesAvailable>1;){c=0;do{c+=m=i.readUByte()}while(255===m);f=0;do{f+=m=i.readUByte()}while(255===m);if(4===c&&0!==i.bytesAvailable){if(p=!0,181===i.readUByte())if(49===i.readUShort())if(1195456820===i.readUInt())if(3===i.readUByte()){var _=i.readUByte(),g=31&_,y=[_,i.readUByte()];for(n=0;n<g;n++)y.push(i.readUByte()),y.push(i.readUByte()),y.push(i.readUByte());r._insertSampleInOrder(r._txtTrack.samples,{type:3,pts:e.pts,bytes:y})}}else if(5===c&&0!==i.bytesAvailable){if(p=!0,f>16){var v=[],A=[];for(n=0;n<16;n++)v.push(i.readUByte().toString(16)),3!==n&&5!==n&&7!==n&&9!==n||v.push("-");for(n=16;n<f;n++)A.push(i.readUByte());r._insertSampleInOrder(r._txtTrack.samples,{pts:e.pts,payloadType:c,uuid:v.join(""),userData:String.fromCharCode.apply(null,A),userDataBytes:A})}}else if(f<i.bytesAvailable)for(n=0;n<f;n++)i.readUByte()}break;case 7:if(u=!0,h=!0,!a.sps){var T=(i=new E(t.data)).readSPS();a.width=T.width,a.height=T.height,a.pixelRatio=T.pixelRatio,a.sps=[t.data],a.duration=r._duration;var R=t.data.subarray(1,4),L="avc1.";for(n=0;n<3;n++){var w=R[n].toString(16);w.length<2&&(w="0"+w),L+=w}a.codec=L}break;case 8:u=!0,a.pps||(a.pps=[t.data]);break;case 9:u=!1,a.audFound=!0,o&&d(o,a),r.avcSample=S(!1,e.pts,e.dts,""),o=r.avcSample;break;case 12:u=!1;break;default:u=!1,o&&(o.debug+="unknown NAL "+t.type+" ")}o&&u&&o.units.push(t)})),t&&o&&(d(o,a),this.avcSample=null)},e.prototype._insertSampleInOrder=function(e,t){var i=e.length;if(i>0){if(t.pts&&t.pts>=e[i-1].pts)e.push(t);else for(var n=i-1;n>=0;n--)if(t.pts&&t.pts<e[n].pts){e.splice(n,0,t);break}}else e.push(t)},e.prototype._getLastNalUnit=function(){var e,t=this.avcSample;if(!t||0===t.units.length){var i=this._avcTrack.samples;t=i[i.length-1]}if(t){var n=t.units;e=n[n.length-1]}return e},e.prototype._parseAVCNALu=function(e){var t,i,n,r=0,a=e.byteLength,s=this._avcTrack,o=s.naluState||0,u=o,h=[],d=-1,l=0;for(-1===o&&(d=0,l=31&e[0],o=0,r=1);r<a;)if(t=e[r++],o)if(1!==o)if(t)if(1===t){var c,f;if(d>=0)n={data:e.subarray(d,r-o-1),type:l,state:void 0},h.push(n);else if(c=this._getLastNalUnit())if(u&&r<=4-u&&c.state&&(c.data=c.data.subarray(0,c.data.byteLength-u)),(i=r-o-1)>0)(f=new Uint8Array(c.data.byteLength+i)).set(c.data,0),f.set(e.subarray(0,i),c.data.byteLength),c.data=f;r<a?(d=r,l=31&e[r],o=0):o=-1}else o=0;else o=3;else o=t?0:2;else o=t?0:1;(d>=0&&o>=0&&(n={data:e.subarray(d,a),type:l,state:o},h.push(n)),0===h.length)&&((c=this._getLastNalUnit())&&((f=new Uint8Array(c.data.byteLength+e.byteLength)).set(c.data,0),f.set(e,c.data.byteLength),c.data=f));return s.naluState=o,h},e.prototype.discardEPB=function(e){for(var t=e.byteLength,i=[],n=1;n<t-2;)0===e[n]&&0===e[n+1]&&3===e[n+2]?(i.push(n+2),n+=2):n++;if(0===i.length)return e;var r=t-i.length,a=new Uint8Array(r),s=0;for(n=0;n<r;s++,n++)s===i[0]&&(s++,i.shift()),a[n]=e[s];return a},e.prototype._parseAACPES=function(t,i){var n,r,o,h,d=this._audioTrack,l=t.data,c=t.pts,f=this.aacOverFlow,y=this.aacLastPTS;if(f){var v=new Uint8Array(f.byteLength+l.byteLength);v.set(f,0),v.set(l,f.byteLength),l=v}for(r=0,h=l.length;r<h-1&&!p(l,r);r++);if(r){var E=void 0,S=void 0;if(r<h-1?(E="AAC PES did not start with ADTS header,offset:"+r,S=!1):(E="no ADTS header found in AAC PES",S=!0),a.a.warn(e.Tag,"parsing error:"+E),this._emitter.emit(b.ERROR,{type:s,details:u,fatal:S,reason:E}),S)return}m(d,this._emitter,l,r,this.audioCodec),n=0;var A=_(d.samplerate);if(f&&y&&A){var T=y+A;c&&Math.abs(T-c)>1&&(a.a.log(e.Tag,"AAC: align PTS for overlapping frames by "+Math.round((T-c)/90)),c=T)}for(;r<h;)if(p(l,r)&&r+5<h&&d){var R=g(d,l,r,c,n);if(!R)break;r+=R.length,o=R.sample.pts,n++}else r++;f=r<h?l.subarray(r,h):null,this.aacOverFlow=f,this.aacLastPTS=o},e.prototype._parseMPEGPES=function(e){for(var t=e.data,i=t.length,n=0,r=0,a=e.pts;r<i;)if(v.isHeader(t,r)){var s=v.appendFrame(this._audioTrack,t,r,a,n);if(!s)break;r+=s.length,n++}else r++},e.prototype._parseID3PES=function(e){this._id3Track.samples.push(e)},e.prototype._parseMediaInfo=function(e,t){this._mediaInfo=I(Object.create(null),this._mediaInfo,{duration:Math.max(e.duration,t.duration),audioChannelCount:e.channelCount,audioCodec:e.codec,audioSampleRate:e.samplerate,fps:null,hasAudio:!!e,hasKeyframesIndex:!1,keyframesIndex:null,hasVideo:!!t,width:t.width,height:t.height,mimeType:(t.container||e.container)+'; codecs="'+t.codec+","+e.codec+'"',videoCodec:t.codec,pixelRatio:t.pixelRatio,pps:t.pps,sps:t.sps}),this._emitter.emit(b.MEDIA_INFO,this._mediaInfo)},e.prototype._createMetadata=function(e,t){var i={audiodatarate:0,audiosamplerate:e.samplerate,compatibleBrands:"isom",duration:t.duration,height:t.height,majorBrand:"isom",minorVersion:"1",width:t.width};this._emitter.emit(b.META_DATA,i)},e}(),P={forceKeyFrameOnDiscontinuity:!0,maxBufferHole:.5,maxAudioFramesDrift:1,stretchShortVideoTrack:!1},M=function(){var e=window.MediaSource||window.WebKitMediaSource;return{mp4:e.isTypeSupported("video/mp4"),mpeg:e.isTypeSupported("audio/mpeg"),mp3:e.isTypeSupported('audio/mp4; codecs="mp3"')}};function x(){return(x=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e}).apply(this,arguments)}var U=function(){function e(e,t,i){this.Tag="TSCodec",this.type="TSCodec",this.eventEmitter=new r.a,this._config=x(Object.create(null),P,e),this._demuxer=new k(this.eventEmitter,this._config,t,i),this.timestampBase=0}return e.prototype.appendData=function(e,t,i,n){this._demuxer.append(new Uint8Array(e),t,i,n)},e.probe=function(e){return k.probe(new Uint8Array(e))},e.prototype.on=function(e,t){this.eventEmitter.on(e,t)},e.prototype.once=function(e,t){this.eventEmitter.once(e,t)},e.prototype.off=function(e,t){this.eventEmitter.off(e,t)},e.prototype.destroy=function(){this.eventEmitter.removeAllListeners(),this._demuxer.destroy(),delete this._demuxer,delete this._config,delete this.eventEmitter},e.prototype.resetInitSegment=function(e,t,i,n){this._demuxer.resetInitSegment(e,t,i,n)},e.prototype.resetTimeStamp=function(e){this._demuxer.resetTimeStamp(e)},Object.defineProperty(e,"Events",{get:function(){return b},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"config",{get:function(){return this._config},enumerable:!1,configurable:!0}),Object.defineProperty(e,"typeSupportFunc",{get:function(){return M},enumerable:!1,configurable:!0}),e.prototype.seek=function(e){},e.prototype.insertDiscontinuity=function(){},e.prototype.flushStashedSamples=function(){},e.prototype.bindDataSource=function(e){return e.onDataArrival=this.parseChunks.bind(this),this},e.prototype.resetMediaInfo=function(){},e.prototype.parseChunks=function(e,t,i){var n=new Uint8Array(e);return this._demuxer.parseChunks(n,i),n.length},e}();t.a=U},function(e,t,i){var n,r,a,s,o;n=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/?#]*\/)*[^;?#]*)?(;[^?#]*)?(\?[^#]*)?(#[^]*)?$/,r=/^([^\/?#]*)([^]*)$/,a=/(?:\/|^)\.(?=\/)/g,s=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,o={buildAbsoluteURL:function(e,t,i){if(i=i||{},e=e.trim(),!(t=t.trim())){if(!i.alwaysNormalize)return e;var n=o.parseURL(e);if(!n)throw new Error("Error trying to parse base URL.");return n.path=o.normalizePath(n.path),o.buildURLFromParts(n)}var a=o.parseURL(t);if(!a)throw new Error("Error trying to parse relative URL.");if(a.scheme)return i.alwaysNormalize?(a.path=o.normalizePath(a.path),o.buildURLFromParts(a)):t;var s=o.parseURL(e);if(!s)throw new Error("Error trying to parse base URL.");if(!s.netLoc&&s.path&&"/"!==s.path[0]){var u=r.exec(s.path);s.netLoc=u[1],s.path=u[2]}s.netLoc&&!s.path&&(s.path="/");var h={scheme:s.scheme,netLoc:a.netLoc,path:null,params:a.params,query:a.query,fragment:a.fragment};if(!a.netLoc&&(h.netLoc=s.netLoc,"/"!==a.path[0]))if(a.path){var d=s.path,l=d.substring(0,d.lastIndexOf("/")+1)+a.path;h.path=o.normalizePath(l)}else h.path=s.path,a.params||(h.params=s.params,a.query||(h.query=s.query));return null===h.path&&(h.path=i.alwaysNormalize?o.normalizePath(a.path):a.path),o.buildURLFromParts(h)},parseURL:function(e){var t=n.exec(e);return t?{scheme:t[1]||"",netLoc:t[2]||"",path:t[3]||"",params:t[4]||"",query:t[5]||"",fragment:t[6]||""}:null},normalizePath:function(e){for(e=e.split("").reverse().join("").replace(a,"");e.length!==(e=e.replace(s,"")).length;);return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}},e.exports=o},function(e,t,i){"use strict";var n=function(){function e(){this.mimeType=null,this.duration=void 0,this.hasAudio=null,this.hasVideo=null,this.audioCodec=null,this.videoCodec=null,this.audioDataRate=null,this.videoDataRate=null,this.audioSampleRate=null,this.audioChannelCount=null,this.width=null,this.height=null,this.fps=null,this.profile=null,this.level=null,this.refFrames=null,this.chromaFormat=null,this.sarNum=null,this.sarDen=null,this.metadata=null,this.segments=null,this.segmentCount=null,this.hasKeyframesIndex=null,this.keyframesIndex=null}return e.prototype.isComplete=function(){var e=!1===this.hasAudio||!0===this.hasAudio&&null!=this.audioCodec&&null!=this.audioSampleRate&&null!=this.audioChannelCount,t=!1===this.hasVideo||!0===this.hasVideo&&null!=this.videoCodec&&null!=this.width&&null!=this.height&&null!=this.fps&&null!=this.profile&&null!=this.level&&null!=this.refFrames&&null!=this.chromaFormat&&null!=this.sarNum&&null!=this.sarDen;return null!==this.mimeType&&void 0!==this.duration&&null!==this.metadata&&null!==this.hasKeyframesIndex&&e&&t},e.prototype.isSeekable=function(){return!0===this.hasKeyframesIndex},e.prototype.getNearestKeyframe=function(e){if(null==this.keyframesIndex)return null;var t=this.keyframesIndex,i=this._search(t.times,e);return{index:i,milliseconds:t.times[i],fileposition:t.filepositions[i]}},e.prototype._search=function(e,t){var i=0,n=e.length-1,r=0,a=0,s=n;for(t<e[0]&&(i=0,a=s+1);a<=s;){if((r=a+Math.floor((s-a)/2))===n||t>=e[r]&&t<e[r+1]){i=r;break}e[r]<t?a=r+1:s=r-1}return i},e}();t.a=n},function(e,t,i){"use strict";var n=i(4),r=i.n(n),a=i(11),s=i(7),o=i(2),u=i(6),h=i(3),d=i(5);function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var c,f=(c=function(e,t){return(c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}c(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),p=Object(d.a)(),m=function(e){function t(t,i){var n=e.call(this,"FetchStreamLoader","flv")||this;return n.Tag="FetchStreamLoader",n.eventEmitter=new r.a,n.mediaConfig=null,n.userConfig=i,n.seekHandler=t,n.seekRange={from:0,to:0},n.requestAbort=!1,n.contentLength=null,n.receivedLength=0,n}return f(t,e),t.isSupported=function(){var e=!1;try{var t=s.a.msedge&&s.a.version.minor>=15048,i=!s.a.msedge||t;e=p.fetch&&p.ReadableStream&&i}catch(t){e=!1}return e},t.prototype.on=function(e,t){this.eventEmitter.on(e,t)},t.prototype.once=function(e,t){this.eventEmitter.once(e,t)},t.prototype.off=function(e,t){this.eventEmitter.off(e,t)},t.prototype.destroy=function(){this.abort(),this.eventEmitter.removeAllListeners(),delete this.eventEmitter,delete this.mediaConfig,delete this.seekRange,delete this.seekHandler,delete this.userConfig,this._status=o.a.kIdle,this._onContentLengthKnown=null,this._onURLRedirect=null,this._onDataArrival=null,this._onError=null,this._onComplete=null},t.prototype.startLoad=function(e,t){var i=this;this.mediaConfig=e,this.seekRange=t;var n=e.url;this.userConfig.reuseRedirectedURL&&void 0!==e.redirectedURL&&(n=e.redirectedURL);var r=this.seekHandler.getConfig(n,t),a=new p.Headers,s={method:"GET",headers:a,mode:"cors",cache:"default",referrerPolicy:"no-referrer-when-downgrade",credentials:"same-origin"};if("object"===l(r.headers)){var d=r.headers;Object.keys(d).forEach((function(e){a.append(e,d[e])}))}"object"===l(this.userConfig.headers)&&Object.keys(this.userConfig.headers).forEach((function(e){i.userConfig.headers&&a.append(e,i.userConfig.headers[e])})),!1===e.cors&&(s.mode="same-origin"),e.withCredentials&&(s.credentials="include"),e.referrerPolicy&&(s.referrerPolicy=e.referrerPolicy),this._status=o.a.kConnecting,p.fetch(r.url,s).then((function(e){if(i.requestAbort)return i.requestAbort=!1,void(i._status=o.a.kIdle);if(e&&e.ok&&e.status>=200&&e.status<=299){if(e.url!==r.url&&i._onURLRedirect){var t=i.seekHandler.removeURLParameters(e.url);i._onURLRedirect(t)}var n=e.headers.get("Content-Length");if(null!==n&&(i.contentLength=parseInt(n,10),0!==i.contentLength&&i._onContentLengthKnown&&i._onContentLengthKnown(i.contentLength)),null===e||null===e.body)return;return i._pump.call(i,e.body.getReader())}if(i._status=o.a.kError,!i._onError)throw new h.d("FetchStreamLoader: Http code invalid, "+e.status+" "+e.statusText);i._onError(u.a.HTTP_STATUS_CODE_INVALID,{code:e.status,reason:e.statusText})})).catch((function(e){if(i._status=o.a.kError,!i._onError)throw e;i._onError(u.a.EXCEPTION,{code:-1,reason:e.message})}))},t.prototype._pump=function(e){var t=this;return e.read().then((function(i){if(i.done)if(null!==t.contentLength&&t.receivedLength<t.contentLength){t._status=o.a.kError;var n=u.a.EARLY_EOF,r={code:-1,reason:"Fetch stream meet Early-EOF"};if(!t._onError)throw new h.d(r.reason);t._onError(n,r)}else t._status=o.a.kComplete,t._onComplete&&t._onComplete(t.seekRange.from,t.seekRange.from+t.receivedLength-1);else{if(!0===t.requestAbort)return t.requestAbort=!1,t._status=o.a.kComplete,e.cancel();t._status=o.a.kBuffering;var a=i.value.buffer,s=t.seekRange.from+t.receivedLength;t.receivedLength+=a.byteLength,t._onDataArrival&&t._onDataArrival(a,s,t.receivedLength),t._pump(e)}})).catch((function(e){if(11!==e.code||!s.a.msedge){t._status=o.a.kError;var i=u.a.EXCEPTION,n={code:e.code||-1,reason:e.message||"readable stream exception"};if(19!==e.code&&"network error"!==e.message||!(null===t.contentLength||null!==t.contentLength&&t.receivedLength<t.contentLength)||(i=u.a.EARLY_EOF,n={code:e.code,reason:e.message}),!t._onError){if(!n)return;throw new h.d(n.reason)}t._onError(i,n)}}))},t.prototype.abort=function(){this.requestAbort=!0},t}(a.a);t.a=m},function(e,t,i){"use strict";var n=i(0),r=i(5),a=Object(r.a)(),s=a.performance,o=function(){function e(e){this.Tag="XhrLoader",this.xhrSetup=null,this.loader=null,this.requestTimeout=null,this.stats=null,this.retryTimeout=null,this.context=null,this.config=null,this.callbacks=null,this.retryDelay=0,this.context=null,e&&e.xhrSetup&&(this.xhrSetup=e.xhrSetup)}return e.prototype.destroy=function(){this.abort(),this.loader=null},e.prototype.abort=function(){var e=this.loader;e&&4!==e.readyState&&(this.stats.aborted=!0,e.abort()),a.clearTimeout(this.requestTimeout),this.requestTimeout=null,a.clearTimeout(this.retryTimeout),this.retryTimeout=null},e.prototype.load=function(e,t,i){this.context=e,this.config=t,this.callbacks=i,this.stats={trequest:s.now(),retry:0,tfirst:0,loaded:0,total:0,tload:0,aborted:!1},this.retryDelay=t.retryDelay,this.loadInternal()},e.prototype.loadInternal=function(){var e=this.context,t=new XMLHttpRequest,i=this.stats;i.tfirst=0,i.loaded=0;var n=this.xhrSetup;if(e&&this.callbacks&&this.config){try{if(n)try{n(t,e.url)}catch(i){t.open("GET",e.url,!0),n(t,e.url)}t.readyState||t.open("GET",e.url,!0)}catch(i){return void this.callbacks.onError({code:t.status,text:i.message},e,t)}e.rangeEnd&&t.setRequestHeader("Range","bytes="+e.rangeStart+"-"+(e.rangeEnd-1)),t.onreadystatechange=this.readystatechange.bind(this),t.onprogress=this.loadprogress.bind(this),t.responseType=e.responseType,this.requestTimeout=a.setTimeout(this.loadtimeout.bind(this),this.config.timeout),t.send()}},e.prototype.readystatechange=function(e){var t=e.currentTarget,i=t.readyState,r=this.stats,o=this.context,u=this.config;if(!r.aborted&&this.callbacks&&i>=2)if(a.clearTimeout(this.requestTimeout),0===r.tfirst&&(r.tfirst=Math.max(s.now(),r.trequest)),4===i){var h=t.status;if(h>=200&&h<300){r.tload=Math.max(r.tfirst,s.now());var d=void 0,l=void 0;l="arraybuffer"===o.responseType?(d=t.response).byteLength:(d=t.responseText).length,r.total=l,r.loaded=l;var c={url:t.responseURL,data:d};this.callbacks.onSuccess(c,r,o,t)}else r.retry>=u.maxRetry||h>=400&&h<499?(n.a.error(this.Tag,h+" while loading "+o.url),this.callbacks.onError({code:h,text:t.statusText},o,t)):(n.a.warn(this.Tag,h+" while loading "+o.url+", retrying in "+this.retryDelay+"..."),this.destroy(),this.retryTimeout=a.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,u.maxRetryDelay),r.retry++)}else this.requestTimeout=a.setTimeout(this.loadtimeout.bind(this),u.timeout)},e.prototype.loadtimeout=function(){this.context&&this.callbacks&&this.stats&&(n.a.warn(this.Tag,"timeout while loading "+this.context.url),this.callbacks.onTimeout(this.stats,this.context,null))},e.prototype.loadprogress=function(e){var t=e.currentTarget,i=this.stats;if(i&&this.callbacks&&this.context){i.loaded=e.loaded,e.lengthComputable&&(i.total=e.total);var n=this.callbacks.onProgress;n&&n(i,this.context,"",t)}},e}();t.a=o},function(e,t,i){"use strict";var n=function(){function e(e,t){this._startName=e,this._endName=t}return e.prototype.getConfig=function(e,t){var i=e;if(0!==t.from||-1!==t.to){var n=!0;-1===i.indexOf("?")&&(i+="?",n=!1),n&&(i+="&"),i+=this._startName+"="+t.from.toString(),-1!==t.to&&(i+="&"+this._endName+"="+t.to.toString())}return{url:i,headers:{}}},e.prototype.removeURLParameters=function(e){var t,i=e.split("?")[0],n=e.indexOf("?");-1!==n&&(t=e.substring(n+1));var r="";if(void 0!==t&&t.length>0)for(var a=t.split("&"),s=0;s<a.length;s++){var o=a[s].split("="),u=s>0;o[0]!==this._startName&&o[0]!==this._endName&&(u&&(r+="&"),r+=a[s])}return 0===r.length?i:i+"?"+r},e}();t.a=n},function(e,t,i){"use strict";var n,r=i(4),a=i.n(r),s=i(21),o=i(18),u=i.n(o),h=i(0),d=function(){function e(e,t){this._uri=null,this.method=null,this.key=null,this.iv=null,this.baseuri=e,this.reluri=t}return Object.defineProperty(e.prototype,"uri",{get:function(){return!this._uri&&this.reluri&&(this._uri=u.a.buildAbsoluteURL(this.baseuri,this.reluri,{alwaysNormalize:!0})),this._uri},enumerable:!1,configurable:!0}),e}();!function(e){e.AUDIO="audio",e.VIDEO="video"}(n||(n={}));var l=function(){function e(){var e;this.Tag="Fragment",this._url=null,this._byteRange=null,this._decryptdata=null,this._elementaryStreams=((e={})[n.AUDIO]=!1,e[n.VIDEO]=!1,e),this.deltaPTS=0,this.rawProgramDateTime=null,this.programDateTime=null,this.title=null,this.tagList=[],this.sn=0,this.urlId=0,this.level=0}return e.prototype.setByteRange=function(e,t){var i=e.split("@",2),n=[];1===i.length?n[0]=t?t.byteRangeEndOffset:0:n[0]=parseInt(i[1],10),n[1]=parseInt(i[0],10)+n[0],this._byteRange=n},Object.defineProperty(e.prototype,"url",{get:function(){return!this._url&&this.relurl&&(this._url=u.a.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url},set:function(e){this._url=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"byteRange",{get:function(){return this._byteRange?this._byteRange:[]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"byteRangeStartOffset",{get:function(){return this.byteRange[0]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"byteRangeEndOffset",{get:function(){return this.byteRange[1]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"decryptdata",{get:function(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var e=this.sn;"number"!=typeof e&&(this.levelkey&&"AES-128"===this.levelkey.method&&!this.levelkey.iv&&h.a.warn(this.Tag,'missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),e=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,e)}return this._decryptdata},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"endProgramDateTime",{get:function(){if(null===this.programDateTime)return null;if(!Number.isFinite(this.programDateTime))return null;var e=Number.isFinite(this.duration)?this.duration:0;return this.programDateTime+1e3*e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"encrypted",{get:function(){return!(!this.decryptdata||null===this.decryptdata.uri||null!==this.decryptdata.key)},enumerable:!1,configurable:!0}),e.prototype.addElementaryStream=function(e){this._elementaryStreams[e]=!0},e.prototype.hasElementaryStream=function(e){return!0===this._elementaryStreams[e]},e.prototype.createInitializationVector=function(e){for(var t=new Uint8Array(16),i=12;i<16;i++)t[i]=e>>8*(15-i)&255;return t},e.prototype.setDecryptDataFromLevelKey=function(e,t){var i=e;return e&&e.method&&e.uri&&!e.iv&&((i=new d(e.baseuri,e.reluri)).method=e.method,i.iv=this.createInitializationVector(t)),i},e}(),c=function(){function e(e){this.endCC=0,this.endSN=0,this.fragments=[],this.initSegment=null,this.live=!0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=e,this.version=null,this.averagetargetduration=0}return Object.defineProperty(e.prototype,"hasProgramDateTime",{get:function(){return!(!this.fragments[0]||!Number.isFinite(this.fragments[0].programDateTime))},enumerable:!1,configurable:!0}),e}(),f=/^(\d+)x(\d+)$/,p=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,m=function(){function e(t){var i=this;this.AUDIO="","string"==typeof t&&(t=e.parseAttrList(t)),Object.keys(t).forEach((function(e){i[e]=t[e]}))}return e.prototype.decimalInteger=function(e){var t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t},e.prototype.hexadecimalInteger=function(e){if(this[e]){var t=(this[e]||"0x").slice(2);t=(1&t.length?"0":"")+t;for(var i=new Uint8Array(t.length/2),n=0;n<t.length/2;n++)i[n]=parseInt(t.slice(2*n,2*n+2),16);return i}return null},e.prototype.hexadecimalIntegerAsNumber=function(e){var t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t},e.prototype.decimalFloatingPoint=function(e){return parseFloat(this[e])},e.prototype.enumeratedString=function(e){return this[e]},e.prototype.decimalResolution=function(e){var t=f.exec(this[e]);if(null!==t)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}},e.parseAttrList=function(e){var t,i=Object.create(null);for(p.lastIndex=0;null!==p.exec(e);){var n=p.exec(e);0===(t=n[2]).indexOf('"')&&t.lastIndexOf('"')===t.length-1&&(t=t.slice(1,-1)),i[n[1]]=t}return i},e}(),_={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0}};var g=/#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)/g,y=/#EXT-X-MEDIA:(.*)/g,v=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/|(?!#)([\S+ ?]+)/.source,/|#EXT-X-BYTERANGE:*(.+)/.source,/|#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/|#.*/.source].join(""),"g"),b=/(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE): *(\d+))|(?:#EXT-X-(TARGETDURATION): *(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DISCONTINUITY-SEQ)UENCE:(\d+))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(VERSION):(\d+))|(?:#EXT-X-(MAP):(.+))|(?:(#)([^:]*):(.*))|(?:(#)(.*))(?:.*)\r?\n?/,E=/\.(mp4|m4s|m4v|m4a)$/i,S=function(){function e(){}return e.findGroup=function(e,t){if(!e)return null;for(var i=null,n=0;n<e.length;n++){var r=e[n];r.id===t&&(i=r)}return i},e.convertAVC1ToAVCOTI=function(e){var t,i=e.split(".");return i.length>2?(t=i.shift()+".",t+=parseInt(i.shift()).toString(16),t+=("000"+parseInt(i.shift()).toString(16)).substr(-4)):t=e,t},e.resolve=function(e,t){return u.a.buildAbsoluteURL(t,e,{alwaysNormalize:!0})},e.parseMasterPlaylist=function(t,i){var n,r=[];function a(e,t){["video","audio"].forEach((function(i){var n=e.filter((function(e){return function(e,t){var i=_[t];return!!i&&!0===i[e.slice(0,4)]}(e,i)}));if(n.length){var r=n.filter((function(e){return 0===e.lastIndexOf("avc1",0)||0===e.lastIndexOf("mp4a",0)}));t[i+"Codec"]=r.length>0?r[0]:n[0],e=e.filter((function(e){return-1===n.indexOf(e)}))}})),t.unknownCodecs=e}for(g.lastIndex=0;null!=(n=g.exec(t));){var s={},o=s.attrs=new m(n[1]);s.url=e.resolve(n[2],i);var u=o.decimalResolution("RESOLUTION");u&&(s.width=u.width,s.height=u.height),s.bitrate=o.decimalInteger("AVERAGE-BANDWIDTH")||o.decimalInteger("BANDWIDTH"),s.name=o.NAME,a([].concat((o.CODECS||"").split(/[ ,]+/)),s),s.videoCodec&&-1!==s.videoCodec.indexOf("avc1")&&(s.videoCodec=e.convertAVC1ToAVCOTI(s.videoCodec)),r.push(s)}return r},e.parseMasterPlaylistMedia=function(t,i,n,r){var a;void 0===r&&(r=[]);var s=[],o=0;for(y.lastIndex=0;null!==(a=y.exec(t));){var u=new m(a[1]);if(u.TYPE===n){var h={id:o++,groupId:u["GROUP-ID"],name:u.NAME||u.LANGUAGE,type:n,default:"YES"===u.DEFAULT,autoselect:"YES"===u.AUTOSELECT,forced:"YES"===u.FORCED,lang:u.LANGUAGE};if(u.URI&&(h.url=e.resolve(u.URI,i)),r.length){var d=e.findGroup(r,h.groupId);h.audioCodec=d?d.codec:r[0].codec}s.push(h)}}return s},e.parseLevelPlaylist=function(e,t,i,n,r){var a,s,o,u=0,f=0,p=new c(t),_=0,g=null,y=new l,S=null;for(v.lastIndex=0;null!==(s=v.exec(e));){var T=s[1];if(T){y.duration=parseFloat(T);var R=(" "+s[2]).slice(1);y.title=R||null,y.tagList.push(R?["INF",T,R]:["INF",T])}else if(s[3]){if(Number.isFinite(y.duration)){var L=u++;y.type=n,y.start=f,y.levelkey=a,y.sn=L,y.level=i,y.cc=_,y.urlId=r,y.baseurl=t,y.relurl=(" "+s[3]).slice(1),A(y,g),p.fragments.push(y),g=y,f+=y.duration,y=new l}}else if(s[4]){var w=(" "+s[4]).slice(1);g?y.setByteRange(w,g):y.setByteRange(w)}else if(s[5])y.rawProgramDateTime=(" "+s[5]).slice(1),y.tagList.push(["PROGRAM-DATE-TIME",y.rawProgramDateTime]),null===S&&(S=p.fragments.length);else{for(s=s[0].match(b),o=1;o<s.length&&void 0===s[o];o++);var C=(" "+s[o+1]).slice(1),O=(" "+s[o+2]).slice(1);switch(s[o]){case"#":y.tagList.push(O?[C,O]:[C]);break;case"PLAYLIST-TYPE":p.type=C.toUpperCase();break;case"MEDIA-SEQUENCE":u=p.startSN=parseInt(C);break;case"TARGETDURATION":p.targetduration=parseFloat(C);break;case"VERSION":p.version=parseInt(C);break;case"EXTM3U":break;case"ENDLIST":p.live=!1;break;case"DIS":_++,y.tagList.push(["DIS"]);break;case"DISCONTINUITY-SEQ":_=parseInt(C);break;case"KEY":var I=new m(C),D=I.enumeratedString("METHOD"),k=I.URI,P=I.hexadecimalInteger("IV");D&&(a=new d(t,k),k&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(D)>=0&&(a.method=D,a.baseuri=t,a.reluri=k,a.key=null,a.iv=P));break;case"START":var M=new m(C).decimalFloatingPoint("TIME-OFFSET");Number.isFinite(M)&&(p.startTimeOffset=M);break;case"MAP":var x=new m(C);y.relurl=x.URI,x.BYTERANGE&&y.setByteRange(x.BYTERANGE),y.baseurl=t,y.level=i,y.type=n,y.sn="initSegment",p.initSegment=y,(y=new l).rawProgramDateTime=p.initSegment.rawProgramDateTime;break;default:h.a.warn(this.Tag,"line parsed but not handled: "+s)}}}return(y=g)&&!y.relurl&&(p.fragments.pop(),f-=y.duration),p.totalduration=f,p.averagetargetduration=f/p.fragments.length,p.endSN=u-1,p.startCC=p.fragments[0]?p.fragments[0].cc:0,p.endCC=_,!p.initSegment&&p.fragments.length&&p.fragments.every((function(e){return E.test(e.relurl)}))&&(h.a.warn(this.Tag,"MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),(y=new l).relurl=p.fragments[0].relurl,y.baseurl=t,y.level=i,y.type=n,y.sn="initSegment",p.initSegment=y,p.needSidxRanges=!0),S&&function(e,t){for(var i=e[t],n=t-1;n>=0;n--){var r=e[n];r.programDateTime=i.programDateTime-1e3*r.duration,i=r}}(p.fragments,S),p},e.Tag="M3U8Parser",e}();function A(e,t){e.rawProgramDateTime?e.programDateTime=Date.parse(e.rawProgramDateTime):t&&t.programDateTime&&(e.programDateTime=t.endProgramDateTime),Number.isFinite(e.programDateTime)||(e.programDateTime=null,e.rawProgramDateTime=null)}var T,R,L=i(10),w=i(5),C=Object(w.a)();!function(e){e.MANIFEST="manifest",e.LEVEL="level",e.AUDIO_TRACK="audioTrack",e.SUBTITLE_TRACK="subtitleTrack"}(T||(T={})),function(e){e.MAIN="main",e.AUDIO="audio",e.SUBTITLE="subtitle"}(R||(R={}));var O,I=Object(w.a)();!function(e){e.MANIFEST="manifest",e.LEVEL="level",e.AUDIO_TRACK="audioTrack",e.SUBTITLE_TRACK="subtitleTrack"}(O||(O={}));var D=function(){function e(e){this._emitter=new a.a,this._requestAbort=!1,this.timer=0,this.currentPlaylist=null,this.lastestM3U8Content="",this.Tag="PlayListLoader",this.dataSource=e,this.url=e.url}return e.prototype.on=function(e,t){this._emitter.addListener(e,t)},e.prototype.off=function(e,t){this._emitter.removeListener(e,t)},e.prototype.load=function(){var e={onSuccess:this.loadSuccess.bind(this),onError:this.loadError.bind(this),onTimeout:this.loadTimeout.bind(this)},t={url:this.url,type:O.MANIFEST,level:0,id:null,responseType:"text"};(new s.a).load(t,{maxRetry:2,maxRetryDelay:1e3,retryDelay:1e3,timeout:1e4},e)},e.prototype.stop=function(){},e.prototype.loadSuccess=function(e,t,i,n){if(void 0===n&&(n=null),"string"!=typeof e.data)throw new Error('expected responseType of "text" for PlaylistLoader');var r=e.data;this.lastestM3U8Content=r,t.tload=performance.now(),0===r.indexOf("#EXTM3U")?r.indexOf("#EXTINF:")>0||r.indexOf("#EXT-X-TARGETDURATION:")>0?this._handleTrackOrLevelPlaylist(e,t,i,n):this._handleMasterPlaylist(e,t,i,n):this._handleManifestParsingError(e,i,"no EXTM3U delimiter",n)},e.prototype.abort=function(){this._requestAbort=!0,clearInterval(this.timer),this._emitter&&this._emitter.removeAllListeners(),delete this._emitter,delete this.dataSource,delete this.currentPlaylist,h.a.info(this.Tag,this.Tag+" has been abort")},e.prototype.destroy=function(){this.abort(),h.a.info(this.Tag,this.Tag+" has been destroy")},e.prototype._handleTrackOrLevelPlaylist=function(e,t,i,n){var r=this,a=i.id,s=i.level,o=i.type,u=this._getResponseUrl(e,i),h=Number.isFinite(a)?a:0,d=Number.isFinite(s)?s:h,l=this.mapContextToLevelType(i),c=S.parseLevelPlaylist(e.data,u,d,l,h);if(c.tload=t.tload,o===O.MANIFEST){var f={url:u,details:c};if(this._emitter.emit(L.a.MANIFEST_PARSED,{type:"levelPlaylist",levels:[f],audioTracks:[],url:u,stats:t,networkDetails:n}),!0===c.live&&!1===this._requestAbort){var p=function(e,t,i){var n=1e3*(t.averagetargetduration?t.averagetargetduration:t.targetduration),r=n/2;return e&&t.endSN===e.endSN&&(n=r),i&&(n=Math.max(r,n-(C.performance.now()-i))),Math.round(n)}(this.currentPlaylist,c,t.trequest);this.timer=I.setTimeout((function(){r.load()}),p)}this.currentPlaylist=c}},e.prototype._handleMasterPlaylist=function(e,t,i,n){var r=e.data,a=this._getResponseUrl(e,i),s=S.parseMasterPlaylist(r,a);if(s.length){var o=s.map((function(e){return{id:e.attrs.AUDIO,codec:e.audioCodec}})),u=S.parseMasterPlaylistMedia(r,a,"AUDIO",o),d=S.parseMasterPlaylistMedia(r,a,"SUBTITLES");if(u.length){var l=!1;u.forEach((function(e){e.url||(l=!0)})),!1===l&&s[0].audioCodec&&!s[0].attrs.AUDIO&&(h.a.log(this.Tag,"audio codec signaled in quality level, but no embedded audio track signaled, create one"),u.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:0}))}s.sort((function(e,t){return e.bitrate-t.bitrate})),this._emitter.emit(L.a.MANIFEST_PARSED,{type:"masterPlaylist",levels:s,audioTracks:u,subtitles:d,url:a,stats:t,networkDetails:n})}else this._handleManifestParsingError(e,i,"no level found in manifest",n)},e.prototype._handleManifestParsingError=function(e,t,i,n){this._emitter.emit(L.a.PARSE_ERROR,{url:e.url,reason:i,fatal:!0,networkDetails:n})},e.prototype._getResponseUrl=function(e,t){var i=e.url;return void 0!==i&&0!==i.indexOf("data:")||(i=t.url),i},e.prototype.mapContextToLevelType=function(e){switch(e.type){case O.AUDIO_TRACK:return R.AUDIO;case O.SUBTITLE_TRACK:return R.SUBTITLE;default:return R.MAIN}},e.prototype.loadError=function(e,t,i){e.text="playlist not found",this._emitter.emit(L.a.LOADING_ERROR,{response:e,context:t,xhr:i})},e.prototype.loadTimeout=function(e,t,i){e.text="download playlist timeout",this._emitter.emit(L.a.LOADIND_TIMEOUT,{stats:e,context:t,xhr:i})},e}();t.a=D},function(e,t,i){"use strict";var n=i(0),r=i(5),a=Object(r.a)(),s=function(){function e(){this._firstCheckpoint=0,this._lastCheckpoint=0,this._intervalBytes=0,this._totalBytes=0,this._lastSecondBytes=0,a.performance&&a.performance.now?this._now=a.performance.now.bind(a.performance):this._now=Date.now}return e.prototype.reset=function(){this._firstCheckpoint=0,this._lastCheckpoint=0,this._totalBytes=0,this._intervalBytes=0,this._lastSecondBytes=0},e.prototype.addBytes=function(e){0===this._firstCheckpoint?(this._firstCheckpoint=this._now(),this._lastCheckpoint=this._firstCheckpoint,this._intervalBytes+=e,this._totalBytes+=e):this._now()-this._lastCheckpoint<1e3?(this._intervalBytes+=e,this._totalBytes+=e):(this._lastSecondBytes=this._intervalBytes,this._intervalBytes=e,this._totalBytes+=e,this._lastCheckpoint=this._now())},Object.defineProperty(e.prototype,"currentKBps",{get:function(){this.addBytes(0);var e=(this._now()-this._lastCheckpoint)/1e3;return 0===e&&(e=1),this._intervalBytes/e/1024},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lastSecondKBps",{get:function(){return this.addBytes(0),0!==this._lastSecondBytes?this._lastSecondBytes/1024:this._now()-this._lastCheckpoint>=500?this.currentKBps:0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"averageKBps",{get:function(){var e=(this._now()-this._firstCheckpoint)/1e3;return this._totalBytes/e/1024},enumerable:!1,configurable:!0}),e}(),o=i(9),u=i(1),h=i(20),d=i(11),l=i(3),c=i(2),f=i(6);function p(e){return(p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var m,_=(m=function(e,t){return(m=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}m(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),g=function(e){function t(t,i){var n=e.call(this,"xhr-moz-chunked-loader","moz-chunked")||this;return n.Tag="MozChunkedLoader",n._needStash=!0,n._xhr=null,n._requestURL="",n._requestAbort=!1,n._contentLength=0,n._receivedLength=0,n._dataSource=null,n._range={from:0,to:-1},n._seekHandler=t,n._config=i,n}return _(t,e),t.isSupported=function(){try{var e=new XMLHttpRequest;return e.open("GET","https://example.com",!0),e.responseType="moz-chunked-arraybuffer","moz-chunked-arraybuffer"===e.responseType}catch(e){return n.a.warn("MozChunkedLoader",e.message),!1}},t.prototype.destroy=function(){this.isWorking()&&this.abort(),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onloadend=null,this._xhr.onerror=null,this._xhr=null),e.prototype.destroy.call(this)},t.prototype.startLoad=function(e,t){this._dataSource=e,this._range=t;var i=e.url;this._config.reuseRedirectedURL&&void 0!==e.redirectedURL&&(i=e.redirectedURL);var n=this._seekHandler.getConfig(i,t);this._requestURL=n.url,this._xhr=new XMLHttpRequest;var r=this._xhr;if(r.open("GET",n.url,!0),r.responseType="moz-chunked-arraybuffer",r.onreadystatechange=this._onReadyStateChange.bind(this),r.onprogress=this._onProgress.bind(this),r.onloadend=this._onLoadEnd.bind(this),r.onerror=this._onXhrError.bind(this),e.withCredentials&&(r.withCredentials=!0),"object"===p(n.headers)){var a=n.headers;Object.keys(a).forEach((function(e){r.setRequestHeader(e,a[e])}))}if("object"===p(this._config.headers)){var s=this._config.headers;Object.keys(s).forEach((function(e){r.setRequestHeader(e,s[e])}))}this._status=c.a.kConnecting,r.send()},t.prototype.abort=function(){this._requestAbort=!0,this._xhr&&this._xhr.abort(),this._status=c.a.kComplete},t.prototype._onReadyStateChange=function(e){var t=e.target;if(2===t.readyState){if(void 0!==t.responseURL&&t.responseURL!==this._requestURL&&this._onURLRedirect){var i=this._seekHandler.removeURLParameters(t.responseURL);this._onURLRedirect(i)}if(0!==t.status&&(t.status<200||t.status>299)){if(this._status=c.a.kError,!this._onError)throw new l.d("MozChunkedLoader: Http code invalid, "+t.status+" "+t.statusText);this._onError(f.a.HTTP_STATUS_CODE_INVALID,{code:t.status,reason:t.statusText})}else this._status=c.a.kBuffering}},t.prototype._onProgress=function(e){if(this._status!==c.a.kError){null===this._contentLength&&null!==e.total&&0!==e.total&&(this._contentLength=e.total,this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength));var t=e.target.response,i=this._range.from+this._receivedLength;this._receivedLength+=t.byteLength,this._onDataArrival&&this._onDataArrival(t,i,this._receivedLength)}},t.prototype._onLoadEnd=function(e){!0!==this._requestAbort?this._status!==c.a.kError&&(this._status=c.a.kComplete,this._onComplete&&this._onComplete(this._range.from,this._range.from+this._receivedLength-1)):this._requestAbort=!1},t.prototype._onXhrError=function(e){this._status=c.a.kError;var t=0,i=null;if(this._contentLength&&e.loaded<this._contentLength?(t=f.a.EARLY_EOF,i={code:-1,reason:"Moz-Chunked stream meet Early-Eof"}):(t=f.a.EXCEPTION,i={code:-1,reason:e.constructor.name+" "+e.type}),!this._onError)throw new l.d(i.reason);this._onError(t,i)},t}(d.a),y=i(4),v=i.n(y),b=Object(r.a)(),E=function(){function e(){this._firstCheckpoint=0,this._lastCheckpoint=0,this._intervalBytes=0,this._totalBytes=0,this._lastSecondBytes=0,b.performance&&b.performance.now?this._now=b.performance.now.bind(b.performance):this._now=Date.now}return e.prototype.reset=function(){this._lastCheckpoint=0,this._firstCheckpoint=0,this._intervalBytes=0,this._totalBytes=0,this._lastSecondBytes=0},e.prototype.addBytes=function(e){0===this._firstCheckpoint?(this._firstCheckpoint=this._now(),this._lastCheckpoint=this._firstCheckpoint,this._intervalBytes+=e,this._totalBytes+=e):this._now()-this._lastCheckpoint<1e3?(this._intervalBytes+=e,this._totalBytes+=e):(this._lastSecondBytes=this._intervalBytes,this._intervalBytes=e,this._totalBytes+=e,this._lastCheckpoint=this._now())},Object.defineProperty(e.prototype,"currentKBps",{get:function(){this.addBytes(0);var e=(this._now()-this._lastCheckpoint)/1e3;return 0===e&&(e=1),this._intervalBytes/e/1024},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lastSecondKBps",{get:function(){return this.addBytes(0),0!==this._lastSecondBytes?this._lastSecondBytes/1024:this._now()-this._lastCheckpoint>=500?this.currentKBps:0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"averageKBps",{get:function(){var e=(this._now()-this._firstCheckpoint)/1e3;return this._totalBytes/e/1024},enumerable:!1,configurable:!0}),e}();function S(e){return(S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var A=function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),T=function(e){function t(t,i){var n=e.call(this,"xhr-range-laoder","flv")||this;return n.eventEmitter=new v.a,n.Tag="RangerLoader",n.seekHandler=t,n.userConfig=i,n._needStash=!1,n._chunkSizeKBList=[128,256,384,512,768,1024,1536,2048,3072,4096,5120,6144,7168,8192],n._currentChunkSizeKB=384,n._currentSpeedNormalized=0,n._zeroSpeedChunkCount=0,n._xhr=null,n._speedSampler=new E,n._requestAbort=!1,n._waitForTotalLength=!1,n._totalLengthReceived=!1,n._currentRequestURL=null,n._currentRedirectedURL=null,n._currentRequestRange=null,n._totalLength=null,n._contentLength=null,n._receivedLength=0,n._lastTimeLoaded=0,n._range=null,n.mediaConfig=null,n}return A(t,e),t.isSupported=function(){try{var e=new XMLHttpRequest;return e.open("GET","https://example.com",!0),e.responseType="arraybuffer","arraybuffer"===e.responseType}catch(e){return n.a.warn("RangeLoader",e.message),!1}},t.prototype.destory=function(){this.isWorking()&&this.abort(),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr=null),e.prototype.destroy.call(this)},Object.defineProperty(t.prototype,"currentSpeed",{get:function(){return this._speedSampler.lastSecondKBps},enumerable:!1,configurable:!0}),t.prototype.startLoad=function(e,t){this.mediaConfig=e,this._range=t,this._status=c.a.kConnecting;var i=!1;void 0!==this.mediaConfig.fileSize&&0!==this.mediaConfig.fileSize&&(i=!0,this._totalLength=this.mediaConfig.fileSize),this._totalLengthReceived||i?this._openSubRange():(this._waitForTotalLength=!0,this._internalOpen(this.mediaConfig,{from:0,to:-1}))},t.prototype._openSubRange=function(){if(this._range){var e=1024*this._currentChunkSizeKB,t=this._range.from+this._receivedLength,i=t+e;null!=this._contentLength&&i-this._range.from>=this._contentLength&&(i=this._range.from+this._contentLength-1),this._currentRequestRange={from:t,to:i},this._internalOpen(this.mediaConfig,this._currentRequestRange)}},t.prototype._internalOpen=function(e,t){if(e&&this.mediaConfig){this._lastTimeLoaded=0;var i=e.url;this.userConfig.reuseRedirectedURL&&(this._currentRedirectedURL?i=this._currentRedirectedURL:void 0!==e.redirectedURL&&(i=e.redirectedURL));var n=this.seekHandler.getConfig(i,t);this._currentRequestURL=n.url,this._xhr=new XMLHttpRequest;var r=this._xhr;if(r.open("GET",n.url,!0),r.responseType="arraybuffer",r.onreadystatechange=this._onReadyStateChange.bind(this),r.onprogress=this._onProgress.bind(this),r.onload=this._onLoad.bind(this),r.onerror=this._onXhrError.bind(this),e.withCredentials&&(r.withCredentials=!0),"object"===S(n.headers)){var a=n.headers;Object.keys(a).forEach((function(e){r.setRequestHeader(e,a[e])}))}if("object"===S(this.userConfig.headers)){var s=this.userConfig.headers;Object.keys(s).forEach((function(e){r.setRequestHeader(e,s[e])}))}r.send()}},t.prototype.abort=function(){this._requestAbort=!0,this._internalAbort(),this._status=c.a.kComplete},t.prototype._onReadyStateChange=function(e){var t=e.target;if(2===t.readyState){if(void 0!==t.responseURL){var i=this.seekHandler.removeURLParameters(t.responseURL);t.responseURL!==this._currentRequestURL&&i!==this._currentRedirectedURL&&(this._currentRedirectedURL=i,this._onURLRedirect&&this._onURLRedirect(i))}if(t.status>=200&&t.status<=299){if(this._waitForTotalLength)return;this._status=c.a.kBuffering}else{if(this._status=c.a.kError,!this._onError)throw new l.d("RangeLoader: http code invalid, "+t.status+" "+t.statusText);this._onError(f.a.HTTP_STATUS_CODE_INVALID,{code:t.status,reason:t.statusText})}}},t.prototype._onProgress=function(e){if(this._status!==c.a.kError&&this._range){if(null===this._contentLength){var t=!1;if(this._waitForTotalLength){this._waitForTotalLength=!1,this._totalLengthReceived=!0,t=!0;var i=e.total;this._internalAbort(),null!=i&&0!==i&&(this._totalLength=i)}if(-1===this._range.to?this._contentLength=this._totalLength-this._range.from:this._contentLength=this._range.to-this._range.from+1,t)return void this._openSubRange();this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength)}var n=e.loaded-this._lastTimeLoaded;this._lastTimeLoaded=e.loaded,this._speedSampler.addBytes(n)}},t.prototype._onLoad=function(e){if(this._range&&e.target&&this._status!==c.a.kError)if(this._waitForTotalLength)this._waitForTotalLength=!1;else{this._lastTimeLoaded=0;var t=this._speedSampler.lastSecondKBps;if(0===t&&(this._zeroSpeedChunkCount++,this._zeroSpeedChunkCount>=3&&(t=this._speedSampler.currentKBps)),0!==t){var i=this._normalizeSpeed(t);this._currentSpeedNormalized!==i&&(this._currentSpeedNormalized=i,this._currentChunkSizeKB=i)}var n=e.target.response,r=this._range.from+this._receivedLength;this._receivedLength+=n.byteLength;var a=!1;null!==this._contentLength&&this._receivedLength<this._contentLength?this._openSubRange():a=!0,this._onDataArrival&&this._onDataArrival(n,r,this._receivedLength),a&&(this._status=c.a.kComplete,this._onComplete&&this._onComplete(this._range.from,this._range.from+this._receivedLength-1))}},t.prototype._onXhrError=function(e){this._status=c.a.kError;var t,i=0;if(this._contentLength&&this._receivedLength>0&&this._receivedLength<this._contentLength?(i=f.a.EARLY_EOF,t={code:-1,reason:"RangeLoder meet Early-Eof"}):(i=f.a.EXCEPTION,t={code:-1,reason:e.constructor.name+" "+e.type}),!this._onError)throw new l.d(t.reason);this._onError(i,t)},t.prototype._normalizeSpeed=function(e){var t=this._chunkSizeKBList,i=t.length-1,n=0,r=0,a=i;if(e<t[0])return t[0];for(;r<=a;){if((n=r+Math.floor((a-r)/2))===i||e>=t[n]&&e<t[n+1])return t[n];t[n]<e?r=n+1:a=n-1}return t[0]},t.prototype._internalAbort=function(){this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr.abort(),this._xhr=null)},t.prototype.on=function(e,t){this.eventEmitter.on(e,t)},t.prototype.once=function(e,t){this.eventEmitter.once(e,t)},t.prototype.off=function(e,t){this.eventEmitter.off(e,t)},t}(d.a),R=function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),L=Object(r.a)(),w=function(e){function t(){var t=e.call(this,"websocket-loader","flv")||this;return t._needStash=!0,t._ws=null,t._requestAbort=!1,t._receivedLength=0,t}return R(t,e),t.isSupported=function(){try{return void 0!==L.WebSocket}catch(e){return!1}},t.prototype.destroy=function(){this._ws&&this.abort(),e.prototype.destroy.call(this)},t.prototype.startLoad=function(e){try{this._ws=new L.WebSocket(e.url);var t=this._ws;if(!t)return;t.binaryType="arraybuffer",t.onopen=this._onWebSocketOpen.bind(this),t.onclose=this._onWebSocketClose.bind(this),t.onmessage=this._onWebSocketMessage.bind(this),t.onerror=this._onWebSocketError.bind(this),this._status=c.a.kConnecting}catch(e){this._status=c.a.kError;var i={code:e.code,reason:e.message};if(!this._onError)throw new l.d(i.reason);this._onError(f.a.EXCEPTION,i)}},t.prototype.abort=function(){var e=this._ws;!e||0!==e.readyState&&1!==e.readyState||(this._requestAbort=!0,e.close()),this._ws=null,this._status=c.a.kComplete},t.prototype._onWebSocketOpen=function(){this._status=c.a.kBuffering},t.prototype._onWebSocketClose=function(){!0!==this._requestAbort?(this._status=c.a.kComplete,this._onComplete&&this._onComplete(0,this._receivedLength-1)):this._requestAbort=!1},t.prototype._onWebSocketMessage=function(e){var t=this;if(e.data instanceof ArrayBuffer)this._dispatchArrayBuffer(e.data);else if(e.data instanceof Blob){var i=new FileReader;i.onload=function(){t._dispatchArrayBuffer(i.result)},i.readAsArrayBuffer(e.data)}else{this._status=c.a.kError;var n={code:-1,reason:"Unsupported WebSocket message type: "+e.data.constructor.name};if(!this._onError)throw new l.d(n.reason);this._onError(f.a.EXCEPTION,n)}},t.prototype._dispatchArrayBuffer=function(e){var t=e,i=this._receivedLength;this._receivedLength+=t.byteLength,this._onDataArrival&&this._onDataArrival(t,i,this._receivedLength)},t.prototype._onWebSocketError=function(){this._status=c.a.kError;var e={code:-1,reason:"websoket error"};if(!this._onError)throw new l.d(e.reason);this._onError(f.a.EXCEPTION,e)},t}(d.a),C=i(15),O=function(){function e(e){this._zeroStart=e||!1}return e.prototype.getConfig=function(e,t){var i=Object.create(null);if(0!==t.from||-1!==t.to){var n=void 0;n=-1!==t.to?"bytes="+t.from.toString()+"-"+t.to.toString():"bytes="+t.from.toString()+"-",i.Range=n}else this._zeroStart&&(i.Range="bytes=0-");return{url:e,headers:i}},e.prototype.removeURLParameters=function(e){return e},e}(),I=i(22),D=function(){return(D=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var r in t=arguments[i])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},k=function(){function e(e,t,i){this.Tag="IOController",this._config=t,this._extraData=i,this._stashInitialSize=393216,void 0!==t.stashInitialSize&&t.stashInitialSize>0&&(this._stashInitialSize=1024*t.stashInitialSize),this._stashUsed=0,this._stashSize=this._stashInitialSize,this._bufferSize=3145728,this._stashBuffer=new ArrayBuffer(this._bufferSize),this._stashByteStart=0,this._enableStash=!0,!1===t.enableStashBuffer&&(this._enableStash=!1),this._loader=null,this._loaderClass=null,this._seekHandler=null,this._mediaConfig=e,this._isWebSocketURL=/wss?:\/\/(.+?)/.test(e.url),this._refTotalLength=e.fileSize?e.fileSize:null,this._totalLength=this._refTotalLength,this._tsExtraData=void 0,this._fullRequestFlag=!1,this._currentRange=null,this._redirectedURL=null,this._speedNormalized=0,this._speedChecker=new s,this._speedNormalizeList=[64,128,256,384,512,768,1024,1536,2048,3072,4096],this._isEarlyEofReconnecting=!1,this._paused=!1,this._resumeFrom=0,this._onDataArrival=null,this._onSeeked=null,this._onError=null,this._onComplete=null,this._onRedirect=null,this._onRecoveredEarlyEof=null,this._onManifestParsed=null,this._selectSeekHandler(),this._selectLoader(),this._createLoader()}return e.prototype.destroy=function(){this._loader.isWorking()&&this._loader.abort(),this._loader.destroy(),this._loader=null,this._loaderClass=null,delete this._mediaConfig,delete this._stashBuffer,this._stashByteStart=0,this._bufferSize=0,this._stashSize=0,this._stashUsed=0,this._currentRange=null,delete this._speedChecker,this._isEarlyEofReconnecting=!1,this._onDataArrival=null,this._onSeeked=null,this._onError=null,this._onComplete=null,this._onRedirect=null,this._onRecoveredEarlyEof=null,this._onManifestParsed=null,this._extraData=null},e.prototype.isWorking=function(){return this._loader&&this._loader.isWorking()&&!this._paused},e.prototype.isPaused=function(){return this._paused},Object.defineProperty(e.prototype,"status",{get:function(){return this._loader.status},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"extraData",{get:function(){return this._extraData},set:function(e){this._extraData=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onDataArrival",{get:function(){return this._onDataArrival},set:function(e){this._onDataArrival=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onSeeked",{get:function(){return this._onSeeked},set:function(e){this._onSeeked=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onError",{get:function(){return this._onError},set:function(e){this._onError=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onComplete",{get:function(){return this._onComplete},set:function(e){this._onComplete=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onRedirect",{get:function(){return this._onRedirect},set:function(e){this._onRedirect=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onRecoveredEarlyEof",{get:function(){return this._onRecoveredEarlyEof},set:function(e){this._onRecoveredEarlyEof=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onManifestParsed",{get:function(){return this._onManifestParsed},set:function(e){this._onManifestParsed=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentURL",{get:function(){return this._mediaConfig.url},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasRedirect",{get:function(){return null!=this._redirectedURL||void 0!==this._mediaConfig.redirectedURL},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentRedirectedURL",{get:function(){return this._redirectedURL||this._mediaConfig.redirectedURL},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentSpeed",{get:function(){return this._loader instanceof T?this._loader.currentSpeed:this._speedChecker.lastSecondKBps},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"loaderType",{get:function(){return this._loader.type},enumerable:!1,configurable:!0}),e.prototype._selectSeekHandler=function(){var e=this._config;if("range"===e.seekType)this._seekHandler=new O(this._config.rangeLoadZeroStart);else if("param"===e.seekType){var t=e.seekParamStart||"bstart",i=e.seekParamEnd||"bend";this._seekHandler=new I.a(t,i)}else{if("custom"!==e.seekType)throw new l.b("Invalid seekType in config: "+e.seekType);if("function"!=typeof e.CustomSeekHandler)throw new l.b("Custom seekType specified in config but invalid CustomSeekHandler!");this._seekHandler=new e.CustomSeekHandler}},e.prototype._selectLoader=function(){if("flv"===this._mediaConfig.type)if(null!=this._config.customLoader)this._loaderClass=this._config.customLoader;else if(this._isWebSocketURL)this._loaderClass=w;else if(h.a.isSupported())this._loaderClass=h.a;else if(g.isSupported())this._loaderClass=g;else{if(!T.isSupported())throw new l.d("Your browser doesn't support xhr with arraybuffer responseType!");this._loaderClass=T}else"m3u8"===this._mediaConfig.type&&(this._loaderClass=C.a)},e.prototype._createLoader=function(){this._loader=new this._loaderClass(this._seekHandler,this._config),this._bindLoaderEvents()},e.prototype._bindLoaderEvents=function(){var e=this;this._loader&&(!1===this._loader.needStashBuffer&&(this._enableStash=!1),this._loader.onContentLengthKnown=this._onContentLengthKnown.bind(this),this._loader.onURLRedirect=this._onURLRedirect.bind(this),this._loader.onDataArrival=this._onLoaderChunkArrival.bind(this),this._loader.onComplete=this._onLoaderComplete.bind(this),this._loader.onError=this._onLoaderError.bind(this),"m3u8"===this._mediaConfig.type&&this._loader.on(u.a.MANIFEST_PARSED,(function(t){e._onManifestParsed&&e._onManifestParsed(t)})))},e.prototype.open=function(e){this._currentRange={from:0,to:-1},e&&(this._currentRange.from=e),this._speedChecker.reset(),e||(this._fullRequestFlag=!0),this._loader&&this._loader.startLoad(this._mediaConfig,D({},this._currentRange))},e.prototype.abort=function(){this._loader.abort(),this._paused&&(this._paused=!1,this._resumeFrom=0)},e.prototype.pause=function(){this.isWorking()&&(this._loader.abort(),this._currentRange&&(0!==this._stashUsed?(this._resumeFrom=this._stashByteStart,this._currentRange.to=this._stashByteStart-1):this._resumeFrom=this._currentRange.to+1),this._stashUsed=0,this._stashByteStart=0,this._paused=!0)},e.prototype.resume=function(){if(this._paused){this._paused=!1;var e=this._resumeFrom;this._resumeFrom=0,this._internalSeek(e,!0)}},e.prototype.seek=function(e){this._paused=!1,this._stashUsed=0,this._stashByteStart=0,this._internalSeek(e,!0)},e.prototype.tsSeek=function(e){this._loader instanceof C.a&&this._loader.seek(e)},e.prototype.loadNextFrag=function(){this._loader instanceof C.a&&this._loader.loadNextFrag()},e.prototype._internalSeek=function(e,t){if(this._loader.isWorking()&&this._loader.abort(),"flv"===this._mediaConfig.type){this._flushStashBuffer(t),this._loader.destroy(),this._loader=null;var i={from:e,to:-1};this._currentRange={from:i.from,to:-1},this._stashSize=this._stashInitialSize,this._createLoader(),this._loader.startLoad(this._mediaConfig,i)}else this._loader instanceof C.a&&(this._loader.resume(),this._loader.loadNextFrag());this._speedChecker.reset(),this._onSeeked&&this._onSeeked()},e.prototype._expandBuffer=function(e){for(var t=this._stashSize;t+1048576<e;)t*=2;if((t+=1048576)!==this._bufferSize){var i=new ArrayBuffer(t);if(this._stashUsed>0){var n=new Uint8Array(this._stashBuffer,0,this._stashUsed);new Uint8Array(i,0,t).set(n,0)}this._stashBuffer=i,this._bufferSize=t}},e.prototype._normalizeSpeed=function(e){var t=this._speedNormalizeList,i=t.length-1,n=0,r=0,a=i;if(e<t[0])return t[0];for(;r<=a;){if((n=r+Math.floor((a-r)/2))===i||e>=t[n]&&e<t[n+1])return t[n];t[n]<e?r=n+1:a=n-1}},e.prototype._adjustStashSize=function(e){var t=0;(t=this._config.isLive||e<512?e:e>=512&&e<=1024?Math.floor(1.5*e):2*e)>8192&&(t=8192);var i=1024*t+1048576;this._bufferSize<i&&this._expandBuffer(i),this._stashSize=1024*t},e.prototype._dispatchChunks=function(e,t,i){return this._currentRange&&(this._currentRange.to=t+e.byteLength-1),this._onDataArrival?this._onDataArrival(e,t,i):0},e.prototype._onURLRedirect=function(e){this._redirectedURL=e,this._onRedirect&&this._onRedirect(e)},e.prototype._onContentLengthKnown=function(e){e&&this._fullRequestFlag&&(this._totalLength=e,this._fullRequestFlag=!1)},e.prototype._onLoaderChunkArrival=function(e,t,i,n){if(!this._onDataArrival)throw new l.a("IOController: No existing consumer (onDataArrival) callback!");if(!this._paused){this._isEarlyEofReconnecting&&(this._isEarlyEofReconnecting=!1,this._onRecoveredEarlyEof&&this._onRecoveredEarlyEof()),this._speedChecker.addBytes(new Uint8Array(e).length),this._tsExtraData=n;var r=this._speedChecker.lastSecondKBps;if(0!==r){var a=this._normalizeSpeed(r);this._speedNormalized!==a&&(this._speedNormalized=Number(a),this._adjustStashSize(a))}if("m3u8"!==this._mediaConfig.type)if(this._enableStash)if(0===this._stashUsed&&0===this._stashByteStart&&(this._stashByteStart=t),this._stashUsed+e.byteLength<=this._stashSize){(u=new Uint8Array(this._stashBuffer,0,this._stashSize)).set(new Uint8Array(e),this._stashUsed),this._stashUsed+=e.byteLength}else{u=new Uint8Array(this._stashBuffer,0,this._bufferSize);if(this._stashUsed>0){var s=this._stashBuffer.slice(0,this._stashUsed);if((h=this._dispatchChunks(s,this._stashByteStart,n))<s.byteLength){if(h>0){d=new Uint8Array(s,h);u.set(d,0),this._stashUsed=d.byteLength,this._stashByteStart+=h}}else this._stashUsed=0,this._stashByteStart+=h;this._stashUsed+e.byteLength>this._bufferSize&&(this._expandBuffer(this._stashUsed+e.byteLength),u=new Uint8Array(this._stashBuffer,0,this._bufferSize)),u.set(new Uint8Array(e),this._stashUsed),this._stashUsed+=e.byteLength}else{if((h=this._dispatchChunks(e,t,n))<e.byteLength)(o=e.byteLength-h)>this._bufferSize&&(this._expandBuffer(o),u=new Uint8Array(this._stashBuffer,0,this._bufferSize)),u.set(new Uint8Array(e,h),0),this._stashUsed+=o,this._stashByteStart=t+h}}else if(0===this._stashUsed){var o;if((h=this._dispatchChunks(e,t,n))<e.byteLength)(o=e.byteLength-h)>this._bufferSize&&this._expandBuffer(o),(u=new Uint8Array(this._stashBuffer,0,this._bufferSize)).set(new Uint8Array(e,h),0),this._stashUsed+=o,this._stashByteStart=t+h}else{var u,h;if(this._stashUsed+e.byteLength>this._bufferSize&&this._expandBuffer(this._stashUsed+e.byteLength),(u=new Uint8Array(this._stashBuffer,0,this._bufferSize)).set(new Uint8Array(e),this._stashUsed),this._stashUsed+=e.byteLength,(h=this._dispatchChunks(this._stashBuffer.slice(0,this._stashUsed),this._stashByteStart,n))<this._stashUsed&&h>0){var d=new Uint8Array(this._stashBuffer,h);u.set(d,0)}this._stashUsed-=h,this._stashByteStart+=h}else this._dispatchChunks(e,this._stashByteStart,this._tsExtraData)}},e.prototype._flushStashBuffer=function(e){if(this._stashUsed>0){var t=this._stashBuffer.slice(0,this._stashUsed),i=this._dispatchChunks(t,this._stashByteStart,this._tsExtraData),r=t.byteLength-i;if(i<t.byteLength){if(!e){if(i>0){var a=new Uint8Array(this._stashBuffer,0,this._bufferSize),s=new Uint8Array(t,i);a.set(s,0),this._stashUsed=s.byteLength,this._stashByteStart+=i}return 0}n.a.warn(this.Tag,r+" bytes unconsumed data remain when flush buffer, dropped")}return this._stashUsed=0,this._stashByteStart=0,r}return 0},e.prototype._onLoaderComplete=function(){this._flushStashBuffer(!0),this._onComplete&&this._onComplete(this._extraData)},e.prototype._onLoaderError=function(e,t){switch(n.a.error(this.Tag,"Loader error, code = "+t.code+", msg = "+t.reason),this._flushStashBuffer(!1),this._isEarlyEofReconnecting&&(this._isEarlyEofReconnecting=!1,e=o.a.UNRECOVERABLE_EARLY_EOF),e){case o.a.EARLY_EOF:if(!this._config.isLive&&this._totalLength&&this._currentRange){var i=this._currentRange.to+1;return void(i<this._totalLength&&(n.a.warn(this.Tag,"Connection lost, trying reconnect..."),this._isEarlyEofReconnecting=!0,this._internalSeek(i,!1)))}e=o.a.UNRECOVERABLE_EARLY_EOF;break;case o.a.UNRECOVERABLE_EARLY_EOF:case o.a.CONNECTING_TIMEOUT:case o.a.HTTP_STATUS_CODE_INVALID:case o.a.EXCEPTION:}if(!this._onError)throw new l.d("IOException: "+t.reason);this._onError(e,t)},e}();t.a=k},function(e,t,i){"use strict";function n(){var e=window.MediaSource||window.WebKitMediaSource,t=window.SourceBuffer||window.WebKitSourceBuffer,i=e&&"function"==typeof e.isTypeSupported&&e.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),n=!t||t.prototype&&"function"==typeof t.prototype.appendBuffer&&"function"==typeof t.prototype.remove;return!!i&&!!n}i.d(t,"a",(function(){return n}))},function(e,t,i){function n(e){var t={};function i(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=e,i.c=t,i.i=function(e){return e},i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},i.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/",i.oe=function(e){throw console.error(e),e};var n=i(i.s=ENTRY_MODULE);return n.default||n}function r(e){return(e+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function a(e,t,n){var a={};a[n]=[];var s=t.toString(),o=s.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!o)return a;for(var u,h=o[1],d=new RegExp("(\\\\n|\\W)"+r(h)+"\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)","g");u=d.exec(s);)"dll-reference"!==u[3]&&a[n].push(u[3]);for(d=new RegExp("\\("+r(h)+'\\("(dll-reference\\s([\\.|\\-|\\+|\\w|/|@]+))"\\)\\)\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)',"g");u=d.exec(s);)e[u[2]]||(a[n].push(u[1]),e[u[2]]=i(u[1]).m),a[u[2]]=a[u[2]]||[],a[u[2]].push(u[4]);for(var l,c=Object.keys(a),f=0;f<c.length;f++)for(var p=0;p<a[c[f]].length;p++)l=a[c[f]][p],isNaN(1*l)||(a[c[f]][p]=1*a[c[f]][p]);return a}function s(e){return Object.keys(e).reduce((function(t,i){return t||e[i].length>0}),!1)}e.exports=function(e,t){t=t||{};var r={main:i.m},o=t.all?{main:Object.keys(r.main)}:function(e,t){for(var i={main:[t]},n={main:[]},r={main:{}};s(i);)for(var o=Object.keys(i),u=0;u<o.length;u++){var h=o[u],d=i[h].pop();if(r[h]=r[h]||{},!r[h][d]&&e[h][d]){r[h][d]=!0,n[h]=n[h]||[],n[h].push(d);for(var l=a(e,e[h][d],h),c=Object.keys(l),f=0;f<c.length;f++)i[c[f]]=i[c[f]]||[],i[c[f]]=i[c[f]].concat(l[c[f]])}}return n}(r,e),u="";Object.keys(o).filter((function(e){return"main"!==e})).forEach((function(e){for(var t=0;o[e][t];)t++;o[e].push(t),r[e][t]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",u=u+"var "+e+" = ("+n.toString().replace("ENTRY_MODULE",JSON.stringify(t))+")({"+o[e].map((function(t){return JSON.stringify(t)+": "+r[e][t].toString()})).join(",")+"});\n"})),u=u+"new (("+n.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+o.main.map((function(e){return JSON.stringify(e)+": "+r.main[e].toString()})).join(",")+"}))(self);";var h=new window.Blob([u],{type:"text/javascript"});if(t.bare)return h;var d=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(h),l=new window.Worker(d);return l.objectURL=d,l}},function(e,t,i){"use strict";i.r(t);var n=i(13),r=i(14),a=i(1),s=i(8);t.default=function(e){var t=null,i=function(t,i){e.postMessage({msg:a.a.WORKER_LOG,data:{type:t,msg:i}})}.bind(e);function o(t,i){var n={msg:a.a.INIT_SEGMENT,data:{type:t,data:i}},r=i.data;i.data instanceof Uint8Array&&(r=i.data.buffer),e.postMessage(n,[r])}function u(t,i){var n={msg:a.a.MEDIA_SEGMENT,data:{type:t,data:i}},r=i.data;i.data instanceof Uint8Array&&(r=i.data.buffer),e.postMessage(n,[r])}function h(){var t={msg:a.a.LOAD_COMPLETE};e.postMessage(t)}function d(){var t={msg:a.a.RECOVERED_EARLY_EOF};e.postMessage(t)}function l(t){var i={msg:a.a.MEDIA_INFO,data:t};e.postMessage(i)}function c(t){var i={msg:a.a.METADATA_ARRIVED,data:t};e.postMessage(i)}function f(t){var i={msg:a.a.SCRIPTDATA_ARRIVED,data:t};e.postMessage(i)}function p(t){var i={msg:a.a.STATISTICS_INFO,data:t};e.postMessage(i)}function m(t,i){e.postMessage({msg:a.a.IO_ERROR,data:{type:t,info:i}})}function _(t,i){e.postMessage({msg:a.a.DEMUX_ERROR,data:{type:t,info:i}})}function g(t){e.postMessage({msg:a.a.RECOMMEND_SEEKPOINT,data:t})}function y(t){e.postMessage({msg:a.a.GET_SEI_INFO,data:t})}function v(t){e.postMessage({msg:a.a.MANIFEST_PARSED,data:t})}e.addEventListener("message",(function(b){switch(b.data.cmd){case s.a.INIT:(t=new r.a(b.data.param[0],b.data.param[1],b.data.param[2],b.data.param[3])).on(a.a.IO_ERROR,m.bind(e)),t.on(a.a.DEMUX_ERROR,_.bind(e)),t.on(a.a.INIT_SEGMENT,o.bind(e)),t.on(a.a.MEDIA_SEGMENT,u.bind(e)),t.on(a.a.LOAD_COMPLETE,h.bind(e)),t.on(a.a.RECOVERED_EARLY_EOF,d.bind(e)),t.on(a.a.MEDIA_INFO,l.bind(e)),t.on(a.a.METADATA_ARRIVED,c.bind(e)),t.on(a.a.SCRIPTDATA_ARRIVED,f.bind(e)),t.on(a.a.STATISTICS_INFO,p.bind(e)),t.on(a.a.RECOMMEND_SEEKPOINT,g.bind(e)),t.on(a.a.GET_SEI_INFO,y.bind(e)),t.on(a.a.MANIFEST_PARSED,v.bind(e));break;case s.a.DESTROY:t&&(t.destroy(),t=null),e.postMessage({msg:"destroyed"});break;case s.a.START:t&&t.start();break;case s.a.STOP:t&&t.stop();break;case s.a.SEEK:t&&t.seek(b.data.param);break;case s.a.PAUSE:t&&t.pause();break;case s.a.RESUME:t&&t.resume();break;case s.a.LOG_CONFIG_CHANGE:var E=b.data.param;n.a.applyConfig(E),!0===E.enableCallback?n.a.addLogListener(i):n.a.removeLogListener(i)}}))}},function(e,t,i){(function(t,i){
/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
 * @version   v4.2.8+1e68dce6
 */var n;n=function(){"use strict";function e(e){return"function"==typeof e}var n=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},r=0,a=void 0,s=void 0,o=function(e,t){p[r]=e,p[r+1]=t,2===(r+=2)&&(s?s(m):b())},u="undefined"!=typeof window?window:void 0,h=u||{},d=h.MutationObserver||h.WebKitMutationObserver,l="undefined"==typeof self&&void 0!==t&&"[object process]"==={}.toString.call(t),c="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function f(){var e=setTimeout;return function(){return e(m,1)}}var p=new Array(1e3);function m(){for(var e=0;e<r;e+=2)(0,p[e])(p[e+1]),p[e]=void 0,p[e+1]=void 0;r=0}var _,g,y,v,b=void 0;function E(e,t){var i=this,n=new this.constructor(T);void 0===n[A]&&M(n);var r=i._state;if(r){var a=arguments[r-1];o((function(){return k(r,n,a,i._result)}))}else I(i,n,e,t);return n}function S(e){if(e&&"object"==typeof e&&e.constructor===this)return e;var t=new this(T);return L(t,e),t}l?b=function(){return t.nextTick(m)}:d?(g=0,y=new d(m),v=document.createTextNode(""),y.observe(v,{characterData:!0}),b=function(){v.data=g=++g%2}):c?((_=new MessageChannel).port1.onmessage=m,b=function(){return _.port2.postMessage(0)}):b=void 0===u?function(){try{var e=Function("return this")().require("vertx");return void 0!==(a=e.runOnLoop||e.runOnContext)?function(){a(m)}:f()}catch(e){return f()}}():f();var A=Math.random().toString(36).substring(2);function T(){}function R(t,i,n){i.constructor===t.constructor&&n===E&&i.constructor.resolve===S?function(e,t){1===t._state?C(e,t._result):2===t._state?O(e,t._result):I(t,void 0,(function(t){return L(e,t)}),(function(t){return O(e,t)}))}(t,i):void 0===n?C(t,i):e(n)?function(e,t,i){o((function(e){var n=!1,r=function(e,t,i,n){try{e.call(t,i,n)}catch(e){return e}}(i,t,(function(i){n||(n=!0,t!==i?L(e,i):C(e,i))}),(function(t){n||(n=!0,O(e,t))}),e._label);!n&&r&&(n=!0,O(e,r))}),e)}(t,i,n):C(t,i)}function L(e,t){if(e===t)O(e,new TypeError("You cannot resolve a promise with itself"));else if(r=typeof(n=t),null===n||"object"!==r&&"function"!==r)C(e,t);else{var i=void 0;try{i=t.then}catch(t){return void O(e,t)}R(e,t,i)}var n,r}function w(e){e._onerror&&e._onerror(e._result),D(e)}function C(e,t){void 0===e._state&&(e._result=t,e._state=1,0!==e._subscribers.length&&o(D,e))}function O(e,t){void 0===e._state&&(e._state=2,e._result=t,o(w,e))}function I(e,t,i,n){var r=e._subscribers,a=r.length;e._onerror=null,r[a]=t,r[a+1]=i,r[a+2]=n,0===a&&e._state&&o(D,e)}function D(e){var t=e._subscribers,i=e._state;if(0!==t.length){for(var n=void 0,r=void 0,a=e._result,s=0;s<t.length;s+=3)n=t[s],r=t[s+i],n?k(i,n,r,a):r(a);e._subscribers.length=0}}function k(t,i,n,r){var a=e(n),s=void 0,o=void 0,u=!0;if(a){try{s=n(r)}catch(e){u=!1,o=e}if(i===s)return void O(i,new TypeError("A promises callback cannot return that same promise."))}else s=r;void 0!==i._state||(a&&u?L(i,s):!1===u?O(i,o):1===t?C(i,s):2===t&&O(i,s))}var P=0;function M(e){e[A]=P++,e._state=void 0,e._result=void 0,e._subscribers=[]}var x=function(){function e(e,t){this._instanceConstructor=e,this.promise=new e(T),this.promise[A]||M(this.promise),n(t)?(this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?C(this.promise,this._result):(this.length=this.length||0,this._enumerate(t),0===this._remaining&&C(this.promise,this._result))):O(this.promise,new Error("Array Methods must be provided an Array"))}return e.prototype._enumerate=function(e){for(var t=0;void 0===this._state&&t<e.length;t++)this._eachEntry(e[t],t)},e.prototype._eachEntry=function(e,t){var i=this._instanceConstructor,n=i.resolve;if(n===S){var r=void 0,a=void 0,s=!1;try{r=e.then}catch(e){s=!0,a=e}if(r===E&&void 0!==e._state)this._settledAt(e._state,t,e._result);else if("function"!=typeof r)this._remaining--,this._result[t]=e;else if(i===U){var o=new i(T);s?O(o,a):R(o,e,r),this._willSettleAt(o,t)}else this._willSettleAt(new i((function(t){return t(e)})),t)}else this._willSettleAt(n(e),t)},e.prototype._settledAt=function(e,t,i){var n=this.promise;void 0===n._state&&(this._remaining--,2===e?O(n,i):this._result[t]=i),0===this._remaining&&C(n,this._result)},e.prototype._willSettleAt=function(e,t){var i=this;I(e,void 0,(function(e){return i._settledAt(1,t,e)}),(function(e){return i._settledAt(2,t,e)}))},e}(),U=function(){function t(e){this[A]=P++,this._result=this._state=void 0,this._subscribers=[],T!==e&&("function"!=typeof e&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof t?function(e,t){try{t((function(t){L(e,t)}),(function(t){O(e,t)}))}catch(t){O(e,t)}}(this,e):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return t.prototype.catch=function(e){return this.then(null,e)},t.prototype.finally=function(t){var i=this.constructor;return e(t)?this.then((function(e){return i.resolve(t()).then((function(){return e}))}),(function(e){return i.resolve(t()).then((function(){throw e}))})):this.then(t,t)},t}();return U.prototype.then=E,U.all=function(e){return new x(this,e).promise},U.race=function(e){var t=this;return n(e)?new t((function(i,n){for(var r=e.length,a=0;a<r;a++)t.resolve(e[a]).then(i,n)})):new t((function(e,t){return t(new TypeError("You must pass an array to race."))}))},U.resolve=S,U.reject=function(e){var t=new this(T);return O(t,e),t},U._setScheduler=function(e){s=e},U._setAsap=function(e){o=e},U._asap=o,U.polyfill=function(){var e=void 0;if(void 0!==i)e=i;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var n=null;try{n=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===n&&!t.cast)return}e.Promise=U},U.Promise=U,U},e.exports=n()}).call(this,i(29),i(30))},function(e,t){var i,n,r=e.exports={};function a(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function o(e){if(i===setTimeout)return setTimeout(e,0);if((i===a||!i)&&setTimeout)return i=setTimeout,setTimeout(e,0);try{return i(e,0)}catch(t){try{return i.call(null,e,0)}catch(t){return i.call(this,e,0)}}}!function(){try{i="function"==typeof setTimeout?setTimeout:a}catch(e){i=a}try{n="function"==typeof clearTimeout?clearTimeout:s}catch(e){n=s}}();var u,h=[],d=!1,l=-1;function c(){d&&u&&(d=!1,u.length?h=u.concat(h):l=-1,h.length&&f())}function f(){if(!d){var e=o(c);d=!0;for(var t=h.length;t;){for(u=h,h=[];++l<t;)u&&u[l].run();l=-1,t=h.length}u=null,d=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===s||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function m(){}r.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)t[i-1]=arguments[i];h.push(new p(e,t)),1!==h.length||d||o(f)},p.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=m,r.addListener=m,r.once=m,r.off=m,r.removeListener=m,r.removeAllListeners=m,r.emit=m,r.prependListener=m,r.prependOnceListener=m,r.listeners=function(e){return[]},r.binding=function(e){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},function(e,t){var i;i=function(){return this}();try{i=i||new Function("return this")()}catch(e){"object"==typeof window&&(i=window)}e.exports=i},function(e,t,i){"use strict";i.r(t);var n=i(4),r=i.n(n),a=i(1),s=i(3),o=function(){function e(e,t){if(this.Tag="NativePlayer",this._type="NativePlayer",this._emitter=new r.a,this.Codec=null,e.segments)throw new s.b("NativePlayer("+e.type+") doesn't support multipart playback!");this.e={onvLoadedMetadata:this._onvLoadedMetadata.bind(this)},this._pendingSeekTime=null,this._statisticsReportTimer=null,this.mediaConfig=e,this.userConfig=t,this._mediaElement=null}return e.prototype.destroy=function(){this._mediaElement&&(this.unload(),this.detachMediaElement()),this.e=null,delete this.mediaConfig,this._emitter.removeAllListeners(),delete this._emitter},e.prototype.on=function(e,t){var i=this;e===a.a.MEDIA_INFO?null!=this._mediaElement&&0!==this._mediaElement.readyState&&Promise.resolve().then((function(){i._emitter.emit(a.a.MEDIA_INFO,i.mediaInfo)})):e===a.a.STATISTICS_INFO&&null!=this._mediaElement&&0!==this._mediaElement.readyState&&Promise.resolve().then((function(){i._emitter.emit(a.a.STATISTICS_INFO,i.statisticsInfo)})),this._emitter.addListener(e,t)},e.prototype.off=function(e,t){this._emitter.removeListener(e,t)},e.prototype.attachMediaElement=function(e){if(this._mediaElement=e,e.addEventListener("loadedmetadata",this.e.onvLoadedMetadata),null!=this._pendingSeekTime)try{e.currentTime=this._pendingSeekTime,this._pendingSeekTime=null}catch(e){}},e.prototype.detachMediaElement=function(){this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src"),this._mediaElement.removeEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._mediaElement=null),null!=this._statisticsReportTimer&&(window.clearInterval(this._statisticsReportTimer),this._statisticsReportTimer=null)},e.prototype.load=function(){if(!this._mediaElement)throw new s.a("HTMLMediaElement must be attached before load()!");this._mediaElement.src=this.mediaConfig.url,this._mediaElement.readyState>0&&(this._mediaElement.currentTime=0),this._mediaElement.preload="auto",this._mediaElement.load(),this._statisticsReportTimer=window.setInterval(this._reportStatisticsInfo.bind(this),this.userConfig.statisticsInfoReportInterval)},e.prototype.unload=function(){this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src")),null!=this._statisticsReportTimer&&(window.clearInterval(this._statisticsReportTimer),this._statisticsReportTimer=null)},e.prototype.play=function(){if(this._mediaElement)return this._mediaElement.play()},e.prototype.pause=function(){this._mediaElement&&this._mediaElement.pause()},Object.defineProperty(e.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"buffered",{get:function(){return this._mediaElement?this._mediaElement.buffered:null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"duration",{get:function(){return this._mediaElement?this._mediaElement.duration:0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"volume",{get:function(){return this._mediaElement?this._mediaElement.volume:0},set:function(e){this._mediaElement&&(this._mediaElement.volume=e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"muted",{get:function(){return!!this._mediaElement&&this._mediaElement.muted},set:function(e){this._mediaElement&&(this._mediaElement.muted=e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentTime",{get:function(){return this._mediaElement?this._mediaElement.currentTime:0},set:function(e){this._mediaElement?this._mediaElement.currentTime=e:this._pendingSeekTime=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mediaInfo",{get:function(){var e=this._mediaElement instanceof HTMLAudioElement?"audio/":"video/",t=Object.create(null);return t.mimeType=e+this.mediaConfig.type,this._mediaElement&&(t.duration=Math.floor(1e3*this._mediaElement.duration),this._mediaElement instanceof HTMLVideoElement&&(t.width=this._mediaElement.videoWidth,t.height=this._mediaElement.videoHeight)),t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"statisticsInfo",{get:function(){var e=Object.create(null);if(e.playerType=this._type,e.url=this.mediaConfig.url,!(this._mediaElement instanceof HTMLVideoElement))return e;var t=!0,i=0,n=0;if(this._mediaElement.getVideoPlaybackQuality){var r=this._mediaElement.getVideoPlaybackQuality();i=r.totalVideoFrames,n=r.droppedVideoFrames}else void 0!==this._mediaElement.webkitDecodedFrameCount?(i=this._mediaElement.webkitDecodedFrameCount,n=this._mediaElement.webkitDroppedFrameCount):t=!1;return t&&(e.decodedFrames=i,e.droppedFrames=n),e},enumerable:!1,configurable:!0}),e.prototype._onvLoadedMetadata=function(){null!=this._pendingSeekTime&&this._mediaElement&&(this._mediaElement.currentTime=this._pendingSeekTime,this._pendingSeekTime=null),this._emitter.emit(a.a.MEDIA_INFO,this.mediaInfo)},e.prototype._reportStatisticsInfo=function(){this._emitter.emit(a.a.STATISTICS_INFO,this.statisticsInfo)},e}(),u=i(9),h=i(0),d=i(13),l=i(14),c=i(19),f=function(){var e=window.MediaSource||window.WebKitMediaSource;return e?{mp4:e.isTypeSupported("video/mp4"),mpeg:e.isTypeSupported("audio/mpeg"),mp3:e.isTypeSupported('audio/mp4; codecs="mp3"')}:{mp4:!1,mpeg:!1,mp3:!1}},p=i(8),m=i(26),_=f(),g={vendor:window.navigator.vendor||"",userAgent:window.navigator.userAgent},y=function(){function e(e,t){this.Tag="Transmuxer",this._emitter=new r.a;var i=m;if(t.enableWorker&&"undefined"!=typeof Worker)try{this._worker=i(27),this._workerDestroying=!1,this._worker&&this._worker.addEventListener("message",this._onWorkerMessage.bind(this)),this._worker&&this._worker.postMessage({cmd:p.a.INIT,param:[e,t,_,g]}),this.e={onLoggingConfigChanged:this._onLoggingConfigChanged.bind(this)},d.a.registerListener(this.e.onLoggingConfigChanged),this._worker&&this._worker.postMessage({cmd:p.a.LOG_CONFIG_CHANGE,param:d.a.getConfig()})}catch(i){h.a.error(this.Tag,"Error while initialize transmuxing worker, fallback to inline transmuxing"),delete this._worker,this._controller=new l.a(e,t,_,g)}else this._controller=new l.a(e,t,_,g);if(this._controller){var n=this._controller;n.on(a.a.IO_ERROR,this._onIOError.bind(this)),n.on(a.a.DEMUX_ERROR,this._onDemuxError.bind(this)),n.on(a.a.INIT_SEGMENT,this._onInitSegment.bind(this)),n.on(a.a.MEDIA_SEGMENT,this._onMediaSegment.bind(this)),n.on(a.a.LOAD_COMPLETE,this._onLoadingComplete.bind(this)),n.on(a.a.RECOVERED_EARLY_EOF,this._onRecoveredEarlyEof.bind(this)),n.on(a.a.MEDIA_INFO,this._onMediaInfo.bind(this)),n.on(a.a.METADATA_ARRIVED,this._onMetaDataArrived.bind(this)),n.on(a.a.SCRIPTDATA_ARRIVED,this._onScriptDataArrived.bind(this)),n.on(a.a.STATISTICS_INFO,this._onStatisticsInfo.bind(this)),n.on(a.a.RECOMMEND_SEEKPOINT,this._onRecommendSeekpoint.bind(this)),n.on(a.a.GET_SEI_INFO,this._onGetSeiInfo.bind(this)),n.on(a.a.MANIFEST_PARSED,this._onMainfestParsed.bind(this))}}return e.prototype.destroy=function(){this._worker?this._workerDestroying||(this._workerDestroying=!0,this._worker.postMessage({cmd:p.a.DESTROY}),d.a.removeListener(this.e.onLoggingConfigChanged),this.e=null):(this._controller&&this._controller.destroy(),delete this._controller),this._emitter.removeAllListeners(),delete this._emitter},e.prototype.on=function(e,t){this._emitter.addListener(e,t)},e.prototype.off=function(e,t){this._emitter.removeListener(e,t)},e.prototype.hasWorker=function(){return null!=this._worker},e.prototype.open=function(){this._worker?this._worker.postMessage({cmd:p.a.START}):this._controller&&this._controller.start()},e.prototype.close=function(){this._worker?this._worker.postMessage({cmd:p.a.STOP}):this._controller&&this._controller.stop()},e.prototype.seek=function(e){this._worker?this._worker.postMessage({cmd:p.a.SEEK,param:e}):this._controller&&this._controller.seek(e)},e.prototype.pause=function(){this._worker?this._worker.postMessage({cmd:p.a.PAUSE}):this._controller&&this._controller.pause()},e.prototype.resume=function(){this._worker?this._worker.postMessage({cmd:p.a.RESUME}):this._controller&&this._controller.resume()},e.prototype._onInitSegment=function(e,t){var i=this;Promise.resolve().then((function(){i._emitter.emit(a.a.INIT_SEGMENT,e,t)}))},e.prototype._onMediaSegment=function(e,t){var i=this;Promise.resolve().then((function(){i._emitter.emit(a.a.MEDIA_SEGMENT,e,t)}))},e.prototype._onLoadingComplete=function(){var e=this;Promise.resolve().then((function(){e._emitter.emit(a.a.LOAD_COMPLETE)}))},e.prototype._onRecoveredEarlyEof=function(){var e=this;Promise.resolve().then((function(){e._emitter.emit(a.a.RECOVERED_EARLY_EOF)}))},e.prototype._onMediaInfo=function(e){var t=this;Promise.resolve().then((function(){t._emitter.emit(a.a.MEDIA_INFO,e)}))},e.prototype._onMetaDataArrived=function(e){var t=this;Promise.resolve().then((function(){t._emitter.emit(a.a.METADATA_ARRIVED,e)}))},e.prototype._onScriptDataArrived=function(e){var t=this;Promise.resolve().then((function(){t._emitter.emit(a.a.SCRIPTDATA_ARRIVED,e)}))},e.prototype._onStatisticsInfo=function(e){var t=this;Promise.resolve().then((function(){t._emitter.emit(a.a.STATISTICS_INFO,e)}))},e.prototype._onIOError=function(e,t){var i=this;Promise.resolve().then((function(){i._emitter.emit(a.a.IO_ERROR,e,t)}))},e.prototype._onDemuxError=function(e,t){var i=this;Promise.resolve().then((function(){i._emitter.emit(a.a.DEMUX_ERROR,e,t)}))},e.prototype._onRecommendSeekpoint=function(e){var t=this;Promise.resolve().then((function(){t._emitter.emit(a.a.RECOMMEND_SEEKPOINT,e)}))},e.prototype._onGetSeiInfo=function(e){var t=this;Promise.resolve().then((function(){t._emitter.emit(a.a.GET_SEI_INFO,e)}))},e.prototype._onLoggingConfigChanged=function(e){this._worker&&this._worker.postMessage({cmd:p.a.LOG_CONFIG_CHANGE,param:e})},e.prototype._onMainfestParsed=function(e){var t=this;Promise.resolve().then((function(){t._emitter.emit(a.a.MANIFEST_PARSED,e)}))},e.prototype._onWorkerMessage=function(e){var t=e.data,i=t.data;if("destroyed"===t.msg||this._workerDestroying)return this._workerDestroying=!1,this._worker&&this._worker.terminate(),void delete this._worker;switch(t.msg){case a.a.INIT_SEGMENT:case a.a.MEDIA_SEGMENT:this._emitter.emit(t.msg,i.type,i.data);break;case a.a.LOAD_COMPLETE:case a.a.RECOVERED_EARLY_EOF:this._emitter.emit(t.msg);break;case a.a.MEDIA_INFO:Object.setPrototypeOf(i,c.a.prototype),this._emitter.emit(t.msg,i);break;case a.a.METADATA_ARRIVED:case a.a.SCRIPTDATA_ARRIVED:case a.a.STATISTICS_INFO:this._emitter.emit(t.msg,i);break;case a.a.IO_ERROR:case a.a.DEMUX_ERROR:this._emitter.emit(t.msg,i.type,i.info);break;case a.a.RECOMMEND_SEEKPOINT:case a.a.GET_SEI_INFO:case a.a.MANIFEST_PARSED:this._emitter.emit(t.msg,i);break;case a.a.WORKER_LOG:h.a.emitter.emit(a.a.HJ_PLAYER_LOG,i.type,i.msg)}},e}(),v=i(7),b=function(){function e(){this._list=[]}return e.prototype.clear=function(){this._list=[]},e.prototype.appendArray=function(e){var t=this._list;0!==e.length&&(t.length>0&&e[0].originalDts<t[t.length-1].originalDts&&this.clear(),Array.prototype.push.apply(t,e))},e.prototype.getLastSyncPointBeforeDts=function(e){if(0===this._list.length)return null;var t=this._list,i=0,n=t.length-1,r=0,a=0,s=n;for(e<t[0].dts&&(i=0,a=s+1);a<=s;){if((r=a+Math.floor((s-a)/2))===n||e>=t[r].dts&&e<t[r+1].dts){i=r;break}t[r].dts<e?a=r+1:s=r-1}return this._list[i]},e}(),E=function(){function e(e,t){this.TAG="MSEController",this._emitter=new r.a,this.on=this._emitter.on.bind(this._emitter),this.off=this._emitter.off.bind(this._emitter),this.e={onSourceOpen:this._onSourceOpen.bind(this),onSourceEnded:this._onSourceEnded.bind(this),onSourceClose:this._onSourceClose.bind(this),onSourceBufferError:function(){},onSourceBufferUpdateEnd:this._onSourceBufferUpdateEnd.bind(this)},this._mediaSourceObjectURL=null,this._mediaSource=null,this._mediaElement=null,this._isBufferFull=!1,this._hasPendingEos=!1,this._requireSetMediaDuration=!1,this._pendingMediaDuration=0,this._pendingSourceBufferInit=[],this._mimeTypes={video:null,audio:null},this._sourceBuffers={video:null,audio:null},this._lastInitSegments={video:null,audio:null},this._pendingSegments={video:[],audio:[]},this._pendingRemoveRanges={video:[],audio:[]},this._idrList=new b,this._config=e,t&&(this._mediaConfig=t),this._config.isLive&&void 0===this._config.autoCleanupSourceBuffer&&(this._config.autoCleanupSourceBuffer=!0)}return e.prototype.destroy=function(){(this._mediaElement||this._mediaSource)&&this.detachMediaElement(),this._emitter.removeAllListeners(),delete this._emitter,delete this.e},e.prototype.attachMediaElement=function(e){if(this._mediaSource)throw new s.a("MediaSource has been attached to an HTMLMediaElement!");if(window.MediaSource){var t=new window.MediaSource;t.addEventListener("sourceopen",this.e.onSourceOpen),t.addEventListener("sourceended",this.e.onSourceEnded),t.addEventListener("sourceclose",this.e.onSourceClose),this._mediaSource=t,this._mediaElement=e,this._mediaSourceObjectURL=window.URL.createObjectURL(this._mediaSource),e.src=this._mediaSourceObjectURL}else{var i=this,n=this._mediaConfig.sourceOpenEvent||"timeupdate";e.addEventListener(n,(function t(){i.e.onSourceOpen(),e.removeEventListener(n,t)})),e.addEventListener("ended",this.e.onSourceEnded),e.addEventListener("emptied",this.e.onSourceClose),this._mediaElement=e}},e.prototype.detachMediaElement=function(){var e=this;if(this._mediaSource){var t=this._mediaSource;if(Object.keys(this._sourceBuffers).forEach((function(i){var n=e._pendingSegments[i];n.splice(0,n.length),e._pendingSegments[i]=null,e._pendingRemoveRanges[i]=null,e._lastInitSegments[i]=null;var r=e._sourceBuffers[i];if(r){if("closed"!==t.readyState){try{t.removeSourceBuffer(r)}catch(t){h.a.error(e.TAG,t.message)}e.e&&(r.removeEventListener("error",e.e.onSourceBufferError),r.removeEventListener("updateend",e.e.onSourceBufferUpdateEnd))}e._mimeTypes[i]=null,e._sourceBuffers[i]=null}})),"open"===t.readyState)try{t.endOfStream()}catch(e){h.a.error(this.TAG,e.message)}this.e&&(t.removeEventListener("sourceopen",this.e.onSourceOpen),t.removeEventListener("sourceended",this.e.onSourceEnded),t.removeEventListener("sourceclose",this.e.onSourceClose)),this._pendingSourceBufferInit=[],this._isBufferFull=!1,this._idrList.clear(),this._mediaSource=null}this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src"),this._mediaElement=null),this._mediaSourceObjectURL&&(window.URL.revokeObjectURL(this._mediaSourceObjectURL),this._mediaSourceObjectURL=null)},e.prototype.appendInitSegment=function(e,t){if(!this._mediaSource||"open"!==this._mediaSource.readyState)return this._pendingSourceBufferInit.push(e),void this._pendingSegments[e.type].push(e);var i=e,n=""+i.container;i.codec&&i.codec.length>0&&(n+=";codecs="+i.codec);var r=!1;if(this._lastInitSegments[i.type]=i,n!==this._mimeTypes[i.type]){if(this._mimeTypes[i.type])h.a.info(this.TAG,"Notice: "+i.type+" mimeType changed, origin: "+this._mimeTypes[i.type]+", target: "+n);else{r=!0;try{var s=this._mediaSource.addSourceBuffer(n);this.e&&(s.addEventListener("error",this.e.onSourceBufferError),s.addEventListener("updateend",this.e.onSourceBufferUpdateEnd)),this._sourceBuffers[i.type]=s}catch(e){return h.a.error(this.TAG,e.message),void this._emitter.emit(a.a.ERROR,{code:e.code,reason:e.message})}}this._mimeTypes[i.type]=n}t||this._pendingSegments[i.type].push(i),r||this._sourceBuffers[i.type]&&!this._sourceBuffers[i.type].updating&&this._doAppendSegments(),v.a.safari&&"audio/mpeg"===i.container&&i.mediaDuration>0&&(this._requireSetMediaDuration=!0,this._pendingMediaDuration=i.mediaDuration/1e3,this._updateMediaSourceDuration())},e.prototype.appendMediaSegment=function(e){var t=e;this._pendingSegments[t.type].push(t),this._config.autoCleanupSourceBuffer&&this._needCleanupSourceBuffer()&&this._doCleanupSourceBuffer();var i=this._sourceBuffers[t.type];!i||i.updating||this._hasPendingRemoveRanges()||this._doAppendSegments()},e.prototype.seek=function(){var e=this;Object.keys(this._sourceBuffers).forEach((function(t){if(e._sourceBuffers[t]){var i=e._sourceBuffers[t];if("open"===e._mediaSource.readyState)try{i.abort()}catch(t){h.a.error(e.TAG,t.message)}e._idrList.clear();var n=e._pendingSegments[t];if(n.splice(0,n.length),"closed"!==e._mediaSource.readyState){for(var r=0;r<i.buffered.length;r++){var a=i.buffered.start(r),s=i.buffered.end(r);e._pendingRemoveRanges[t].push({start:a,end:s})}if(i.updating||e._doRemoveRanges(),v.a.safari){var o=e._lastInitSegments[t];o&&(e._pendingSegments[t].push(o),i.updating||e._doAppendSegments())}}}}))},e.prototype.endOfStream=function(){var e=this._mediaSource,t=this._sourceBuffers;e&&"open"===e.readyState?t.video&&t.video.updating||t.audio&&t.audio.updating?this._hasPendingEos=!0:(this._hasPendingEos=!1,e.endOfStream()):e&&"closed"===e.readyState&&this._hasPendingSegments()&&(this._hasPendingEos=!0)},e.prototype.getNearestKeyframe=function(e){return this._idrList.getLastSyncPointBeforeDts(e)},e.prototype._needCleanupSourceBuffer=function(){var e=this,t=!1;if(!this._config.autoCleanupSourceBuffer)return t;var i=(this._mediaElement||{currentTime:0}).currentTime;return Object.keys(this._sourceBuffers).some((function(n){var r=e._sourceBuffers[n];if(r){var a=r.buffered;a.length>=1&&i-a.start(0)>=e._config.autoCleanupMaxBackwardDuration&&(t=!0)}return t})),t},e.prototype._doCleanupSourceBuffer=function(){var e=this,t=(this._mediaElement||{currentTime:0}).currentTime;Object.keys(this._sourceBuffers).forEach((function(i){var n=e._sourceBuffers[i];if(n){for(var r=n.buffered,a=!1,s=0;s<r.length;s++){var o=r.start(s),u=r.end(s);if(o<=t&&t<u+3){if(t-o>=e._config.autoCleanupMaxBackwardDuration){a=!0;var h=t-e._config.autoCleanupMinBackwardDuration;e._pendingRemoveRanges[i].push({start:o,end:h})}}else u<t&&(a=!0,e._pendingRemoveRanges[i].push({start:o,end:u}))}a&&!n.updating&&e._doRemoveRanges()}}))},e.prototype._updateMediaSourceDuration=function(){var e=this._sourceBuffers;if((!this._mediaElement||0!==this._mediaElement.readyState&&"open"===this._mediaSource.readyState)&&!(e.video&&e.video.updating||e.audio&&e.audio.updating)){var t=this._mediaSource.duration,i=this._pendingMediaDuration;i>0&&(Number.isNaN(t)||i>t)&&(h.a.info(this.TAG,"Update MediaSource duration from "+t+" to "+i),this._mediaSource.duration=i),this._requireSetMediaDuration=!1,this._pendingMediaDuration=0}},e.prototype._doRemoveRanges=function(){var e=this;Object.keys(this._pendingRemoveRanges).forEach((function(t){if(e._sourceBuffers[t]&&!e._sourceBuffers[t].updating)for(var i=e._sourceBuffers[t],n=e._pendingRemoveRanges[t];n&&n.length&&!i.updating;){var r=n.shift();i.remove(r.start,r.end)}}))},e.prototype._doAppendSegments=function(){var e=this,t=this._pendingSegments;Object.keys(t).forEach((function(i){if(e._sourceBuffers[i]&&!e._sourceBuffers[i].updating&&t[i].length>0){var n=t[i].shift();if(n&&n.timestampOffset){var r=e._sourceBuffers[i].timestampOffset,s=n.timestampOffset/1e3;Math.abs(r-s)>.1&&(h.a.info(e.TAG,"Update MPEG audio timestampOffset from "+r+" to "+s),e._sourceBuffers[i].timestampOffset=s),delete n.timestampOffset}if(!n.data||0===n.data.byteLength)return;try{e._sourceBuffers[i].appendBuffer(n.data),e._isBufferFull=!1,"video"===i&&Object.prototype.hasOwnProperty.call(n,"info")&&e._idrList.appendArray(n.info.syncPoints)}catch(t){e._pendingSegments[i].unshift(n),22===t.code?(e._isBufferFull||e._emitter.emit(a.a.BUFFER_FULL),e._isBufferFull=!0):(h.a.error(e.TAG,t.message),e._emitter.emit(a.a.ERROR,{code:t.code,reason:t.message}))}}}))},e.prototype._onSourceOpen=function(){if(h.a.info(this.TAG,"MediaSource onSourceOpen"),this.e&&this._mediaSource&&this._mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen),this._pendingSourceBufferInit.length>0)for(var e=this._pendingSourceBufferInit;e.length;){var t=e.shift();this.appendInitSegment(t,!0)}this._hasPendingSegments()&&this._doAppendSegments(),this._emitter.emit(a.a.SOURCE_OPEN)},e.prototype._onSourceEnded=function(){h.a.info(this.TAG,"MediaSource onSourceEnded")},e.prototype._onSourceClose=function(){h.a.info(this.TAG,"MediaSource onSourceClose"),this._mediaSource&&null!=this.e&&(this._mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen),this._mediaSource.removeEventListener("sourceended",this.e.onSourceEnded),this._mediaSource.removeEventListener("sourceclose",this.e.onSourceClose))},e.prototype._hasPendingSegments=function(){var e=this._pendingSegments;return e.video.length>0||e.audio.length>0},e.prototype._hasPendingRemoveRanges=function(){var e=this._pendingRemoveRanges;return e.video.length>0||e.audio.length>0},e.prototype._onSourceBufferUpdateEnd=function(){this._requireSetMediaDuration?this._updateMediaSourceDuration():this._hasPendingRemoveRanges()?this._doRemoveRanges():this._hasPendingSegments()?this._doAppendSegments():this._hasPendingEos&&this.endOfStream(),this._emitter.emit(a.a.UPDATE_END)},e.prototype.setMediaSourceDuration=function(e){this._mediaSource&&(this._mediaSource.duration=e)},e}(),S=function(){return(S=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var r in t=arguments[i])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},A=function(){function e(e,t){this.Tag="MSEPlayer",this._type="MSEPlayer",this._emitter=new r.a,this.userConfig=t,this.mediaConfig=e,this.e={onvLoadedMetadata:this._onvLoadedMetadata.bind(this),onvSeeking:this._onvSeeking.bind(this),onvCanPlay:this._onvCanPlay.bind(this),onvStalled:this._onvStalled.bind(this),onvProgress:this._onvProgress.bind(this)},window.performance&&window.performance.now?this._now=window.performance.now.bind(window.performance):this._now=Date.now,this._pendingSeekTime=null,this._requestSetTime=!1,this._seekpointRecord=null,this._progressCheckTimer=void 0,this._mediaElement=null,this._msectl=null,this._transmuxer=null,this._mseSourceOpened=!1,this._hasPendingLoad=!1,this._receivedCanPlay=!1,this._mediaInfo=null,this._statisticsInfo=null;var i=v.a.chrome&&(v.a.version.major<50||50===v.a.version.major&&v.a.version.build<2661);this._alwaysSeekKeyframe=!!(i||v.a.msedge||v.a.msie),this._alwaysSeekKeyframe&&(this.userConfig.accurateSeek=!1),this._manifestParsed=!1,this._startPosition=0,this._currentDetail=null}return e.prototype.destroy=function(){void 0!==this._progressCheckTimer&&(window.clearInterval(this._progressCheckTimer),this._progressCheckTimer=void 0),this._transmuxer&&this.unload(),this._mediaElement&&this.detachMediaElement(),this.e=null,this._emitter&&this._emitter.removeAllListeners(),this._manifestParsed=!1,this._startPosition=0,this._currentDetail=null,this._statisticsInfo=null,this._mediaInfo=null,this._seekpointRecord=null,delete this._emitter,delete this.mediaConfig,delete this.userConfig,this._emitter=null,this.mediaConfig=null,this.userConfig=null},e.prototype.on=function(e,t){var i=this;this._emitter&&(e===a.a.MEDIA_INFO?null!==this._mediaInfo&&Promise.resolve().then((function(){i._emitter&&i._emitter.emit(a.a.MEDIA_INFO,i.mediaInfo)})):e===a.a.STATISTICS_INFO&&null!==this._statisticsInfo&&Promise.resolve().then((function(){i._emitter&&i._emitter.emit(a.a.STATISTICS_INFO,i.statisticsInfo)})),this._emitter.addListener(e,t))},e.prototype.off=function(e,t){this._emitter&&this._emitter.removeListener(e,t)},e.prototype.attachMediaElement=function(e){var t=this;if(this._mediaElement=e,e.addEventListener("loadedmetadata",this.e.onvLoadedMetadata),e.addEventListener("seeking",this.e.onvSeeking),e.addEventListener("canplay",this.e.onvCanPlay),e.addEventListener("stalled",this.e.onvStalled),e.addEventListener("progress",this.e.onvProgress),this.userConfig&&(this.mediaConfig?this._msectl=new E(this.userConfig,this.mediaConfig):this._msectl=new E(this.userConfig)),this._msectl.on(a.a.UPDATE_END,this._onmseUpdateEnd.bind(this)),this._msectl.on(a.a.BUFFER_FULL,this._onmseBufferFull.bind(this)),this._msectl.on(a.a.SOURCE_OPEN,(function(){t._mseSourceOpened=!0,t._hasPendingLoad&&(t._hasPendingLoad=!1,t.load())})),this._msectl.on(a.a.ERROR,(function(e){t._emitter&&t._emitter.emit(a.a.ERROR,u.a.MEDIA_ERROR,u.a.MEDIA_MSE_ERROR,e)})),this._msectl.attachMediaElement(e),null!=this._pendingSeekTime)try{e.currentTime=this._pendingSeekTime,this._pendingSeekTime=null}catch(e){}},e.prototype.detachMediaElement=function(){this._mediaElement&&this.e&&(this._msectl&&this._msectl.detachMediaElement(),this._mediaElement.removeEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._mediaElement.removeEventListener("seeking",this.e.onvSeeking),this._mediaElement.removeEventListener("canplay",this.e.onvCanPlay),this._mediaElement.removeEventListener("stalled",this.e.onvStalled),this._mediaElement.removeEventListener("progress",this.e.onvProgress),this._mediaElement=null),this._msectl&&(this._msectl.destroy(),this._msectl=null),this._startPosition=0},e.prototype.load=function(){var e=this;if(!this._mediaElement)throw new s.a("HTMLMediaElement must be attached before load()!");if(this._transmuxer)throw new s.a("FlvPlayer.load() has been called, please call unload() first!");this._hasPendingLoad||(this.userConfig.deferLoadAfterSourceOpen&&!1===this._mseSourceOpened?this._hasPendingLoad=!0:(this._mediaElement.readyState>0&&this._setMediaCurrentTime(0),this.mediaConfig&&this.userConfig&&(this._transmuxer=new y(this.mediaConfig,this.userConfig)),this._transmuxer.on(a.a.INIT_SEGMENT,(function(t,i){e._msectl&&e._msectl.appendInitSegment(i)})),this._transmuxer.on(a.a.MEDIA_SEGMENT,(function(t,i){if(e._msectl&&e._msectl.appendMediaSegment(i),e.userConfig.lazyLoad&&!e.userConfig.isLive&&e._mediaElement){var n=e._mediaElement.currentTime;i.info&&i.info.endDts>=1e3*(n+e.userConfig.lazyLoadMaxDuration)&&void 0===e._progressCheckTimer&&(h.a.info(e.Tag,"Maximum buffering duration exceeded, suspend transmuxing task"),h.a.info(e.Tag,"start load at "+i.info.endDts),e._suspendTransmuxer())}})),this._transmuxer.on(a.a.LOAD_COMPLETE,(function(){e._msectl&&e._msectl.endOfStream(),e._emitter.emit(a.a.LOAD_COMPLETE)})),this._transmuxer.on(a.a.RECOVERED_EARLY_EOF,(function(){e._emitter.emit(a.a.RECOVERED_EARLY_EOF)})),this._transmuxer.on(a.a.IO_ERROR,(function(t,i){e._emitter.emit(a.a.ERROR,u.a.NETWORK_ERROR,t,i)})),this._transmuxer.on(a.a.DEMUX_ERROR,(function(t,i){e._emitter.emit(a.a.ERROR,u.a.MEDIA_ERROR,t,{code:-1,reason:i})})),this._transmuxer.on(a.a.MEDIA_INFO,(function(t){e._mediaInfo=t,e._emitter.emit(a.a.MEDIA_INFO,S({},t))})),this._transmuxer.on(a.a.METADATA_ARRIVED,(function(t){e._emitter.emit(a.a.METADATA_ARRIVED,t)})),this._transmuxer.on(a.a.SCRIPTDATA_ARRIVED,(function(t){e._emitter.emit(a.a.SCRIPTDATA_ARRIVED,t)})),this._transmuxer.on(a.a.STATISTICS_INFO,(function(t){e._statisticsInfo=e._fillStatisticsInfo(t),e._emitter.emit(a.a.STATISTICS_INFO,S({},e._statisticsInfo))})),this._transmuxer.on(a.a.RECOMMEND_SEEKPOINT,(function(t){e._mediaElement&&!e.userConfig.accurateSeek&&e._setMediaCurrentTime(t/1e3)})),this._transmuxer.on(a.a.GET_SEI_INFO,(function(t){e._emitter.emit(a.a.GET_SEI_INFO,t)})),this._transmuxer.on(a.a.MANIFEST_PARSED,(function(t){e._manifestParsed||(e._manifestParsed=!0,!0===t.details.live?e.setMediaSourceDuration(1/0):e.setMediaSourceDuration(t.details.totalduration)),e._emitter.emit(a.a.MANIFEST_PARSED,t),e._currentDetail=t.details})),this._transmuxer&&this._transmuxer.open()))},e.prototype.unload=function(){this._mediaElement&&this._mediaElement.pause(),this._msectl&&this._msectl.seek(),this._transmuxer&&(this._transmuxer.close(),this._transmuxer.destroy(),this._transmuxer=null),this._manifestParsed=!1,this._startPosition=0,this._currentDetail=null},e.prototype.play=function(){if(this._mediaElement)return this._mediaElement.play()},e.prototype.pause=function(){this._mediaElement&&this._mediaElement.pause()},Object.defineProperty(e.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"buffered",{get:function(){return this._mediaElement?this._mediaElement.buffered:null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"duration",{get:function(){return this._mediaElement?this._mediaElement.duration:0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"volume",{get:function(){return this._mediaElement?this._mediaElement.volume:0},set:function(e){this._mediaElement&&(this._mediaElement.volume=e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"muted",{get:function(){return!!this._mediaElement&&this._mediaElement.muted},set:function(e){this._mediaElement&&(this._mediaElement.muted=e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentTime",{get:function(){return this._mediaElement?this._mediaElement.currentTime:0},set:function(e){this._mediaElement?this._internalSeek(e):this._pendingSeekTime=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mediaInfo",{get:function(){return S({},this._mediaInfo)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"statisticsInfo",{get:function(){return null==this._statisticsInfo&&(this._statisticsInfo={}),this._statisticsInfo=this._fillStatisticsInfo(this._statisticsInfo),S({},this._statisticsInfo)},enumerable:!1,configurable:!0}),e.prototype._fillStatisticsInfo=function(e){if(e.playerType=this._type,!(this._mediaElement instanceof HTMLVideoElement))return e;var t=!0,i=0,n=0;if(this._mediaElement.getVideoPlaybackQuality){var r=this._mediaElement.getVideoPlaybackQuality();i=r.totalVideoFrames,n=r.droppedVideoFrames}else void 0!==this._mediaElement.webkitDecodedFrameCount?(i=this._mediaElement.webkitDecodedFrameCount,n=this._mediaElement.webkitDroppedFrameCount):t=!1;return t&&(e.decodedFrames=i,e.droppedFrames=n),e},e.prototype._onmseUpdateEnd=function(){if(this.userConfig.lazyLoad&&!this.userConfig.isLive&&this._mediaElement){for(var e=this._mediaElement.buffered,t=this._mediaElement.currentTime,i=0,n=0;n<e.length;n++){var r=e.start(n),a=e.end(n);if(r<=t&&t<a){i=a;break}}i>=t+this.userConfig.lazyLoadMaxDuration&&void 0===this._progressCheckTimer&&(h.a.info(this.Tag,"Maximum buffering duration exceeded, suspend transmuxing task"),h.a.info(this.Tag,"start load at "+i),this._suspendTransmuxer())}},e.prototype._onmseBufferFull=function(){h.a.info(this.Tag,"MSE SourceBuffer is full, suspend transmuxing task"),void 0===this._progressCheckTimer&&this._suspendTransmuxer()},e.prototype._suspendTransmuxer=function(){this._transmuxer&&(this._transmuxer.pause(),void 0===this._progressCheckTimer&&(this._progressCheckTimer=window.setInterval(this._checkProgressAndResume.bind(this),1e3)))},e.prototype._checkProgressAndResume=function(){if(this._mediaElement){for(var e=this._mediaElement.currentTime,t=this._mediaElement.buffered,i=!1,n=0;n<t.length;n++){var r=t.start(n),a=t.end(n);if(e>=r&&e<a){e>=a-this.userConfig.lazyLoadRecoverDuration&&(i=!0);break}}i&&(window.clearInterval(this._progressCheckTimer),this._progressCheckTimer=void 0,i&&(h.a.info(this.Tag,"Continue loading from paused position"),this._transmuxer&&this._transmuxer.resume()))}},e.prototype._isTimepointBuffered=function(e){if(!this._mediaElement)return!1;for(var t=this._mediaElement.buffered,i=0;i<t.length;i++){var n=t.start(i),r=t.end(i);if(e>=n&&e<r)return!0}return!1},e.prototype._internalSeek=function(e){if(!this._mediaElement)return!1;var t=this._isTimepointBuffered(e),i=!1,n=0;if(e<1&&this._mediaElement.buffered.length>0){var r=this._mediaElement.buffered.start(0);(r<1&&e<r||v.a.safari)&&(i=!0,n=v.a.safari?.1:r)}if(i)this._setMediaCurrentTime(n);else if(t){if(this._alwaysSeekKeyframe){var a=this._msectl?this._msectl.getNearestKeyframe(Math.floor(1e3*e)):null,s=null!==a?a.dts/1e3:e;this._setMediaCurrentTime(s)}else this._setMediaCurrentTime(e);void 0!==this._progressCheckTimer&&this._checkProgressAndResume()}else void 0!==this._progressCheckTimer&&(window.clearInterval(this._progressCheckTimer),this._progressCheckTimer=void 0),this._msectl&&this._msectl.seek(),this._transmuxer&&this._transmuxer.seek(Math.floor(1e3*e)),this.userConfig.accurateSeek&&this._setMediaCurrentTime(e)},e.prototype._checkAndApplyUnbufferedSeekpoint=function(){if(this._seekpointRecord&&this._mediaElement)if(this._seekpointRecord.recordTime<=this._now()-100){var e=this._mediaElement.currentTime;this._seekpointRecord=null,this._isTimepointBuffered(e)||(void 0!==this._progressCheckTimer&&(window.clearTimeout(this._progressCheckTimer),this._progressCheckTimer=void 0),this._msectl&&this._msectl.seek(),this._transmuxer&&this._transmuxer.seek(Math.floor(1e3*e)),this.userConfig.accurateSeek&&this._mediaElement&&this._setMediaCurrentTime(e))}else window.setTimeout(this._checkAndApplyUnbufferedSeekpoint.bind(this),50)},e.prototype._checkAndResumeStuckPlayback=function(e){if(!this._mediaElement)return!1;var t=this._mediaElement;if(e||!this._receivedCanPlay||t.readyState<2){var i=t.buffered;i.length>0&&t.currentTime<i.start(0)&&(h.a.warn(this.Tag,"Playback seems stuck at "+t.currentTime+", seek to "+i.start(0)),this._setMediaCurrentTime(i.start(0)),this._mediaElement.removeEventListener("progress",this.e.onvProgress))}else this._mediaElement.removeEventListener("progress",this.e.onvProgress)},e.prototype._onvLoadedMetadata=function(){null!=this._pendingSeekTime&&this._mediaElement&&(this._mediaElement.currentTime=this._pendingSeekTime,this._pendingSeekTime=null)},e.prototype._onvSeeking=function(){if(!this._mediaElement)return!1;var e=this._mediaElement.currentTime,t=this._mediaElement.buffered;if(this._requestSetTime)this._requestSetTime=!1;else{if(e<1&&t.length>0){var i=t.start(0);if(i<1&&e<i||v.a.safari)return void this._setMediaCurrentTime(v.a.safari?.1:i)}if(this._isTimepointBuffered(e)){if(this._alwaysSeekKeyframe&&this._msectl){var n=this._msectl.getNearestKeyframe(Math.floor(1e3*e));null!=n&&this._setMediaCurrentTime(n.dts/1e3)}void 0!==this._progressCheckTimer&&this._checkProgressAndResume()}else this._seekpointRecord={seekPoint:e,recordTime:this._now()},window.setTimeout(this._checkAndApplyUnbufferedSeekpoint.bind(this),50)}},e.prototype._onvCanPlay=function(){this._receivedCanPlay=!0,this._mediaElement&&this._mediaElement.removeEventListener("canplay",this.e.onvCanPlay)},e.prototype._onvStalled=function(){this._checkAndResumeStuckPlayback(!0)},e.prototype._onvProgress=function(){this._checkAndResumeStuckPlayback()},e.prototype._setMediaCurrentTime=function(e){this._requestSetTime=!0,this._mediaElement&&(this._mediaElement.currentTime=e)},e.prototype.setMediaSourceDuration=function(e){this._msectl.setMediaSourceDuration(e)},e}(),T=i(16),R=i(17),L=function(){function e(){this.Tag="Codec",this.eventEmitter=new r.a}return e.getSupportCodec=function(e,t){return"FLV"===(e=e.toUpperCase())&&T.a.probe(t).match?T.a:"M3U8"===e&&R.a.probe(t)?R.a:null},Object.defineProperty(e,"FLVCodec",{get:function(){return T.a},enumerable:!1,configurable:!0}),Object.defineProperty(e,"TSCodec",{get:function(){return R.a},enumerable:!1,configurable:!0}),e}(),w={FORCE_GLOBAL_TAG:!1,GLOBAL_TAG:"HJPLAYER",ENABLE_CALLBACK:!1,ENABLE_ERROR:!0,ENABLE_INFO:!1,ENABLE_WARN:!1,ENABLE_DEBUG:!1,enableWorker:!1,enableStashBuffer:!0,stashInitialSize:384,isLive:!1,lazyLoad:!0,lazyLoadMaxDuration:180,lazyLoadRecoverDuration:30,deferLoadAfterSourceOpen:!0,autoCleanupMaxBackwardDuration:180,autoCleanupMinBackwardDuration:120,statisticsInfoReportInterval:1e3,fixAudioTimestampGap:!0,accurateSeek:!1,seekType:"range",seekParamStart:"bstart",seekParamEnd:"bend",rangeLoadZeroStart:!1,CustomSeekHandler:void 0,reuseRedirectedURL:!1,headers:void 0,customLoader:void 0,tsAutoLevelChoose:!1,maxFragLookUpTolerance:.25,defaultAudioCodec:void 0,parseSei:void 0},C=i(25),O=i(15),I=i(20),D=i(22),k=i(23),P=i(24),M=function(){return(M=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var r in t=arguments[i])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},x=function(){function e(e,t){if(this.Tag="HJPlayer",this.mediaConfig=e,this.userConfig=M(M({},w),t),h.a.config=this.userConfig,h.a.GLOBAL_TAG=this.userConfig.GLOBAL_TAG,!this.mediaConfig)throw new Error("mediaConfig is needed");if(!this.mediaConfig.type||"string"!=typeof this.mediaConfig.type)throw new Error("mediaConfig need correct type option");if(!this.mediaConfig.url||"string"!=typeof this.mediaConfig.url)throw new Error("mediaConfig need correct url option");switch(this.mediaConfig.type.toLowerCase()){case"mp4":return new o(this.mediaConfig,this.userConfig);case"flv":case"m3u8":return new A(this.mediaConfig,this.userConfig);default:throw new Error("unsupport media type")}}return e.isSupported=function(){return Object(C.a)()},Object.defineProperty(e,"Events",{get:function(){return a.a},enumerable:!1,configurable:!0}),Object.defineProperty(e,"Errors",{get:function(){return u.a},enumerable:!1,configurable:!0}),Object.defineProperty(e,"Codec",{get:function(){return L},enumerable:!1,configurable:!0}),Object.defineProperty(e,"Logger",{get:function(){return h.a},enumerable:!1,configurable:!0}),Object.defineProperty(e,"FragmentLoader",{get:function(){return O.a},enumerable:!1,configurable:!0}),Object.defineProperty(e,"FetchSteamLoader",{get:function(){return I.a},enumerable:!1,configurable:!0}),Object.defineProperty(e,"ParamSeekHandler",{get:function(){return D.a},enumerable:!1,configurable:!0}),Object.defineProperty(e,"PlayListLoader",{get:function(){return k.a},enumerable:!1,configurable:!0}),Object.defineProperty(e,"IOController",{get:function(){return P.a},enumerable:!1,configurable:!0}),Object.defineProperty(e,"HJPlayerDefaultConfig",{get:function(){return w},enumerable:!1,configurable:!0}),Object.defineProperty(e,"TransmuxingController",{get:function(){return l.a},enumerable:!1,configurable:!0}),Object.defineProperty(e,"typeSupported",{get:function(){return f()},enumerable:!1,configurable:!0}),e}(),U=i(28);(function(){function e(){}return e.install=function(){e.addIsNaN(),e.addIsInfinite(),e.addPromise()},e.addIsNaN=function(){Number.isNaN=Number.isNaN||self.isNaN},e.addIsInfinite=function(){Number.isFinite=Number.isFinite||self.isFinite},e.addPromise=function(){"function"!=typeof self.Promise&&U.polyfill()},e})().install();t.default=x}]).default}));